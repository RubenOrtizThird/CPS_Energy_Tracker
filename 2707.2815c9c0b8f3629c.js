"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[2707],{52707:(v,c,o)=>{o.r(c),o.d(c,{default:()=>L});var E=o(15861),h=o(50484),d=(o(14007),o(4703),o(1535),o(57678),o(57964),o(10141)),p=o(657),C=o(96043),j=o(99657),I=o(5863),i=o(51424);class l{constructor(s,r){this.offset=s,this.extent=r}}let f=class extends I.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(_,s){var r=this;return(0,E.Z)(function*(){const t=s.schema.processors[0];"heatmap"===t.type&&(0,p.Hg)(r._schema,t)&&(_.mesh=!0,r._schema=t)})()}onTileUpdate(_){for(const s of _.removed)this._tileKeyToFeatureSets.delete(s.key.id)}onTileClear(_){return this._tileKeyToFeatureSets.delete(_.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.id,data:{clear:!0}})}onTileMessage(_,s,r){var t=this;return(0,E.Z)(function*(){t._tileKeyToFeatureSets.has(_.key.id)||t._tileKeyToFeatureSets.set(_.key.id,new Map);const e=t._tileKeyToFeatureSets.get(_.key.id);if(e&&null!=s.addOrUpdate&&s.addOrUpdate.hasFeatures&&e.set(s.addOrUpdate.instance,s),s.end){const a=[],y=function R(_){const s=_.key,r=new Map,t=256,e=j.i9,a=_.tileInfoView.tileInfo.isWrappable;return r.set((0,i.M)(s,-1,-1,a).id,new l([-e,-e],[e-t,e-t,e,e])),r.set((0,i.M)(s,0,-1,a).id,new l([0,-e],[0,e-t,e,e])),r.set((0,i.M)(s,1,-1,a).id,new l([e,-e],[0,e-t,t,e])),r.set((0,i.M)(s,-1,0,a).id,new l([-e,0],[e-t,0,e,e])),r.set((0,i.M)(s,1,0,a).id,new l([e,0],[0,0,t,e])),r.set((0,i.M)(s,-1,1,a).id,new l([-e,e],[e-t,0,e,t])),r.set((0,i.M)(s,0,1,a).id,new l([0,e],[0,0,e,t])),r.set((0,i.M)(s,1,1,a).id,new l([e,e],[0,0,t,t])),r}(_);t._tileKeyToFeatureSets.forEach((m,O)=>{if(O===_.key.id)m.forEach(({addOrUpdate:M})=>{M&&a.push(M)});else if(y.has(O)){const M=y.get(O),[A,g]=M.offset;m.forEach(({addOrUpdate:K})=>{if(K){const S=K.transform(A,g,1,1);a.push(S)}})}});const U=(0,C.QM)(a,t._schema.mesh,512,512);return t.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.key.id,intensityInfo:U},{...r,transferList:[U.matrix]})}})()}onTileError(_,s,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:_.id,error:s},r)}};f=(0,h._)([(0,d.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const L=f},51424:(v,c,o)=>{function E(h,T,D,P){const n=h.clone(),u=1<<n.level,d=n.col+T,p=n.row+D;return P&&d<0?(n.col=d+u,n.world-=1):d>=u?(n.col=d-u,n.world+=1):n.col=d,n.row=p,n}o.d(c,{M:()=>E})}}]);