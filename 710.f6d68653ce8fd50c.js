"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[710],{32455:(ne,q,h)=>{h.d(q,{Z:()=>z});var S=h(15861);class z{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(O,A,M){this._layerById[A]=M,this._layerByName[O]=M}featureSetByName(O,A=!0,M=["*"]){var j=this;return(0,S.Z)(function*(){return void 0===j._layerByName[O]?null:j._layerByName[O]})()}featureSetById(O,A=!0,M=["*"]){var j=this;return(0,S.Z)(function*(){return void 0===j._layerById[O]?null:j._layerById[O]})()}castToText(O=!1){return"object, FeatureSetCollection"}}},20710:(ne,q,h)=>{h.r(q),h.d(q,{constructAssociationMetaDataFeatureSetFromUrl:()=>qe,constructFeatureSet:()=>re,constructFeatureSetFromPortalItem:()=>nt,constructFeatureSetFromRelationship:()=>Xe,constructFeatureSetFromUrl:()=>me,convertToFeatureSet:()=>rt,createFeatureSetCollectionFromMap:()=>et,createFeatureSetCollectionFromService:()=>tt,initialiseMetaDataCache:()=>Je});var S=h(15861),z=h(66476),Q=h(32455),O=h(89018),A=h(52034),M=h(35458),j=h(94511),T=h(11375),F=h(70930),P=h(95418),Z=h(58446),v=h(25677),m=h(76961),b=h(77023),L=h(80389),p=h(85904);class D{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new D;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r,n){const l=new D;l.field=e;const i=p.WhereClause.create(t,r,n),c=function E(w){if("function"===w.parseTree.type){if(0===w.parseTree.args.value.length)return{name:w.parseTree.name,expr:null};if(w.parseTree.args.value.length>1)throw new F.eS(F.f.MissingStatisticParameters);const e=p.WhereClause.create((0,b.XF)(w.parseTree.args.value[0],m.Bj.Standardised,w.parameters),w.fieldsIndex,w.timeZone);return{name:w.parseTree.name,expr:e}}return null}(i);if(null===c)throw new F.eS(F.f.UnsupportedSqlFunction,{function:""});const s=c.name.toUpperCase().trim();if("MIN"===s){if(l.typeofstat="MIN",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:"min"})}else if("MAX"===s){if(l.typeofstat="MAX",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===s)l.typeofstat="COUNT",l.workingexpr=c.expr;else if("STDEV"===s){if(l.typeofstat="STDDEV",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===s){if(l.typeofstat="SUM",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===s){if(l.typeofstat="AVG",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:s})}else if("AVG"===s){if(l.typeofstat="AVG",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==s)throw new F.eS(F.f.UnsupportedSqlFunction,{function:s});if(l.typeofstat="VAR",l.workingexpr=c.expr,null===i)throw new F.eS(F.f.InvalidFunctionParameters,{function:"var"})}return l}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var I=h(19799),d=h(88781),y=h(80458),u=h(81429),g=h(43814),_=h(81247),N=h(40100);function k(w){if(!w)return"COUNT";switch(w.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class K extends P.Z{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,S.Z)(function*(){if(null===t._wset){const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,t._wset}return t._wset})()}_isInFeatureSet(){return m.dj.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new N.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let i=!1;for(let c=0;c<this._config.groupbyfields.length;c++)if(this._config.groupbyfields[c].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(let c=0;c<this._config.statsfields.length;c++)if(this._config.statsfields[c].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const i of this._config.statsfields){const c=new D;c.field=i.name,c.tofieldname=i.name,c.workingexpr=i.expression instanceof p.WhereClause?i.expression:p.WhereClause.create(i.expression,n,this.dateFieldsTimeZoneDefaultUTC),c.typeofstat=k(i.statistic),this._decodedStatsfield.push(c)}this._decodedGroupbyfield=[];for(const i of this._config.groupbyfields){const c={name:i.name,singlefield:null,tofieldname:i.name,expression:i.expression instanceof p.WhereClause?i.expression:p.WhereClause.create(i.expression,n,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(c)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const i of this._parent.fields)e[i.name.toUpperCase()]=1;this.types=null}else this.geometryType=m.Qk.point,this.typeIdField="",this.types=null,this.spatialReference=new g.Z({wkid:4326});this.fields=[];const l=new D;l.field=this._nextUniqueName(e),l.tofieldname=this.objectIdField,l.workingexpr=p.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),l.typeofstat="MIN",this._decodedStatsfield.push(l);for(const i of this._decodedGroupbyfield){const c=new _.Z;if(i.name=this._nextUniqueName(e),c.name=i.tofieldname,c.alias=c.name,(0,b.y5)(i.expression)){const s=this._parent.getField((0,b.zR)(i.expression,m.Bj.Standardised));if(!s)throw new F.EN(F.H9.AggregationFieldNotFound);i.name=s.name,i.singlefield=s.name,this.phsyicalgroupbyfields.push(s.name),c.type=s.type,i.sqlType=s.type}else{c.type=this._convertToEsriFieldType((0,b.DT)(i.expression,this._parent.fields));const s=new _.Z;s.name=i.name,s.alias=s.name,this.phsyicalgroupbyfields.push(i.name),this._adaptedFields.push(new j.yN(s,i.expression)),this._candosimplegroupby=!1,i.sqlType=c.type}this.fields.push(c)}if(this._adaptedFields.length>0)for(const i of this._parent.fields)this._adaptedFields.push(new j.$X(i));for(let i=0;i<this._decodedStatsfield.length;i++){const c=new _.Z;let s=null;const f=this._decodedStatsfield[i];f.field=this._nextUniqueName(e),f.tofieldname===this.objectIdField&&(this._internalObjectIdField=f.field),c.name=f.tofieldname,c.alias=c.name;const C=null!==f.workingexpr&&(0,b.y5)(f.workingexpr)?(0,b.zR)(f.workingexpr,m.Bj.Standardised):"";switch(this._decodedStatsfield[i].typeofstat){case"SUM":if(""!==C){if(s=this._parent.getField(C),!s)throw new F.EN(F.H9.AggregationFieldNotFound);c.type=s.type}else c.type="double";break;case"MIN":case"MAX":if(""!==C){if(s=this._parent.getField(C),!s)throw new F.EN(F.H9.AggregationFieldNotFound);c.type=s.type}else c.type="double";break;case"COUNT":c.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==C&&(s=this._parent.getField(C),!s))throw new F.EN(F.H9.AggregationFieldNotFound);c.type="double"}this.fields.push(c)}}_canDoAggregates(){return(0,S.Z)(function*(){return!1})()}_getFeatures(e,t,r,n){var l=this;return(0,S.Z)(function*(){const i=l._maxQuery;return!0===l._checkIfNeedToExpandKnownPage(e,i)?(yield l._expandPagedSet(e,i,0,0,n),l._getFeatures(e,t,r,n)):"success"})()}_getFilteredSet(e,t,r,n,l){var i=this;return(0,S.Z)(function*(){if(""!==e)return new Z.Z([],[],!0,null);let c=null;const s={ordered:!1,nowhereclause:!1};if(yield i._ensureLoaded(),null!==r)for(let C=0;C<i._decodedStatsfield.length;C++)if(!0===(0,b.hq)(r,i._decodedStatsfield[C].tofieldname)){s.nowhereclause=!0,r=null;break}if(null!==n){s.ordered=!0;for(let C=0;C<i._decodedStatsfield.length;C++)if(!0===n.scanForField(i._decodedStatsfield[C].tofieldname)){n=null,s.ordered=!1;break}if(null!==n)for(const C of i._decodedGroupbyfield)if(null===C.singlefield&&!0===n.scanForField(C.tofieldname)){n=null,s.ordered=!1;break}}if(!1!==i._candosimplegroupby&&(yield i._parent._canDoAggregates(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,null))){let C=null;r&&(C=i._reformulateWhereClauseWithoutGroupByFields(r));let x=null;n&&(x=i._reformulateOrderClauseWithoutGroupByFields(n));const B=yield i._parent._getAggregatePagesDataSourceDefinition(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,C,x,i._internalObjectIdField);return i._checkCancelled(l),c=!0===s.nowhereclause?new Z.Z(B._candidates.slice(0).concat(B._known.slice(0)),[],!0===s.ordered&&B._ordered,i._clonePageDefinition(B.pagesDefinition)):new Z.Z(B._candidates.slice(0),B._known.slice(0),!0===s.ordered&&B._ordered,i._clonePageDefinition(B.pagesDefinition)),c}let f=i._parent;if(i._adaptedFields.length>0&&(f=new j.Xx({parentfeatureset:i._parent,adaptedFields:i._adaptedFields,extraFilter:null})),!0===s.nowhereclause)c=new Z.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new T.Z({parentfeatureset:f,orderbyclause:new v.Z(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}});else{let C=f;if(null!==r){let x=null;r&&(x=i._reformulateWhereClauseWithoutGroupByFields(r)),C=new A.Z({parentfeatureset:C,whereclause:x})}c=new Z.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new T.Z({parentfeatureset:C,orderbyclause:new v.Z(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}})}return c})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,b.bB)(e,t.tofieldname,(0,b.zR)(t.workingexpr,m.Bj.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,b.bB)(e,t.tofieldname,(0,b.zR)(t.expression,m.Bj.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){var n=this;return(0,S.Z)(function*(){return!0===n._checkIfNeedToExpandCandidatePage(e,n._maxQuery)?(yield n._expandPagedSet(e,n._maxQuery,0,0,r),n._refineSetBlock(e,t,r)):(n._checkCancelled(r),n._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getPhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const l=yield n._getAgregagtePhysicalPage(e,t,r);for(const i of l){const c={geometry:i.geometry,attributes:{}},s={};for(const f in i.attributes)s[f.toLowerCase()]=i.attributes[f];for(const f of n._decodedGroupbyfield)c.attributes[f.tofieldname]=s[f.name.toLowerCase()];for(const f of n._decodedStatsfield)c.attributes[f.tofieldname]=s[f.field.toLowerCase()];n._featureCache[c.attributes[n.objectIdField]]=new M.Z(c)}return l.length})()}_sequentialGetPhysicalItem(e,t,r,n){return new Promise((l,i)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?l(n.length):this._nextAggregateItem(e,t,r,n,c=>{l(null===c?n.length:this._sequentialGetPhysicalItem(e,t-=1,r,n))},i)})}_nextAggregateItem(e,t,r,n,l,i){try{(0,O.a1)(e.pagesDefinition.internal.iterator.next()).then(c=>{if(null===c)if(null!==e.pagesDefinition.internal.workingItem){const s=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(s),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(s.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,l(null)}else e.pagesDefinition.internal.fullyResolved=!0,l(null);else{const s=this._generateAggregateHash(c);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[c],id:s};else{if(s!==e.pagesDefinition.internal.workingItem.id){const f=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(f),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(f.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[c],id:s},void l(f)}e.pagesDefinition.internal.workingItem.features.push(c)}this._nextAggregateItem(e,t,r,n,l,i)}},i)}catch(c){i(c)}}_calculateFieldStat(e,t,r){const n=[];for(let l=0;l<e.features.length;l++)if(null!==t.workingexpr){const i=t.workingexpr.calculateValue(e.features[l]);null!==i&&n.push(i instanceof d.u||i instanceof u.n?i.toNumber():i instanceof y.H?i.toMilliseconds():i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=(0,L.tj)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=(0,L.tj)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=(0,L.tj)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=(0,L.tj)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=(0,L.tj)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=(0,L.tj)("avg",n,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const l=n.singlefield?e.features[0].attributes[n.singlefield]:p.WhereClause.convertValueToStorageFormat(n.expression.calculateValue(e.features[0]),n.sqlType);t.attributes[n.tofieldname]=l}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new M.Z({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,I.F)(t,I.M.String)}_stat(){return(0,S.Z)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,S.Z)(function*(){return null})()}static registerAction(){P.Z._featuresetFunctions.groupby=function(e,t){return new K({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var W=h(15367),R=h(92224),U=h(26152),V=h(97973),oe=h(70430),ue=h(40637),se=h(33721),te=h(90373),xe=h(46663),Oe=h(57964),Ze=h(14007),Ae=h(79412),de=h(11642),je=h(46054),he=h(46708),Le=h(36026),Ne=h(93792),ie=h(91866);function fe(){return fe=(0,S.Z)(function*(w,e,t,r){return function ke(w,e,t,r){return _e.apply(this,arguments)}(e,yield function Ue(w,e,t,r){return pe.apply(this,arguments)}(w,e,t,r),t,r)}),fe.apply(this,arguments)}function pe(){return(pe=(0,S.Z)(function*(w,e,t,r){const n={...r},l=function Ge(w,e){let t=ie.Z.from(w);t.sourceSpatialReference=t.sourceSpatialReference??e?.sourceSpatialReference??null,(e?.gdbVersion||e?.dynamicDataSource)&&(t=t===w?t.clone():t,t.gdbVersion=w.gdbVersion||e.gdbVersion,t.dynamicDataSource=w.dynamicDataSource?je.n.from(w.dynamicDataSource):e.dynamicDataSource);const r=e?.infoFor3D;if(null!=r&&be(w,r)){t=t===w?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:n,queryFormats:l}=r,i=(0,de.S0)("model/gltf-binary",n)??(0,de.Ow)("glb",n),c=(0,de.S0)("model/gltf+json",n)??(0,de.Ow)("gtlf",n);for(const s of l){if(s===i){t.formatOf3DObjects=s;break}s!==c||t.formatOf3DObjects||(t.formatOf3DObjects=s)}if(!t.formatOf3DObjects)throw new Oe.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==t.outFields||!t.outFields.includes("*")){t=t===w?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:s,originY:f,originZ:C,translationX:x,translationY:B,translationZ:G,scaleX:J,scaleY:X,scaleZ:Y,rotationX:ee,rotationY:H,rotationZ:le,rotationDeg:ae}=r.transformFieldRoles;t.outFields.push(s,f,C,x,B,G,J,X,Y,ee,H,le,ae)}}return t}(e,t),i=null!=e.outStatistics?.[0],c=(0,Ze.Z)("featurelayer-pbf-statistics"),s=!i||c;let f;if("pbf"===t?.format&&s)try{f=yield(0,Le.t)(w,l,n)}catch(C){if("query:parsing-pbf"!==C.name)throw C;t.format="json"}return"json"!==t?.format&&s||(f=yield(0,he.F)(w,l,n)),function Be(w,e){if(null!=w&&null!=e)for(const t of e){const r=w.get(t.name);r&&Object.assign(t,r.toJSON())}}(t?.fieldsIndex,f.fields),f})).apply(this,arguments)}function _e(){return(_e=(0,S.Z)(function*(w,e,t,r){const n=t?.infoFor3D;if(!be(w,n)||null==n||!e.assetMaps||!e.features?.length)return Ne.Z.fromJSON(e);const{meshFeatureSetFromJSON:l}=yield(0,Ae.Hl)(Promise.all([h.e(1716),h.e(4612),h.e(2859),h.e(6215),h.e(8592),h.e(7045)]).then(h.bind(h,17045)),r);return l(w,n,e)})).apply(this,arguments)}function be(w,e){return null!=e&&!0===w.returnGeometry&&"xyFootprint"!==w.multipatchOption&&!w.outStatistics}h(11931),h(57678),h(6785),h(85596),h(12768);var We=h(24859),Ke=(h(2189),h(93566),h(40485),h(49602),h(82921),h(61375)),Re=(h(10842),h(46556)),Ee=(h(89047),h(91085));class ce extends P.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return m.tI}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,m.hd)(e.toJSON());return(0,I.F)(t,I.M.String)}loadImpl(){var e=this;return(0,S.Z)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=m.Bj.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=m.Bj.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=m.Bj.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=m.Bj.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this._layer instanceof xe.default?(this.typeIdField=this._layer.subtypeField??"",this.types=this._layer.subtypes):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}_isInFeatureSet(){return m.dj.InFeatureSet}_refineSetBlock(e){return(0,S.Z)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,S.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,S.Z)(function*(){yield t._ensureLoaded();const r=new ie.Z;t.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(r),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){const t=this._layer?.capabilities?.query;return!e.outStatistics&&!0===t?.supportsFormatPBF&&!0===t?.supportsQuantizationEditMode}queryPBF(e){var t=this;return(0,S.Z)(function*(){return e.quantizationParameters={mode:"edit"},(yield function Me(w,e,t,r){return fe.apply(this,arguments)}(t._layer.parsedUrl,e,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){e.returnZ=this.hasZ,e.returnM=this.hasM;const r="execute"===t?he.e:"executeForCount"===t?We.P:Ke.G,n="execute"===t&&this.pbfSupportedForQuery(e);let l=null;if(this.recentlyUsedQueries){const i=this.convertQueryToLruCacheKey(e);l=this.recentlyUsedQueries.getFromCache(i),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(i,l),l=l.catch(c=>{throw this.recentlyUsedQueries?.removeFromCache(i),c}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e)),l}_getFilteredSet(e,t,r,n,l){var i=this;return(0,S.Z)(function*(){const c=yield i.databaseType();if(i.isTable()&&t&&null!==e&&""!==e)return new Z.Z([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,r,n,l);let s="",f=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),f=!0);const C=new ie.Z;i.datesInUnknownTimezone&&(C.timeReferenceUnknownClient=!0),C.where=null===r?null===t?"1=1":"":(0,b.zR)(r,c),i._requestStandardised&&(C.sqlFormat="standard"),C.spatialRelationship=i._makeRelationshipEnum(e),C.outSpatialReference=i.spatialReference,C.orderByFields=""!==s?s.split(","):null,C.geometry=null===t?null:t,C.relationParameter=i._makeRelationshipParam(e);let x=yield i.executeQuery(C,"executeForIds");return null===x&&(x=[]),i._checkCancelled(l),new Z.Z([],x,f,null)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getFilteredSetUsingPaging(e,t,r,n,l){var i=this;return(0,S.Z)(function*(){let c="",s=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(c=n.constructClause(),s=!0);const f=yield i.databaseType();let C=null===r?null===t?"1=1":"":(0,b.zR)(r,f);i._layer.definitionExpression&&i._useDefinitionExpression&&(C=""!==C?"(("+i._layer.definitionExpression+") AND ("+C+"))":i._layer.definitionExpression);let x=i._maxQueryRate();const B=i._layer.capabilities?.query.maxRecordCount;null!=B&&B<x&&(x=B);let G=null;if(!0===i._pageJustIds)G=new Z.Z([],["GETPAGES"],s,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:x,resultOffset:0,geometry:null===t?null:t,where:C,orderByFields:c,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let J=!0;!0===i._removeGeometry&&(J=!1);const X=i._overrideFields??i._fieldsIncludingObjectId(["*"]);G=new Z.Z([],["GETPAGES"],s,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:X.join(","),resultRecordCount:x,resultOffset:0,geometry:null===t?null:t,where:C,orderByFields:c,returnGeometry:J,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield i._expandPagedSet(G,x,0,1,l),G})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,i=l,c=e.pagesDefinition.internal.lastPage,s=new ie.Z;n._requestStandardised&&(s.sqlFormat="standard"),n.datesInUnknownTimezone&&(s.timeReferenceUnknownClient=!0),s.spatialRelationship=e.pagesDefinition.spatialRel,s.relationParameter=e.pagesDefinition.relationParam,s.outFields=e.pagesDefinition.outFields.split(","),s.num=e.pagesDefinition.resultRecordCount,s.start=e.pagesDefinition.internal.lastPage,s.geometry=e.pagesDefinition.geometry,s.where=e.pagesDefinition.where,s.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,s.returnGeometry=e.pagesDefinition.returnGeometry,s.outSpatialReference=n.spatialReference;const f=yield n.executeQuery(s,"execute");if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==c)return"done";const C=n._layer.objectIdField;for(let x=0;x<f.features.length;x++)e.pagesDefinition.internal.set[i+x]=f.features[x].attributes[C];if(!1===n._pageJustIds)for(let x=0;x<f.features.length;x++)n._featureCache[f.features[x].attributes[C]]=f.features[x];return(void 0===f.exceededTransferLimit&&f.features.length!==e.pagesDefinition.resultRecordCount||!1===f.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+f.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,n){var l=this;return(0,S.Z)(function*(){const i=[];if(-1!==t&&void 0===l._featureCache[t]&&i.push(t),!0===l._checkIfNeedToExpandKnownPage(e,l._maxProcessingRate()))return yield l._expandPagedSet(e,l._maxProcessingRate(),0,0,n),l._getFeatures(e,t,r,n);let c=0;for(let x=e._lastFetchedIndex;x<e._known.length;x++){if(e._lastFetchedIndex+=1,c++,void 0===l._featureCache[e._known[x]]){let B=!1;if(null!=l._layer._mode){const G=l._layer._mode;if(void 0!==G._featureMap[e._known[x]]){const J=G._featureMap[e._known[x]];null!==J&&(B=!0,l._featureCache[e._known[x]]=J)}}if(!1===B&&(e._known[x]!==t&&i.push(e._known[x]),i.length>=l._maxProcessingRate()-1))break}if(c>=r&&0===i.length)break}if(0===i.length)return"success";const s=new ie.Z;l._requestStandardised&&(s.sqlFormat="standard"),l.datesInUnknownTimezone&&(s.timeReferenceUnknownClient=!0),s.objectIds=i,s.outFields=l._overrideFields??l._fieldsIncludingObjectId(["*"]),s.returnGeometry=!0,!0===l._removeGeometry&&(s.returnGeometry=!1),s.outSpatialReference=l.spatialReference;const f=yield l.executeQuery(s,"execute");if(l._checkCancelled(n),void 0!==f.error)throw new F.EN(F.H9.RequestFailed,{reason:f.error});const C=l._layer.objectIdField;for(let x=0;x<f.features.length;x++)l._featureCache[f.features[x].attributes[C]]=f.features[x];return"success"})()}_getDistinctPages(e,t,r,n,l,i,c,s,f){var C=this;return(0,S.Z)(function*(){yield C._ensureLoaded();const x=yield C.databaseType();let B=r.parseTree.column;const G=C._layer.fields??[];for(let H=0;H<G.length;H++)if(G[H].name.toLowerCase()===B.toLowerCase()){B=G[H].name;break}const J=new ie.Z;C._requestStandardised&&(J.sqlFormat="standard"),C.datesInUnknownTimezone&&(J.timeReferenceUnknownClient=!0);let X=null===i?null===l?"1=1":"":(0,b.zR)(i,x);C._layer.definitionExpression&&C._useDefinitionExpression&&(X=""!==X?"(("+C._layer.definitionExpression+") AND ("+X+"))":C._layer.definitionExpression),J.where=X,J.spatialRelationship=C._makeRelationshipEnum(n),J.relationParameter=C._makeRelationshipParam(n),J.geometry=null===l?null:l,J.returnDistinctValues=!0,J.returnGeometry=!1,J.outFields=[B];const Y=yield C.executeQuery(J,"execute");if(C._checkCancelled(f),!Y.hasOwnProperty("features"))throw new F.EN(F.H9.InvalidStatResponse);let ee=!1;for(let H=0;H<G.length;H++)if(G[H].name===B){"date"===G[H].type&&(ee=!0);break}for(let H=0;H<Y.features.length;H++){if(ee){const le=Y.features[H].attributes[B];s.push(null!==le?new Date(le):le)}else s.push(Y.features[H].attributes[B]);if(s.length>=c)break}return 0===Y.features.length?s:Y.features.length===C._layer.capabilities?.query.maxRecordCount&&s.length<c?{calculated:!0,result:yield C._getDistinctPages(e+Y.features.length,t,r,n,l,i,c,s,f)}:s})()}_distinctStat(e,t,r,n,l,i,c){var s=this;return(0,S.Z)(function*(){return{calculated:!0,result:yield s._getDistinctPages(0,e,t,r,n,l,i,[],c)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,r,n){var l=this;return(0,S.Z)(function*(){const i=yield l.databaseType(),c=new ie.Z;if(l._requestStandardised&&(c.sqlFormat="standard"),l.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let s=null===n?null===r?"1=1":"":(0,b.zR)(n,i);return l._layer.definitionExpression&&l._useDefinitionExpression&&(s=""!==s?"(("+l._layer.definitionExpression+") AND ("+s+"))":l._layer.definitionExpression),c.where=s,l.datesInUnknownTimezone&&(c.timeReferenceUnknownClient=!0),c.where=s,c.spatialRelationship=l._makeRelationshipEnum(t),c.relationParameter=l._makeRelationshipParam(t),c.geometry=null===r?null:r,c.returnGeometry=!1,{calculated:!0,result:yield l.executeQuery(c,"executeForCount")}})()}_stats(e,t,r,n,l,i,c){var s=this;return(0,S.Z)(function*(){yield s._ensureLoaded();const f=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsSqlExpression,C=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsStatistics,x=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsDistinct;if("count"===e)return x?s._countstat(e,r,n,l):{calculated:!1};if(!1===C||!1===(0,b.y5)(t)&&!1===f||!1===t.isStandardized)return""!==r||null!==l?{calculated:!1}:s._manualStat(e,t,i,c);if("distinct"===e)return!1===x?""!==r||null!==l?{calculated:!1}:s._manualStat(e,t,i,c):s._distinctStat(e,t,r,n,l,i,c);const B=yield s.databaseType();if(s.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const G=new ie.Z;s._requestStandardised&&(G.sqlFormat="standard");let J=null===l?null===n?"1=1":"":(0,b.zR)(l,B);s._layer.definitionExpression&&s._useDefinitionExpression&&(J=""!==J?"(("+s._layer.definitionExpression+") AND ("+J+"))":s._layer.definitionExpression),G.where=J,G.spatialRelationship=s._makeRelationshipEnum(r),G.relationParameter=s._makeRelationshipParam(r),G.geometry=null===n?null:n,s.datesInUnknownTimezone&&(G.timeReferenceUnknownClient=!0);const X=new Ee.Z;X.statisticType=(0,L.g3)(e),X.onStatisticField=(0,b.zR)(t,B),X.outStatisticFieldName="ARCADE_STAT_RESULT",G.returnGeometry=!1;let Y="ARCADE_STAT_RESULT";G.outStatistics=[X];const ee=yield s.executeQuery(G,"execute");if(!ee.hasOwnProperty("features")||0===ee.features.length)throw new F.EN(F.H9.InvalidStatResponse);let H=!1;const le=ee.fields??[];for(let ae=0;ae<le.length;ae++)if("ARCADE_STAT_RESULT"===le[ae].name.toUpperCase()){Y=le[ae].name,"date"===le[ae].type&&(H=!0);break}if(H){let ae=ee.features[0].attributes[Y];return null!==ae&&(ae=new Date(ee.features[0].attributes[Y])),{calculated:!0,result:ae}}return{calculated:!0,result:ee.features[0].attributes[Y]}})()}_stat(e,t,r,n,l,i,c){return this._stats(e,t,r,n,l,i,c)}_canDoAggregates(e,t){var r=this;return(0,S.Z)(function*(){yield r._ensureLoaded();let n=!1;const l=r._layer.capabilities?.query,i=!0===l?.supportsSqlExpression;if(null!=l&&!0===l.supportsStatistics&&!0===l.supportsOrderBy&&(n=!0),n)for(let c=0;c<t.length-1;c++)(!1===t[c].workingexpr?.isStandardized||!1===(0,b.y5)(t[c].workingexpr)&&!1===i)&&(n=!1);return!1!==n})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,n,l,i,c){var s=this;return(0,S.Z)(function*(){yield s._ensureLoaded();const f=yield s.databaseType();let C="",x=!1,B=!1;null!==i&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(C=i.constructClause(),B=!0),s._layer.capabilities&&s._layer.capabilities.query&&!1===s._layer.capabilities.query.supportsPagination&&(B=!1,x=!0,C=s._layer.objectIdField);const G=[];for(let ee=0;ee<t.length;ee++){const H=new Ee.Z;H.onStatisticField=null!==t[ee].workingexpr?(0,b.zR)(t[ee].workingexpr,f):"",H.outStatisticFieldName=t[ee].field,H.statisticType=t[ee].toStatisticsName(),G.push(H)}""===C&&(C=e.join(","));let J=s._maxQueryRate();const X=s._layer.capabilities?.query.maxRecordCount;null!=X&&X<J&&(J=X);let Y=null===l?null===n?"1=1":"":(0,b.zR)(l,f);return s._layer.definitionExpression&&s._useDefinitionExpression&&(Y=""!==Y?"(("+s._layer.definitionExpression+") AND ("+Y+"))":s._layer.definitionExpression),new Z.Z([],["GETPAGES"],B,{groupbypage:!0,spatialRel:s._makeRelationshipEnum(r),relationParam:s._makeRelationshipParam(r),outFields:["*"],useOIDpagination:x,generatedOid:c,resultRecordCount:J,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:G,geometry:null===n?null:n,where:Y,orderByFields:C,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){let l=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(l=""!==l?"("+l+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const i=e.pagesDefinition.internal.lastRetrieved,c=i,s=e.pagesDefinition.internal.lastPage,f=new ie.Z;if(n._requestStandardised&&(f.sqlFormat="standard"),f.where=l,f.spatialRelationship=e.pagesDefinition.spatialRel,f.relationParameter=e.pagesDefinition.relationParam,f.outFields=e.pagesDefinition.outFields,f.outStatistics=e.pagesDefinition.outStatistics,f.geometry=e.pagesDefinition.geometry,f.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,f.num=e.pagesDefinition.resultRecordCount,f.start=e.pagesDefinition.internal.lastPage,f.returnGeometry=e.pagesDefinition.returnGeometry,n.datesInUnknownTimezone&&(f.timeReferenceUnknownClient=!0),f.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,n.isTable()&&f.geometry&&f.spatialRelationship)return[];const C=yield n.executeQuery(f,"execute");if(n._checkCancelled(r),!C.hasOwnProperty("features"))throw new F.EN(F.H9.InvalidStatResponse);const x=[];if(e.pagesDefinition.internal.lastPage!==s)return[];C.features.length>0&&void 0===C.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let B=0;B<C.features.length;B++)e.pagesDefinition.internal.set[c+B]=C.features[B].attributes[e.pagesDefinition.generatedOid];for(let B=0;B<C.features.length;B++)x.push(new M.Z({attributes:C.features[B].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===C.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=C.features[C.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===C.exceededTransferLimit&&C.features.length!==e.pagesDefinition.resultRecordCount||!1===C.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+C.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,x})()}static create(e,t,r,n,l){const i=new te.default({url:e,outFields:null===t?["*"]:t});return new ce({layer:i,spatialReference:r,lrucache:n,interceptor:l})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,m.US)(this._layer.parsedUrl.path)}queryAttachments(e,t,r,n,l){var i=this;return(0,S.Z)(function*(){const c=i._layer.capabilities;if(c?.data.supportsAttachment&&c?.operations.supportsQueryAttachments){const s={objectIds:[e],returnMetadata:l};(t&&t>0||r&&r>0)&&(s.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(s.attachmentTypes=n),i.featureSetQueryInterceptor&&i.featureSetQueryInterceptor.preLayerQueryCallback({layer:i._layer,query:s,method:"attachments"});const f=yield i._layer.queryAttachments(s),C=[];return f&&f[e]&&f[e].forEach(x=>{const B=i._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+x.id.toString();let G=null;l&&x.exifInfo&&(G=oe.Z.convertJsonToArcade(x.exifInfo,"system",!0)),C.push(new V.Z(x.id,x.name,x.contentType,x.size,B,G,x.keywords??null))}),C}return[]})()}queryRelatedFeatures(e){var t=this;return(0,S.Z)(function*(){const r={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(r.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(r.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(r.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(r.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(r.outSR=(0,se.B9)(e.outSpatialReference)),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:r,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const n=yield(0,z.Z)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});if(n.data){const l={},i=n.data;if(i?.relatedRecordGroups){const c=i.spatialReference;for(const s of i.relatedRecordGroups){const f=s.objectId,C=[];for(const x of s.relatedRecords){x.geometry&&(x.geometry.spatialReference=c);const B=new M.Z({geometry:x.geometry?(0,ue.im)(x.geometry):null,attributes:x.attributes});C.push(B)}l[f]={features:C,exceededTransferLimit:!0===i.exceededTransferLimit}}}return l}throw new F.EN(F.H9.InvalidRequest)})()}getFeatureByObjectId(e,t){var r=this;return(0,S.Z)(function*(){const n=new ie.Z;n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=r.spatialReference,n.where=r.objectIdField+"="+e.toString(),r.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),r.featureSetQueryInterceptor&&r.featureSetQueryInterceptor.preLayerQueryCallback({layer:r._layer,query:n,method:"execute"});const l=yield(0,he.e)(r._layer.parsedUrl.path,n);return 1===l.features.length?l.features[0]:null})()}getIdentityUser(){var e=this;return(0,S.Z)(function*(){yield e.load();const t=U.id?.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,S.Z)(function*(){yield e.load();const t=U.id?.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let r=e._layer.url;const n=r.toLowerCase().indexOf("/rest/services");if(r=n>-1?r.substring(0,n):r,r){r+="/rest/info";try{const l=yield(0,z.Z)(r,{query:{f:"json"}});let i="";return l.data?.owningSystemUrl&&(i=l.data.owningSystemUrl),i}catch{return""}}return""})()}getDataSourceFeatureSet(){const e=new ce({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,S.Z)(function*(){if(e.fsetInfo)return e.fsetInfo;let t=null,{parsedUrl:{path:r},serviceItemId:n=null}=e._layer;if(r){const i=yield(0,z.Z)(r,{responseType:"json",query:{f:"json"}});t=i?.data?.name??null,n=i?.data?.serviceItemId??null}const l=e._layer.title&&null!==(e._layer.parent??null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===t?null:t,itemId:""===n?null:n,serviceLayerUrl:""===r?null:r,webMapLayerId:l?e._layer.id??null:null,webMapLayerTitle:l?e._layer.title??null:null,className:null,objectClassId:null},e.fsetInfo})()}}var Qe=h(54339);class Ve extends P.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return m.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,S.Z)(function*(){return yield Promise.all([e._layer.load(),e._relatedLayer?.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],r=[];for(const n of this.fields)if("oid"===n.type)t.push(n),r.push(n.name);else for(const l of this._overrideFields)if(l.toLowerCase()===n.name.toLowerCase()){t.push(n),r.push(n.name);break}this.fields=t,this._overrideFields=r}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types}databaseType(){var e=this;return(0,S.Z)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return m.dj.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,S.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new M.Z({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,n,l){var i=this;return(0,S.Z)(function*(){if(yield i.databaseType(),i.isTable()&&t&&null!==e&&""!==e)return new Z.Z([],[],!0,null);const c=i._layer.nativeCapabilities();if(!1===c.canQueryRelated)return new Z.Z([],[],!0,null);if(c.capabilities?.queryRelated&&c.capabilities.queryRelated.supportsPagination)return i._getFilteredSetUsingPaging(e,t,r,n,l);let s="",f=!1;null!==n&&c.capabilities?.queryRelated&&!0===c.capabilities.queryRelated.supportsOrderBy&&(s=n.constructClause(),f=!0);const C=new Re.default;C.objectIds=[i._findObjectId];const x=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._relatedLayer.fields?i._relatedLayer.fields.map(H=>H.name):["*"]);C.outFields=x,C.relationshipId=i.relationship.id,C.where="1=1";let B=!0;!0===i._removeGeometry&&(B=!1),C.returnGeometry=B,i._requestStandardised&&(C.sqlFormat="standard"),C.outSpatialReference=i.spatialReference,C.orderByFields=""!==s?s.split(","):null;const G=yield c.source.queryRelatedFeatures(C);i._checkCancelled(l);const J=G[i._findObjectId]?G[i._findObjectId].features:[],X=[];for(let H=0;H<J.length;H++)i._featureCache[J[H].attributes[i._relatedLayer.objectIdField]]=J[H],X.push(J[H].attributes[i._relatedLayer.objectIdField]);const Y=t&&null!==e&&""!==e,ee=null!=r;return new Z.Z(Y||ee?X:[],Y||ee?[]:X,f,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,n,l){var i=this;return(0,S.Z)(function*(){let c="",s=!1;const f=i._layer.nativeCapabilities();null!==n&&f?.capabilities?.queryRelated&&!0===f.capabilities.queryRelated.supportsOrderBy&&(c=n.constructClause(),s=!0),yield i.databaseType();let x=i._maxQueryRate();const B=f.capabilities?.query.maxRecordCount;null!=B&&B<x&&(x=B);const G=t&&null!==e&&""!==e,J=null!=r;let X=null,Y=!0;!0===i._removeGeometry&&(Y=!1);const ee=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._relatedLayer.fields?i._relatedLayer.fields.map(H=>H.name):["*"]);return X=new Z.Z(G||J?["GETPAGES"]:[],G||J?[]:["GETPAGES"],s,{outFields:ee.join(","),resultRecordCount:x,resultOffset:0,objectIds:[i._findObjectId],where:"1=1",orderByFields:c,returnGeometry:Y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield i._expandPagedSet(X,x,0,0,l),X})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,i=l,c=e.pagesDefinition.internal.lastPage,s=n._layer.nativeCapabilities(),f=new Re.default;!0===n._requestStandardised&&(f.sqlFormat="standard"),f.relationshipId=n.relationship.id,f.objectIds=e.pagesDefinition.objectIds,f.resultOffset=e.pagesDefinition.internal.lastPage,f.resultRecordCount=e.pagesDefinition.resultRecordCount,f.outFields=e.pagesDefinition.outFields.split(","),f.where=e.pagesDefinition.where,f.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,f.returnGeometry=e.pagesDefinition.returnGeometry,f.outSpatialReference=n.spatialReference;const C=yield s.source.queryRelatedFeatures(f);if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==c)return 0;const x=C[n._findObjectId]?C[n._findObjectId].features:[];for(let G=0;G<x.length;G++)e.pagesDefinition.internal.set[i+G]=x[G].attributes[n._relatedLayer.objectIdField];for(let G=0;G<x.length;G++)n._featureCache[x[G].attributes[n._relatedLayer.objectIdField]]=x[G];return x.length!==e.pagesDefinition.resultRecordCount&&(!C[n._findObjectId]||!1===C[n._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+x.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,x.length})()}_getFeatures(e,t,r,n){var l=this;return(0,S.Z)(function*(){const i=[];-1!==t&&void 0===l._featureCache[t]&&i.push(t);const c=l._maxQueryRate();if(!0===l._checkIfNeedToExpandKnownPage(e,c))return yield l._expandPagedSet(e,c,0,0,n),l._getFeatures(e,t,r,n);let s=0;for(let f=e._lastFetchedIndex;f<e._known.length&&(s++,s<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[f]&&void 0===l._featureCache[e._known[f]]&&(e._known[f]!==t&&i.push(e._known[f]),i.length>r)))&&!(s>=r&&0===i.length);f++);if(0===i.length)return"success";throw new F.EN(F.H9.MissingFeatures)})()}_refineSetBlock(e,t,r){return(0,S.Z)(function*(){return e})()}_stat(e,t,r,n,l,i,c){return(0,S.Z)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,r,n,l){return(0,S.Z)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,l){return this._relatedLayer.queryAttachments(e,t,r,n,l)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,S.Z)(function*(){return e.fsetInfo??e._layer.featureSetInfo})()}}var $=h(19104),ze=h(27835);function Je(){null===$.Z.applicationCache&&($.Z.applicationCache=new $.Z)}function ye(w,e){return ge.apply(this,arguments)}function ge(){return(ge=(0,S.Z)(function*(w,e){if($.Z.applicationCache){const t=$.Z.applicationCache.getLayerInfo(w);if(t){const l=yield t;return new te.default({url:w,outFields:e,sourceJSON:l})}const r=new te.default({url:w,outFields:e}),n=(0,S.Z)(function*(){return yield r.load(),r.sourceJSON})();if($.Z.applicationCache){$.Z.applicationCache.setLayerInfo(w,n);try{return yield n,r}catch(l){throw $.Z.applicationCache.clearLayerInfo(w),l}}return yield n,r}return new te.default({url:w,outFields:e})})).apply(this,arguments)}function me(w,e,t,r,n){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,S.Z)(function*(w,e,t,r,n,l=null){return re(yield ye(w,["*"]),e,t,r,n,l)})).apply(this,arguments)}function re(w,e=null,t=null,r=!0,n=null,l=null){if(w instanceof te.default||(0,O.$)(w)){const c={layer:w,spatialReference:e,outFields:t,includeGeometry:r,lrucache:n,interceptor:l};return w.url||!w.source?new ce(c):new Qe.Z(c)}const i=re(w.parent,e,t,r,n,l);return i.filter(p.WhereClause.create(w.parent.subtypeField+"="+w.subtypeCode.toString(),w.parent.fieldsIndex,i.dateFieldsTimeZoneDefaultUTC))}function Se(){return(Se=(0,S.Z)(function*(w){if(null!==$.Z.applicationCache){const t=$.Z.applicationCache.getLayerInfo(w);if(null!==t)return t}const e=(0,S.Z)(function*(){const t=yield(0,z.Z)(w,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==$.Z.applicationCache){$.Z.applicationCache.setLayerInfo(w,e);try{return yield e}catch(t){throw $.Z.applicationCache.clearLayerInfo(w),t}}return e})).apply(this,arguments)}function Ie(){return(Ie=(0,S.Z)(function*(w,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+w;if(null!==$.Z.applicationCache){const n=$.Z.applicationCache.getLayerInfo(t);if(null!==n)return n}const r=(0,S.Z)(function*(){const n=yield(0,z.Z)(w+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(n.data){const l=n.data;if(l.layerDataElements?.[0])return l.layerDataElements[0]}throw new F.EN(F.H9.DataElementsNotFound)})();if(null!==$.Z.applicationCache){$.Z.applicationCache.setLayerInfo(t,r);try{return yield r}catch(n){throw $.Z.applicationCache.clearLayerInfo(t),n}}return r})).apply(this,arguments)}function Pe(w){return ve.apply(this,arguments)}function ve(){return(ve=(0,S.Z)(function*(w){if(null!==$.Z.applicationCache){const t=$.Z.applicationCache.getLayerInfo(w);if(null!==t)return t}const e=(0,S.Z)(function*(){const t=yield(0,z.Z)(w,{responseType:"json",query:{f:"json"}});if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),r}return{layers:[],tables:[]}})();if(null!==$.Z.applicationCache){$.Z.applicationCache.setLayerInfo(w,e);try{return yield e}catch(t){throw $.Z.applicationCache.clearLayerInfo(w),t}}return e})).apply(this,arguments)}function qe(w,e){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,S.Z)(function*(w,e){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},r=yield Pe(w);if(t.metadata=r,void 0!==r.controllerDatasetLayers?.utilityNetworkLayerId&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const i of r.layers)t.layerNameLkp[i.id]=i.name;if(r.tables)for(const i of r.tables)t.layerNameLkp[i.id]=i.name;const n=r.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=n;const l=yield function $e(w,e){return Ie.apply(this,arguments)}(w,n);if(l){t.queryelem=l,t.queryelem?.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const c of t.queryelem.dataElement.domainNetworks){for(const s of c.edgeSources??[]){const f={layerId:s.layerId,sourceId:s.sourceId,className:t.layerNameLkp[s.layerId]??null};f.className&&(t.lkp[f.className]=f)}for(const s of c.junctionSources??[]){const f={layerId:s.layerId,sourceId:s.sourceId,className:t.layerNameLkp[s.layerId]??null};f.className&&(t.lkp[f.className]=f)}}if(t.queryelem.dataElement.terminalConfigurations)for(const c of t.queryelem.dataElement.terminalConfigurations)for(const s of c.terminals)t.terminals.push({terminalId:s.terminalId,terminalName:s.terminalName});const i=yield function He(w){return Se.apply(this,arguments)}(w+"/"+n);if(void 0!==i.systemLayers?.associationsTableId&&null!==i.systemLayers.associationsTableId){const c=[];t.unVersion>=4&&(c.push("STATUS"),c.push("PERCENTALONG"));let s=yield me(w+"/"+i.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...c],!1,null,null);return yield s.load(),t.unVersion>=4&&(s=s.filter(p.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",s.getFieldsIndex(),s.dateFieldsTimeZoneDefaultUTC)),yield s.load()),{lkp:t.lkp,associations:s,unVersion:t.unVersion,terminals:t.terminals}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}),Ce.apply(this,arguments)}function Xe(w,e,t){return we.apply(this,arguments)}function we(){return(we=(0,S.Z)(function*(w,e,t,r=null,n=null,l=!0,i=null,c=null){let s=w.serviceUrl();if(!s)return null;s="/"===s.charAt(s.length-1)?s+e.relatedTableId.toString():s+"/"+e.relatedTableId.toString();const f=yield me(s,r,n,l,i,c);return new Ve({layer:w,relatedLayer:f,relationship:e,objectId:t,spatialReference:r,outFields:n,includeGeometry:l,lrucache:i,interceptor:c})})).apply(this,arguments)}A.Z.registerAction(),K.registerAction(),T.Z.registerAction(),W.Z.registerAction(),R.Z.registerAction();class Ye extends Q.Z{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=re(e,this._overridespref,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){var n=this;return(0,S.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let s=0;s<n._instantLayers.length;s++){const f=n._instantLayers[s];if(f.opitem.title===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[s].featureset}const i=[],c=n._map.allLayers.find(s=>{if(s instanceof te.default){if(s.title===e)return!0}else if((0,O.$)(s)){if(s.title===e)return!0;i.push(s)}return!1});if(c)return n._makeAndAddFeatureSet(c,t,r);if(n._map.tables){const s=n._map.tables.find(f=>!!(f.title&&f.title===e||f.title&&f.title===e));if(s){if(s instanceof te.default)return n._makeAndAddFeatureSet(s,t,r);if(!s._materializedTable){const f=s.outFields?s:{...s,outFields:["*"]};s._materializedTable=new te.default(f)}return yield s._materializedTable.load(),n._makeAndAddFeatureSet(s._materializedTable,t,r)}}for(const s of i){if("not-loaded"===s.loadStatus||"loading"===s.loadStatus)try{yield s.load()}catch{}const f=s.sublayers.find(C=>C.title===e);if(f)return n._makeAndAddFeatureSet(f,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let s=0;s<n._instantLayers.length;s++){const f=n._instantLayers[s];if(f.opitem.id===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[s].featureset}const i=[],c=n._map.allLayers.find(s=>{if(s instanceof te.default){if(s.id===e)return!0}else if((0,O.$)(s)){if(s.id===e)return!0;i.push(s)}return!1});if(c)return n._makeAndAddFeatureSet(c,t,r);if(n._map.tables){const s=n._map.tables.find(f=>f.id===e);if(s){if(s instanceof te.default)return n._makeAndAddFeatureSet(s,t,r);if(!s._materializedTable){const f={...s,outFields:["*"]};s._materializedTable=new te.default(f)}return yield s._materializedTable.load(),n._makeAndAddFeatureSet(s._materializedTable,t,r)}}for(const s of i){if("not-loaded"===s.loadStatus||"loading"===s.loadStatus)try{yield s.load()}catch{}const f=s.sublayers.find(C=>C.id===e);if(f)return n._makeAndAddFeatureSet(f,t,r)}return null})()}}class De extends Q.Z{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=re(e,this._overridespref,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){var e=this;return(0,S.Z)(function*(){const t=yield Pe(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new De(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,r=null){var n=this;return(0,S.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let s=0;s<n._instantLayers.length;s++){const f=n._instantLayers[s];if(f.opitem.title===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[s].featureset}const i=yield n._loadMetaData();let c=null;for(const s of i.layers??[])s.name===e&&(c=s);if(!c)for(const s of i.tables??[])s.name===e&&(c=s);if(c){const s=yield ye(n._url+"/"+c.id,["*"]);return n._makeAndAddFeatureSet(s,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);e=null!=e?e.toString():"";for(let s=0;s<n._instantLayers.length;s++){const f=n._instantLayers[s];if(f.opitem.id===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[s].featureset}const i=yield n._loadMetaData();let c=null;for(const s of i.layers??[])null!=s.id&&s.id.toString()===e&&(c=s);if(!c)for(const s of i.tables??[])null!=s.id&&s.id.toString()===e&&(c=s);if(c){const s=yield ye(n._url+"/"+c.id,["*"]);return n._makeAndAddFeatureSet(s,t,r)}return null})()}}function et(w,e,t=null,r=null){return new Ye(w,e,t,r)}function tt(w,e,t=null,r=null){return new De(w,e,t,r)}function rt(w,e,t,r,n){if(null===w)return null;if(w instanceof te.default){switch(e){case"datasource":return re(w,n,w.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return re(w,n,w.outFields,!0,t,r)}return null}if((0,O.$)(w)){switch(e){case"datasource":return re(w,n,w.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return re(w,n,w.outFields,!0,t,r)}return null}if((0,O.a0)(w)){switch(e){case"datasource":return re(w.parent,n,w.parent.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return re(w,n,w.parent.outFields,!0,t,r)}return null}if(w instanceof P.Z)switch(e){case"datasource":return w.getDataSourceFeatureSet();case"parent":return w;case"root":return w.getRootFeatureSet()}return null}function nt(w,e,t,r,n,l,i){return Te.apply(this,arguments)}function Te(){return(Te=(0,S.Z)(function*(w,e,t,r,n,l,i,c=null){if($.Z.applicationCache){const f=$.Z.applicationCache.getLayerInfo(w+":"+l.url);if(f){const C=yield f;return re(new te.default({url:(0,m.US)(C.url)+"/"+e,outFields:["*"]}),t,r,n,i,c)}}const s=new ze.default({id:w,portal:l}).load();$.Z.applicationCache&&$.Z.applicationCache.setLayerInfo(w+":"+l.url,s);try{const f=yield s;return re(new te.default({url:(0,m.US)(f.url??"")+"/"+e,outFields:["*"]}),t,r,n,i,c)}catch(f){throw $.Z.applicationCache&&$.Z.applicationCache.clearLayerInfo(w+":"+l.url),f}})).apply(this,arguments)}},94511:(ne,q,h)=>{h.d(q,{$X:()=>m,QP:()=>b,TO:()=>L,Xx:()=>E,yN:()=>p});var S=h(15861),z=h(35458),Q=h(25137),O=h(70930),A=h(95418),M=h(58446),j=h(76961),T=h(77023),F=h(51172),P=h(85904),Z=h(43814);class v{constructor(I){this.field=I,this.sqlRewritable=!1}postInitialization(I,d){}}class m extends v{constructor(I){super(I),this.sqlRewritable=!0}extractValue(I){return I.attributes[this.field.name]}rewriteSql(I){return{rewritten:this.sqlRewritable,where:I}}}class b extends v{constructor(I,d,y){super((0,j.JW)(I)),this.originalField=I,this.sqlRewritable=!0,this.field.name=d,this.field.alias=y}rewriteSql(I,d){return{rewritten:this.sqlRewritable,where:(0,T.bB)(I,this.field.name,this.originalField.name,d.getFieldsIndex())}}extractValue(I){return I.attributes[this.originalField.name]}}let L=(()=>{class D extends v{constructor(d,y,u){super(d),this.codefield=y,this.lkp=u,this.reverseLkp={};for(const g in u)this.reverseLkp[u[g]]=g;this.sqlRewritable=!0}rewriteSql(d,y){const u=this.evaluateNodeToWhereClause(d.parseTree,j.Bj.Standardised,this.field.name,this.codefield instanceof P.WhereClause?(0,T.zR)(this.codefield,j.Bj.Standardised):this.codefield,d.parameters);return u.includes(D.BADNESS)?{rewritten:!1,where:d}:{rewritten:this.sqlRewritable,where:P.WhereClause.create(u,y._parent.getFieldsIndex(),y.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(d,y,u=null,g=null,_){let N,k,K,W;switch(d.type){case"interval":return(0,T.TE)(this.evaluateNodeToWhereClause(d.value,y,u,g,_),d.qualifier,d.op);case"case-expression":{let R=" CASE ";"simple"===d.format&&(R+=this.evaluateNodeToWhereClause(d.operand,y,u,D.BADNESS,_));for(let U=0;U<d.clauses.length;U++)R+=" WHEN "+this.evaluateNodeToWhereClause(d.clauses[U].operand,y,u,D.BADNESS,_)+" THEN "+this.evaluateNodeToWhereClause(d.clauses[U].value,y,u,D.BADNESS,_);return null!==d.else&&(R+=" ELSE "+this.evaluateNodeToWhereClause(d.else,y,u,D.BADNESS,_)),R+=" END ",R}case"parameter":{const R=_[d.value.toLowerCase()];if("string"==typeof R)return"'"+R.toString().replaceAll("'","''")+"'";if((0,j.J_)(R)||(0,j.T4)(R))return(0,T.vn)(R,y);if((0,j._U)(R))return(0,T.wF)(R,y);if((0,j.NP)(R))return(0,T.mA)(R,y);if((0,j.$A)(R))return(0,T.av)(R,y);if(R instanceof Array){const U=[];for(let V=0;V<R.length;V++)"string"==typeof R[V]?U.push("'"+R[V].toString().replaceAll("'","''")+"'"):(0,j.J_)(R[V])||(0,j.T4)(R[V])?U.push((0,T.vn)(R[V],y)):(0,j._U)(R[V])?U.push((0,T.wF)(R[V],y)):(0,j.NP)(R[V])?U.push((0,T.mA)(R[V],y)):(0,j.$A)(R[V])?U.push((0,T.av)(R[V],y)):U.push(R[V].toString());return U}return R.toString()}case"expression-list":k=[];for(const R of d.value)k.push(this.evaluateNodeToWhereClause(R,y,u,g,_));return k;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(d.expr,y,u,D.BADNESS,_)+" ) ";case"binary-expression":switch(d.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" AND "+this.evaluateNodeToWhereClause(d.right,y,u,g,_)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" OR "+this.evaluateNodeToWhereClause(d.right,y,u,g,_)+") ";case"IS":if("null"!==d.right.type)throw new O.eS(O.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IS NULL )";case"ISNOT":if("null"!==d.right.type)throw new O.eS(O.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IS NOT NULL )";case"IN":if(N=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const R=[];let U=!0;for(const V of d.right.value){if("string"!==V.type){U=!1;break}if(void 0===this.lkp[V.value]){U=!1;break}R.push(this.lkp[V.value].toString())}if(U)return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+R.join(",")+")) "}return N=this.evaluateNodeToWhereClause(d.right,y,u,g,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+N.join(",")+")) "}return W=this.evaluateNodeToWhereClause(d.right,y,u,g,_),W instanceof Array?" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+W.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+W+")) ";case"NOT IN":if(N=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const R=[];let U=!0;for(const V of d.right.value){if("string"!==V.type){U=!1;break}if(void 0===this.lkp[V.value]){U=!1;break}R.push(this.lkp[V.value].toString())}if(U)return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+R.join(",")+")) "}return N=this.evaluateNodeToWhereClause(d.right,y,u,g,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+N.join(",")+")) "}return W=this.evaluateNodeToWhereClause(d.right,y,u,g,_),W instanceof Array?" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+W.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+W+")) ";case"BETWEEN":return K=this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" BETWEEN "+K[0]+" AND "+K[1]+" ) ";case"NOTBETWEEN":return K=this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" NOT BETWEEN "+K[0]+" AND "+K[1]+" ) ";case"LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") ";case"NOT LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") ";case"<>":case"=":if("column-reference"===d.left.type&&"string"===d.right.type){if(d.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[d.right.value.toString()])return" ("+g+" "+d.operator+" "+this.lkp[d.right.value.toString()].toString()+") "}else if("column-reference"===d.right.type&&"string"===d.left.type&&d.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[d.right.value.toString()].toString()+" "+d.operator+" "+g+") ";return" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") "}case"null":return"null";case"boolean":return!0===d.value?"1":"0";case"string":return"'"+d.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${d.value}'`;case"date":return`date '${d.value}'`;case"time":return`time '${d.value}'`;case"number":return d.value.toString();case"current-time":return(0,T.vR)("date"===d.mode,y);case"column-reference":return u&&u.toLowerCase()===d.column.toLowerCase()?"("+g+")":d.column;case"data-type":return d.value;case"function":{const R=this.evaluateNodeToWhereClause(d.args,y,u,D.BADNESS,_);return(0,T.fz)(d.name,R,y)}}throw new O.eS(O.f.UnsupportedSyntax,{node:d.type})}extractValue(d){return this.codefield instanceof P.WhereClause?this.reverseLkp[P.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(d))]:this.reverseLkp[d.attributes[this.codefield]]}}return D.BADNESS="_!!!_BAD_LKP_!!!!",D})();class p extends v{constructor(I,d){super(I),this._sql=d}rewriteSql(I,d){return{rewritten:!0,where:(0,T.bB)(I,this.field.name,(0,T.zR)(this._sql,j.Bj.Standardised),d.getFieldsIndex())}}extractValue(I){return P.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(I),this.field.type)}}class E extends A.Z{static findField(I,d){for(const y of I)if(y.name.toLowerCase()===d.toString().toLowerCase())return y;return null}constructor(I){super(I),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=I.extraFilter,this._parent=I.parentfeatureset,this._maxProcessing=30,this.adaptedFields=I.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new Z.Z({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=j.Qk.point,this.typeIdField="",this.types=null),this.fields=[];for(const I of this.adaptedFields)I.postInitialization(this,this._parent),this.fields.push(I.field)}_getSet(I){var d=this;return(0,S.Z)(function*(){if(null===d._wset){yield d._ensureLoaded();let y=null;return y=d._extraFilter?yield d._getFilteredSet("",null,null,null,I):yield d._parent?._getSet(I),d._checkCancelled(I),(0,F.O3)(y),d._wset=new M.Z(y._candidates.slice(0),y._known.slice(0),y._ordered,d._clonePageDefinition(y.pagesDefinition)),d._wset}return d._wset})()}_isInFeatureSet(I){return this._parent._isInFeatureSet(I)}_getFeatures(I,d,y,u){var g=this;return(0,S.Z)(function*(){const _=[];-1!==d&&void 0===g._featureCache[d]&&_.push(d);const N=g._maxQueryRate();if(!0===g._checkIfNeedToExpandKnownPage(I,N))return yield g._expandPagedSet(I,N,0,0,u),g._getFeatures(I,d,y,u);let k=0;for(let R=I._lastFetchedIndex;R<I._known.length&&(k++,k<=y&&(I._lastFetchedIndex+=1),!(void 0===g._featureCache[I._known[R]]&&(I._known[R]!==d&&_.push(I._known[R]),_.length>=N)));R++);if(0===_.length)return"success";I=new M.Z([],_,I._ordered,null);const K=Math.min(_.length,y);yield g._parent?._getFeatures(I,-1,K,u),g._checkCancelled(u);const W=[];for(let R=0;R<K;R++){const U=g._parent?._featureFromCache(_[R]);void 0!==U&&W.push({geometry:U.geometry,attributes:U.attributes,id:_[R]})}for(const R of W){const U=[];for(const V of g.adaptedFields)U[V.field.name]=V.extractValue(R);g._featureCache[R.id]=new z.Z({attributes:U,geometry:(0,Q.r1)(R.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,S.Z)(function*(){throw new O.EN(O.H9.NeverReach)})()}_getFilteredSet(I,d,y,u,g){var _=this;return(0,S.Z)(function*(){let N=!1;const k=_._reformulateWithoutAdaptions(y);N=k.cannot,y=k.where;let K=!1;if(null!==u){K=!0;const U=[];for(const V of _.adaptedFields)if(!(V instanceof m)&&!0===u.scanForField(V.field.name)){if(!(V instanceof b)){u=null,K=!1;break}U.push({field:V.field.name,newfield:V.originalField.name})}u&&U.length>0&&(u=u.replaceFields(U))}null!==y?null!==_._extraFilter&&(y=(0,T.$e)(_._extraFilter,y)):y=_._extraFilter,yield _._ensureLoaded();const W=yield _._parent._getFilteredSet(I,d,y,u,g);let R;return _._checkCancelled(g),R=!0===N?new M.Z(W._candidates.slice(0).concat(W._known.slice(0)),[],!0===K&&W._ordered,_._clonePageDefinition(W.pagesDefinition)):new M.Z(W._candidates.slice(0),W._known.slice(0),!0===K&&W._ordered,_._clonePageDefinition(W.pagesDefinition)),R})()}_reformulateWithoutAdaptions(I){const d={cannot:!1,where:I};if(null!==I)for(const y of this.adaptedFields)if(!0===(0,T.hq)(I,y.field.name)){const u=y.rewriteSql(I,this);if(!0!==u.rewritten){d.cannot=!0,d.where=null;break}d.where=u.where}return d}_stat(I,d,y,u,g,_,N){var k=this;return(0,S.Z)(function*(){let K=!1,W=k._reformulateWithoutAdaptions(d);if(K=W.cannot,d=W.where,W=k._reformulateWithoutAdaptions(g),K=K||W.cannot,null!==(g=W.where)?null!==k._extraFilter&&(g=(0,T.$e)(k._extraFilter,g)):g=k._extraFilter,!0===K)return null===g&&""===y&&null===u?k._manualStat(I,d,_,N):{calculated:!1};const R=yield k._parent._stat(I,d,y,u,g,_,N);return!1===R.calculated?null===g&&""===y&&null===u?k._manualStat(I,d,_,N):{calculated:!1}:R})()}_canDoAggregates(I,d,y,u,g){var _=this;return(0,S.Z)(function*(){if(null===_._parent)return!1;for(let K=0;K<I.length;K++)for(const W of _.adaptedFields)if(I[K].toLowerCase()===W.field.name.toLowerCase()&&!(W instanceof m))return!1;const N=[];for(let K=0;K<d.length;K++){const W=d[K];if(null!==W.workingexpr){const R=_._reformulateWithoutAdaptions(W.workingexpr);if(R.cannot)return!1;const U=W.clone();U.workingexpr=R.where,N.push(U)}else N.push(W)}const k=_._reformulateWithoutAdaptions(g);return!k.cannot&&(null!==(g=k.where)?null!==_._extraFilter&&(g=(0,T.$e)(_._extraFilter,g)):g=_._extraFilter,_._parent._canDoAggregates(I,N,y,u,g))})()}_getAggregatePagesDataSourceDefinition(I,d,y,u,g,_,N){var k=this;return(0,S.Z)(function*(){if(null===k._parent)throw new O.EN(O.H9.NeverReach);const K=[];for(let R=0;R<d.length;R++){const U=d[R];if(null!==U.workingexpr){const V=k._reformulateWithoutAdaptions(U.workingexpr);if(V.cannot)throw new O.EN(O.H9.NeverReach);const oe=U.clone();oe.workingexpr=V.where,K.push(oe)}else K.push(U)}const W=k._reformulateWithoutAdaptions(g);if(W.cannot)throw new O.EN(O.H9.NeverReach);return null!==(g=W.where)?null!==k._extraFilter&&(g=(0,T.$e)(k._extraFilter,g)):g=k._extraFilter,k._parent._getAggregatePagesDataSourceDefinition(I,K,y,u,g,_,N)})()}}},52034:(ne,q,h)=>{h.d(q,{Z:()=>P});var S=h(15861),z=h(70930),Q=h(95418),O=h(58446),A=h(76961),M=h(77023),j=h(79412),T=h(85904),F=h(43814);class P extends Q.Z{constructor(v){super(v),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=v.parentfeatureset,v.whereclause instanceof T.WhereClause?(this._whereclause=v.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=v.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new F.Z({wkid:4326}),this.geometryType=A.Qk.point)}_getSet(v){var m=this;return(0,S.Z)(function*(){if(null===m._wset){yield m._ensureLoaded();const b=yield m._parent._getFilteredSet("",null,m._whereclause,null,v);return m._checkCancelled(v),m._wset=null!==m._whereClauseFunction?new O.Z(b._candidates.slice(0).concat(b._known.slice(0)),[],b._ordered,m._clonePageDefinition(b.pagesDefinition)):new O.Z(b._candidates.slice(0),b._known.slice(0),b._ordered,m._clonePageDefinition(b.pagesDefinition)),m._wset}return m._wset})()}_isInFeatureSet(v){let m=this._parent?._isInFeatureSet(v);return m===A.dj.NotInFeatureSet?m:(m=this._idstates[v],void 0===m?A.dj.Unknown:m)}_getFeature(v,m,b){return this._parent._getFeature(v,m,b)}_getFeatures(v,m,b,L){return this._parent._getFeatures(v,m,b,L)}_featureFromCache(v){return this._parent._featureFromCache(v)}executeWhereClause(v){return this._whereclause?.testFeature(v)??!1}executeWhereClauseDeferred(v){var m=this;return(0,S.Z)(function*(){if(null!==m._whereClauseFunction){const b=m._whereClauseFunction(v);return(0,j.y8)(b),b}return m.executeWhereClause(v)})()}_fetchAndRefineFeatures(v,m,b){var L=this;return(0,S.Z)(function*(){const p=new O.Z([],v,!1,null),E=Math.min(m,v.length);if(yield L._parent?._getFeatures(p,-1,E,b),L._checkCancelled(b),null==L._whereClauseFunction){for(let I=0;I<E;I++){const d=L._parent?._featureFromCache(v[I]);L._idstates[v[I]]=!0===L.executeWhereClause(d)?A.dj.InFeatureSet:A.dj.NotInFeatureSet}return"success"}const D=[];for(let I=0;I<E;I++){const d=L._parent?._featureFromCache(v[I]);D.push(yield L.executeWhereClauseDeferred(d))}for(let I=0;I<m;I++)L._idstates[v[I]]=!0===D[I]?A.dj.InFeatureSet:A.dj.NotInFeatureSet;return"success"})()}_getFilteredSet(v,m,b,L,p){var E=this;return(0,S.Z)(function*(){null!==E._whereClauseFunction||(null!==b?null!==E._whereclause&&(b=(0,M.$e)(E._whereclause,b)):b=E._whereclause),yield E._ensureLoaded();const D=yield E._parent._getFilteredSet(v,m,b,L,p);let I;return E._checkCancelled(p),I=null!==E._whereClauseFunction?new O.Z(D._candidates.slice(0).concat(D._known.slice(0)),[],D._ordered,E._clonePageDefinition(D.pagesDefinition)):new O.Z(D._candidates.slice(0),D._known.slice(0),D._ordered,E._clonePageDefinition(D.pagesDefinition)),I})()}_stat(v,m,b,L,p,E,D){var I=this;return(0,S.Z)(function*(){if(null!==I._whereClauseFunction)return null===p&&""===b&&null===L?I._manualStat(v,m,E,D):{calculated:!1};let d=I._whereclause;null!==p&&null!==I._whereclause&&(d=(0,M.$e)(I._whereclause,p));const y=yield I._parent._stat(v,m,b,L,d,E,D);return!1===y.calculated?null===p&&""===b&&null===L?I._manualStat(v,m,E,D):{calculated:!1}:y})()}_canDoAggregates(v,m,b,L,p){var E=this;return(0,S.Z)(function*(){return null===E._whereClauseFunction&&(null!==p?null!==E._whereclause&&(p=(0,M.$e)(E._whereclause,p)):p=E._whereclause,null!==E._parent&&E._parent._canDoAggregates(v,m,b,L,p))})()}_getAggregatePagesDataSourceDefinition(v,m,b,L,p,E,D){var I=this;return(0,S.Z)(function*(){if(null===I._parent)throw new z.EN(z.H9.NeverReach);return null!==p?null!==I._whereclause&&(p=(0,M.$e)(I._whereclause,p)):p=I._whereclause,I._parent._getAggregatePagesDataSourceDefinition(v,m,b,L,p,E,D)})()}static registerAction(){Q.Z._featuresetFunctions.filter=function(v){if("function"==typeof v)return new P({parentfeatureset:this,whereclause:v});let m=null;return v instanceof T.WhereClause&&(m=v),new P({parentfeatureset:this,whereclause:m})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},11375:(ne,q,h)=>{h.d(q,{Z:()=>j});var S=h(15861),z=h(89018),Q=h(70930),O=h(95418),A=h(58446),M=h(25677);class j extends O.Z{constructor(F){super(F),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=F.orderbyclause,this._parent=F.parentfeatureset}_getSet(F){var P=this;return(0,S.Z)(function*(){if(null===P._wset){yield P._ensureLoaded();const Z=yield P._getFilteredSet("",null,null,P._orderbyclause,F);return P._checkCancelled(F),P._wset=Z,P._wset}return P._wset})()}manualOrderSet(F,P){var Z=this;return(0,S.Z)(function*(){const v=yield Z.getIdColumnDictionary(F,[],-1,P);Z._orderbyclause?.order(v);const m=new A.Z([],[],!0,null);for(let b=0;b<v.length;b++)m._known.push(v[b].id);return m})()}getIdColumnDictionary(F,P,Z,v){var m=this;return(0,S.Z)(function*(){if(Z<F._known.length-1){const b=m._maxQueryRate();if("GETPAGES"===F._known[Z+1])return yield(0,z.a1)(m._parent._expandPagedSet(F,b,0,0,v)),m.getIdColumnDictionary(F,P,Z,v);let L=Z+1;const p=[];for(;L<F._known.length&&"GETPAGES"!==F._known[L];)p.push(F._known[L]),L++;Z+=p.length;const E=yield(0,z.a1)(m._parent._getFeatureBatch(p,v));m._checkCancelled(v);for(const D of E)P.push({id:D.attributes[m.objectIdField],feature:D});return m.getIdColumnDictionary(F,P,Z,v)}return F._candidates.length>0?(yield(0,z.a1)(m._refineSetBlock(F,m._maxProcessingRate(),v)),m._checkCancelled(v),m.getIdColumnDictionary(F,P,Z,v)):P})()}_isInFeatureSet(F){return this._parent._isInFeatureSet(F)}_getFeatures(F,P,Z,v){return this._parent._getFeatures(F,P,Z,v)}_featureFromCache(F){if(void 0===this._featureCache[F]){const P=this._parent._featureFromCache(F);return void 0===P?void 0:null===P?null:(this._featureCache[F]=P,P)}return this._featureCache[F]}_fetchAndRefineFeatures(){return(0,S.Z)(function*(){throw new Q.EN(Q.H9.NeverReach)})()}_getFilteredSet(F,P,Z,v,m){var b=this;return(0,S.Z)(function*(){yield b._ensureLoaded();const L=yield b._parent._getFilteredSet(F,P,Z,null===v?b._orderbyclause:v,m);b._checkCancelled(m);const p=new A.Z(L._candidates.slice(0),L._known.slice(0),L._ordered,b._clonePageDefinition(L.pagesDefinition));let E=!0;if(L._candidates.length>0&&(E=!1),!1===p._ordered){let D=yield b.manualOrderSet(p,m);return!1===E&&(null===P&&null===Z||(D=new A.Z(D._candidates.slice(0).concat(D._known.slice(0)),[],D._ordered,b._clonePageDefinition(D.pagesDefinition)))),D}return p})()}static registerAction(){O.Z._featuresetFunctions.orderBy=function(F){return""===F?this:new j({parentfeatureset:this,orderbyclause:new M.Z(F)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},92224:(ne,q,h)=>{h.d(q,{Z:()=>M});var S=h(15861),z=h(70930),Q=h(95418),O=h(58446),A=h(76961);class M extends Q.Z{constructor(T){super(T),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=T.topnum,this._parent=T.parentfeatureset}_getSet(T){var F=this;return(0,S.Z)(function*(){if(null===F._wset){yield F._ensureLoaded();const P=yield F._parent._getSet(T);return F._wset=new O.Z(P._candidates.slice(0),P._known.slice(0),!1,F._clonePageDefinition(P.pagesDefinition)),F._setKnownLength(F._wset)>F._topnum&&(F._wset._known=F._wset._known.slice(0,F._topnum)),F._setKnownLength(F._wset)>=F._topnum&&(F._wset._candidates=[]),F._wset}return F._wset})()}_setKnownLength(T){return T._known.length>0&&"GETPAGES"===T._known[T._known.length-1]?T._known.length-1:T._known.length}_isInFeatureSet(T){const F=this._parent._isInFeatureSet(T);if(F===A.dj.NotInFeatureSet)return F;const P=this._idstates[T];return P===A.dj.InFeatureSet||P===A.dj.NotInFeatureSet?P:F===A.dj.InFeatureSet&&void 0===P?this._countedin<this._topnum?(this._idstates[T]=A.dj.InFeatureSet,this._countedin++,A.dj.InFeatureSet):(this._idstates[T]=A.dj.NotInFeatureSet,A.dj.NotInFeatureSet):A.dj.Unknown}_expandPagedSet(T,F,P,Z,v){var m=this;return(0,S.Z)(function*(){if(null===m._parent)throw new z.EN(z.H9.NotImplemented);if(F>m._topnum&&(F=m._topnum),m._countedin>=m._topnum&&T.pagesDefinition.internal.set.length<=T.pagesDefinition.resultOffset){let L=T._known.length;return L>0&&"GETPAGES"===T._known[L-1]&&(T._known.length=L-1),L=T._candidates.length,L>0&&"GETPAGES"===T._candidates[L-1]&&(T._candidates.length=L-1),"success"}const b=yield m._parent._expandPagedSet(T,F,P,Z,v);return m._setKnownLength(T)>m._topnum&&(T._known.length=m._topnum),m._setKnownLength(T)>=m._topnum&&(T._candidates.length=0),b})()}_getFeatures(T,F,P,Z){var v=this;return(0,S.Z)(function*(){const m=[],b=v._maxQueryRate();if(!0===v._checkIfNeedToExpandKnownPage(T,b))return yield v._expandPagedSet(T,b,0,0,Z),v._getFeatures(T,F,P,Z);-1!==F&&void 0===v._featureCache[F]&&m.push(F);let L=0;for(let D=T._lastFetchedIndex;D<T._known.length&&(L++,L<=P&&(T._lastFetchedIndex+=1),!(void 0===v._featureCache[T._known[D]]&&(T._known[D]!==F&&m.push(T._known[D]),m.length>b)));D++);if(0===m.length)return"success";const p=new O.Z([],m,!1,null),E=Math.min(m.length,P);yield v._parent._getFeatures(p,-1,E,Z);for(let D=0;D<E;D++){const I=v._parent._featureFromCache(m[D]);void 0!==I&&(v._featureCache[m[D]]=I)}return"success"})()}_getFilteredSet(T,F,P,Z,v){var m=this;return(0,S.Z)(function*(){yield m._ensureLoaded();const b=yield m._getSet(v);return new O.Z(b._candidates.slice(0).concat(b._known.slice(0)),[],!1,m._clonePageDefinition(b.pagesDefinition))})()}_refineKnowns(T,F){let P=0,Z=null;const v=[];for(let m=0;m<T._candidates.length;m++){const b=this._isInFeatureSet(T._candidates[m]);if(b===A.dj.InFeatureSet){if(T._known.push(T._candidates[m]),P+=1,null===Z?Z={start:m,end:m}:Z.end===m-1?Z.end=m:(v.push(Z),Z={start:m,end:m}),T._known.length>=this._topnum)break}else if(b===A.dj.NotInFeatureSet)null===Z?Z={start:m,end:m}:Z.end===m-1?Z.end=m:(v.push(Z),Z={start:m,end:m}),P+=1;else if(b===A.dj.Unknown)break;if(P>=F)break}null!==Z&&v.push(Z);for(let m=v.length-1;m>=0;m--)T._candidates.splice(v[m].start,v[m].end-v[m].start+1);this._setKnownLength(T)>this._topnum&&(T._known=T._known.slice(0,this._topnum)),this._setKnownLength(T)>=this._topnum&&(T._candidates=[])}_stat(){return(0,S.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,S.Z)(function*(){return!1})()}static registerAction(){Q.Z._featuresetFunctions.top=function(T){return new M({parentfeatureset:this,topnum:T})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},54339:(ne,q,h)=>{h.d(q,{Z:()=>b});var S=h(15861),z=h(35458),Q=h(70930),O=h(95418),A=h(58446),M=h(76961),j=h(77023),T=h(32184),F=h(90373),P=h(46663),Z=h(50243),v=h(81247),m=h(91866);class b extends O.Z{constructor(p){super(p),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,p.spatialReference&&(this.spatialReference=p.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=p.layer,this._wset=null,!0===p.isTable&&(this._forceIsTable=!0),void 0!==p.outFields&&(this._overrideFields=p.outFields),void 0!==p.includeGeometry&&(this._removeGeometry=!1===p.includeGeometry)}_maxQueryRate(){return M.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var p=this;return(0,S.Z)(function*(){return!0===p._layer.loaded?(p._initialiseFeatureSet(),p):(yield p._layer.load(),p._initialiseFeatureSet(),p)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const p=[],E=[];for(const D of this.fields)if("oid"===D.type)p.push(D),E.push(D.name);else for(const I of this._overrideFields)if(I.toLowerCase()===D.name.toLowerCase()){p.push(D),E.push(D.name);break}this.fields=p,this._overrideFields=E}this.objectIdField=this._layer.objectIdField;for(const p of this.fields)"global-id"===p.type&&(this.globalIdField=p.name);this._databaseType=M.Bj.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this._layer instanceof P.default?(this.typeIdField=this._layer.subtypeField??"",this.types=this._layer.subtypes):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return M.dj.InFeatureSet}_candidateIdTransform(p){return p}_getSet(p){var E=this;return(0,S.Z)(function*(){if(null===E._wset){yield E._ensureLoaded();const D=yield E._getFilteredSet("",null,null,null,p);return E._wset=D,D}return E._wset})()}_changeFeature(p){const E={};for(const D of this.fields)E[D.name]=p.attributes[D.name];return new z.Z({geometry:!0===this._removeGeometry?null:p.geometry,attributes:E})}_getFilteredSet(p,E,D,I,d){var y=this;return(0,S.Z)(function*(){let u="",g=!1;if(null!==I&&(u=I.constructClause(),g=!0),y.isTable()&&E&&null!==p&&""!==p)return new A.Z([],[],!0,null);const _=new m.Z;_.returnZ=y.hasZ,_.returnM=y.hasM,_.where=null===D?null===E?"1=1":"":(0,j.zR)(D,M.Bj.Standardised),_.spatialRelationship=y._makeRelationshipEnum(p),_.outSpatialReference=y.spatialReference,_.orderByFields=""!==u?u.split(","):null,_.geometry=null===E?null:E,_.returnGeometry=!0,_.relationParameter=y._makeRelationshipParam(p);const N=yield y._layer.queryFeatures(_);if(null===N)return new A.Z([],[],g,null);y._checkCancelled(d);const k=[];return N.features.forEach(K=>{const W=K.attributes[y._layer.objectIdField];k.push(W),y._featureCache[W]=y._changeFeature(K)}),new A.Z([],k,g,null)})()}_makeRelationshipEnum(p){if(p.includes("esriSpatialRelRelation"))return"relation";switch(p){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return p}_makeRelationshipParam(p){return p.includes("esriSpatialRelRelation")?p.split(":")[1]:""}_queryAllFeatures(){var p=this;return(0,S.Z)(function*(){if(p._wset)return p._wset;const E=new m.Z;if(E.where="1=1",yield p._ensureLoaded(),p._layer.source&&p._layer.source.items){const d=[];return p._layer.source.items.forEach(y=>{const u=y.attributes[p._layer.objectIdField];d.push(u),p._featureCache[u]=p._changeFeature(y)}),p._wset=new A.Z([],d,!1,null),p._wset}E.returnZ=p.hasZ,E.returnM=p.hasM;const D=yield p._layer.queryFeatures(E),I=[];return D.features.forEach(d=>{const y=d.attributes[p._layer.objectIdField];I.push(y),p._featureCache[y]=p._changeFeature(d)}),p._wset=new A.Z([],I,!1,null),p._wset})()}_getFeatures(p,E,D){var I=this;return(0,S.Z)(function*(){const d=[];-1!==E&&void 0===I._featureCache[E]&&d.push(E);for(let y=p._lastFetchedIndex;y<p._known.length&&(p._lastFetchedIndex+=1,!(void 0===I._featureCache[p._known[y]]&&(p._known[y]!==E&&d.push(p._known[y]),d.length>D)));y++);if(0===d.length)return"success";throw new Q.EN(Q.H9.MissingFeatures)})()}_refineSetBlock(p){return(0,S.Z)(function*(){return p})()}_stat(){return(0,S.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,S.Z)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(p){const E={};for(const D in p)E[D]=p[D];return E}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(p,E){let D=p.layerDefinition.objectIdField;const I=p.layerDefinition.typeIdField??"",d=[];if(p.layerDefinition.types)for(const R of p.layerDefinition.types)d.push(Z.Z.fromJSON(R));let y=p.layerDefinition.geometryType;void 0===y&&(y=p.featureSet.geometryType||"");let u=p.featureSet.features;const g=E.toJSON();if(!D){let R=!1;for(const U of p.layerDefinition.fields)if("oid"===U.type||"esriFieldTypeOID"===U.type){D=U.name,R=!0;break}if(!1===R){let U="FID",V=!0,oe=0;for(;V;){let se=!0;for(const te of p.layerDefinition.fields)if(te.name===U){se=!1;break}!0===se?V=!1:(oe++,U="FID"+oe.toString())}p.layerDefinition.fields.push({type:"esriFieldTypeOID",name:U,alias:U});const ue=[];for(let se=0;se<u.length;se++)ue.push({geometry:p.featureSet.features[se].geometry,attributes:p.featureSet.features[se].attributes?this._cloneAttr(p.featureSet.features[se].attributes):{}}),ue[se].attributes[U]=se;u=ue,D=U}}const _=[];for(const R of p.layerDefinition.fields)_.push(R instanceof v.Z?R:v.Z.fromJSON(R));let N=y;switch(N||(N=""),N){case"esriGeometryPoint":N="point";break;case"esriGeometryPolyline":N="polyline";break;case"esriGeometryPolygon":N="polygon";break;case"esriGeometryEnvelope":N="extent";break;case"esriGeometryMultipoint":N="multipoint";break;case"":case"esriGeometryNull":N="esriGeometryNull"}if("esriGeometryNull"!==N)for(const R of u)R.geometry&&!(R.geometry instanceof T.Z)&&(R.geometry.type=N,void 0===R.geometry.spatialReference&&(R.geometry.spatialReference=g));else for(const R of u)R.geometry&&(R.geometry=null);const k={outFields:["*"],source:u,fields:_,hasZ:!0===p?.layerDefinition?.hasZ||!0===p?.featureSet?.hasZ,hasM:!0===p?.layerDefinition?.hasM||!0===p?.featureSet?.hasM,types:d,typeIdField:I,objectIdField:D,spatialReference:E},K="esriGeometryNull"===N||null===N;K||(k.geometryType=N);const W=new F.default(k);return new b({layer:W,spatialReference:E,isTable:K})}queryAttachments(){return(0,S.Z)(function*(){return[]})()}getFeatureByObjectId(p){var E=this;return(0,S.Z)(function*(){const D=new m.Z;D.where=E.objectIdField+"="+p.toString(),D.returnZ=E.hasZ,D.returnM=E.hasM;const I=yield E._layer.queryFeatures(D);return 1===I.features.length?I.features[0]:null})()}getOwningSystemUrl(){return(0,S.Z)(function*(){return""})()}getIdentityUser(){return(0,S.Z)(function*(){return""})()}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer?.datesInUnknownTimezone}get editFieldsInfo(){return this._layer?.editFieldsInfo}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var p=this;return(0,S.Z)(function*(){const E=p._layer.title&&p._layer.parent;return p.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:E?p._layer.id??null:null,webMapLayerTitle:E?p._layer.title??null:null,className:null,objectClassId:null}})()}}},25677:(ne,q,h)=>{function S(Q,O){return Q===O?0:null===Q?-1:null===O?1:Q<O?-1:1}h.d(q,{Z:()=>z});class z{constructor(O){const A=O.split(",");this._fields=[],this._directions=[];for(let M=0;M<A.length;M++){const j=A[M].match(/\S+/g);this._fields.push(j[0]),2===j.length?"asc"===j[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let O="";for(let A=0;A<this._fields.length;A++)0!==A&&(O+=","),O+=this._fields[A],O+=1===this._directions[A]?" ASC":" DESC";return O}order(O){O.sort((A,M)=>{for(let j=0;j<this._fields.length;j++){const T=this.featureValue(A.feature,this._fields[j],j),F=this.featureValue(M.feature,this._fields[j],j);let P=0;if(P=1===this._directions[j]?S(T,F):-1*S(T,F),0!==P)return P}return 0})}scanForField(O){for(let A=0;A<this._fields.length;A++)if(this._fields[A].toLowerCase().trim()===O.toLowerCase().trim())return!0;return!1}replaceFields(O){let A="";for(let M=0;M<this._fields.length;M++){0!==M&&(A+=",");let j=this._fields[M];for(const T of O)if(j.toLowerCase()===T.field.toLowerCase()){j=T.newfield;break}A+=j,A+=1===this._directions[M]?" ASC":" DESC"}return new z(A)}featureValue(O,A,M){const j=O.attributes[A];if(void 0!==j)return j;for(const T in O.attributes)if(A.toLowerCase()===T.toLowerCase())return this._fields[M]=T,O.attributes[T];return null}}},24859:(ne,q,h)=>{h.d(q,{P:()=>A});var S=h(15861),z=h(15462),Q=h(82784),O=h(91866);function A(j,T,F){return M.apply(this,arguments)}function M(){return(M=(0,S.Z)(function*(j,T,F){const P=(0,z.en)(j);return(0,Q.hH)(P,O.Z.from(T),{...F}).then(Z=>Z.data.count)})).apply(this,arguments)}},61375:(ne,q,h)=>{h.d(q,{G:()=>A});var S=h(15861),z=h(15462),Q=h(82784),O=h(91866);function A(j,T,F){return M.apply(this,arguments)}function M(){return(M=(0,S.Z)(function*(j,T,F){const P=(0,z.en)(j);return(0,Q.Ev)(P,O.Z.from(T),{...F}).then(Z=>Z.data.objectIds)})).apply(this,arguments)}},46708:(ne,q,h)=>{h.d(q,{F:()=>T,e:()=>M});var S=h(15861),z=h(15462),Q=h(82784),O=h(93792),A=h(91866);function M(P,Z,v){return j.apply(this,arguments)}function j(){return(j=(0,S.Z)(function*(P,Z,v){const m=yield T(P,Z,v);return O.Z.fromJSON(m)})).apply(this,arguments)}function T(P,Z,v){return F.apply(this,arguments)}function F(){return(F=(0,S.Z)(function*(P,Z,v){const m=(0,z.en)(P),b={...v},L=A.Z.from(Z),{data:p}=yield(0,Q.JT)(m,L,L.sourceSpatialReference,b);return p})).apply(this,arguments)}},36026:(ne,q,h)=>{h.d(q,{t:()=>I});var S=h(15861),z=h(15462),Q=h(51172),O=h(53456),A=h(10842);function M(y,u){return u}function j(y,u,g,_){switch(g){case 0:return Z(y,u+_,0);case 1:return"lowerLeft"===y.originPosition?Z(y,u+_,1):function v({translate:y,scale:u},g,_){return y[_]-g*u[_]}(y,u+_,1)}}function T(y,u,g,_){return 2===g?Z(y,u,2):j(y,u,g,_)}function F(y,u,g,_){return 2===g?Z(y,u,3):j(y,u,g,_)}function P(y,u,g,_){return 3===g?Z(y,u,3):T(y,u,g,_)}function Z({translate:y,scale:u},g,_){return y[_]+g*u[_]}class m{constructor(u){this._options=u,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=M,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(u){if(this._options.applyTransform&&(u.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!u.hasZ)return;const g=(0,O.k)(u.geometryType,this._options.sourceSpatialReference,u.spatialReference);if(null!=g)for(const _ of u.features)g(_.geometry)}createSpatialReference(){return{}}addField(u,g){const _=u.fields;(0,Q.O3)(_),_.push(g);const N=_.map(k=>k.name);this._attributesConstructor=function(){for(const k of N)this[k]=null}}addFeature(u,g){u.features.push(g)}prepareFeatures(u){switch(this._transform=u.transform,this._options.applyTransform&&u.transform&&(this._applyTransform=this._deriveApplyTransform(u)),this._vertexDimension=2,u.hasZ&&this._vertexDimension++,u.hasM&&this._vertexDimension++,u.geometryType){case"esriGeometryPoint":this.addCoordinate=(g,_,N)=>this.addCoordinatePoint(g,_,N),this.createGeometry=g=>this.createPointGeometry(g);break;case"esriGeometryPolygon":this.addCoordinate=(g,_,N)=>this._addCoordinatePolygon(g,_,N),this.createGeometry=g=>this._createPolygonGeometry(g);break;case"esriGeometryPolyline":this.addCoordinate=(g,_,N)=>this._addCoordinatePolyline(g,_,N),this.createGeometry=g=>this._createPolylineGeometry(g);break;case"esriGeometryMultipoint":this.addCoordinate=(g,_,N)=>this._addCoordinateMultipoint(g,_,N),this.createGeometry=g=>this._createMultipointGeometry(g)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(u,g,_){0===this._lengths.length&&(this._toAddInCurrentPath=g),this._lengths.push(g)}addQueryGeometry(u,g){const{queryGeometry:_,queryGeometryType:N}=g,k=(0,A.$g)(_.clone(),_,!1,!1,this._transform),K=(0,A.di)(k,N,!1,!1);u.queryGeometryType=N,u.queryGeometry={...K}}createPointGeometry(u){const g={x:0,y:0,spatialReference:u.spatialReference};return u.hasZ&&(g.z=0),u.hasM&&(g.m=0),g}addCoordinatePoint(u,g,_){switch(g=this._applyTransform(this._transform,g,_,0),_){case 0:u.x=g;break;case 1:u.y=g;break;case 2:"z"in u?u.z=g:u.m=g;break;case 3:u.m=g}}_transformPathLikeValue(u,g){let _=0;return g<=1&&(_=this._previousCoordinate[g],this._previousCoordinate[g]+=u),this._applyTransform(this._transform,u,g,_)}_addCoordinatePolyline(u,g,_){this._dehydratedAddPointsCoordinate(u.paths,g,_)}_addCoordinatePolygon(u,g,_){this._dehydratedAddPointsCoordinate(u.rings,g,_)}_addCoordinateMultipoint(u,g,_){0===_&&u.points.push([]);const N=this._transformPathLikeValue(g,_);u.points[u.points.length-1].push(N)}_createPolygonGeometry(u){return{rings:[[]],spatialReference:u.spatialReference,hasZ:!!u.hasZ,hasM:!!u.hasM}}_createPolylineGeometry(u){return{paths:[[]],spatialReference:u.spatialReference,hasZ:!!u.hasZ,hasM:!!u.hasM}}_createMultipointGeometry(u){return{points:[],spatialReference:u.spatialReference,hasZ:!!u.hasZ,hasM:!!u.hasM}}_dehydratedAddPointsCoordinate(u,g,_){0===_&&0==this._toAddInCurrentPath--&&(u.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const N=this._transformPathLikeValue(g,_),k=u[u.length-1];0===_&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),k.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=N}_deriveApplyTransform(u){const{hasZ:g,hasM:_}=u;return g&&_?P:g?T:_?F:j}}var b=h(82784),p=(h(93792),h(91866));function I(y,u,g){return d.apply(this,arguments)}function d(){return(d=(0,S.Z)(function*(y,u,g){const _=(0,z.en)(y),N={...g},k=p.Z.from(u),K=!k.quantizationParameters,{data:W}=yield(0,b.qp)(_,k,new m({sourceSpatialReference:k.sourceSpatialReference,applyTransform:K}),N);return W})).apply(this,arguments)}},85596:(ne,q,h)=>{h.d(q,{Z:()=>m});var P,S=h(50484),z=h(89317),Q=h(80543),O=h(1535),j=(h(57678),h(14007),h(10141));const Z={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let v=P=class extends z.wq{constructor(b){super(b),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:b}=this,L=function T(b){const{exifInfo:L,exifName:p,tagName:E}=b;if(!L||!p||!E)return null;const D=L.find(I=>I.name===p);return D?function F(b){const{tagName:L,tags:p}=b;return p&&L&&p.find(D=>D.name===L)?.value||null}({tagName:E,tags:D.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:b});return Z[L]||null}clone(){return new P({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"contentType",void 0),(0,S._)([(0,Q.Cb)()],v.prototype,"exifInfo",void 0),(0,S._)([(0,Q.Cb)({readOnly:!0})],v.prototype,"orientationInfo",null),(0,S._)([(0,Q.Cb)({type:O.z8})],v.prototype,"id",void 0),(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"globalId",void 0),(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"keywords",void 0),(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"name",void 0),(0,S._)([(0,Q.Cb)({json:{read:!1}})],v.prototype,"parentGlobalId",void 0),(0,S._)([(0,Q.Cb)({json:{read:!1}})],v.prototype,"parentObjectId",void 0),(0,S._)([(0,Q.Cb)({type:O.z8})],v.prototype,"size",void 0),(0,S._)([(0,Q.Cb)({json:{read:!1}})],v.prototype,"url",void 0),v=P=(0,S._)([(0,j.j)("esri.layers.support.AttachmentInfo")],v);const m=v}}]);