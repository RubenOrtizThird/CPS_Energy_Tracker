"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[8866,5251],{60084:($,O,o)=>{o.d(O,{D:()=>p});var c=o(26496);function p(S){S?.writtenProperties&&S.writtenProperties.forEach(({target:m,propName:x,newOrigin:v})=>{(0,c.l)(m)&&v&&m.originOf(x)!==v&&m.updateOrigin(x,v)})}},26496:($,O,o)=>{function c(p){return p&&"getAtOrigin"in p&&"originOf"in p}o.d(O,{l:()=>c})},38866:($,O,o)=>{o.d(O,{xp:()=>J,Vt:()=>G});var c=o(15861),p=o(50484),S=o(66476),m=o(57964),x=o(4703),v=o(79412),D=o(6785),y=o(80543),g=(o(1535),o(57678),o(14007),o(62185)),L=o(10141),w=o(7547),M=o(60084),U=o(26894),C=o(69063),b=o(43814),N=o(89713),s=o(8966),r=o(7741);var R=o(61018),I=o(27835),T=o(65820),E=o(46018);const f="esri.layers.mixins.SceneService",F=x.Z.getLogger(f),G=Z=>{let h=class extends Z{constructor(){var n;super(...arguments),n=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,v.Ds)(function(){var e=(0,c.Z)(function*(t,a,l){switch(t){case J.SAVE:return n._save(a);case J.SAVE_AS:return n._saveAs(l,a)}});return function(t,a,l){return e.apply(this,arguments)}}())}readSpatialReference(n,e){return this._readSpatialReference(e)}_readSpatialReference(n){if(null!=n.spatialReference)return b.Z.fromJSON(n.spatialReference);{const e=n.store,t=e.indexCRS||e.geographicCRS,a=t&&parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10);return null!=a?new b.Z(a):null}}readFullExtent(n,e,t){if(null!=n&&"object"==typeof n){const P=null==n.spatialReference?{...n,spatialReference:this._readSpatialReference(e)}:n;return U.Z.fromJSON(P,t)}const a=e.store,l=this._readSpatialReference(e);return null==l||null==a?.extent||!Array.isArray(a.extent)||a.extent.some(P=>P<W)?null:new U.Z({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:l})}parseVersionString(n){const e={major:Number.NaN,minor:Number.NaN,versionString:n},t=n.split(".");return t.length>=2&&(e.major=parseInt(t[0],10),e.minor=parseInt(t[1],10)),e}readVersion(n,e){const t=e.store,a=null!=t.version?t.version.toString():"";return this.parseVersionString(a)}readTitlePortalItem(n){return"item-title"!==this.sublayerTitleMode?void 0:n}readTitleService(n,e){const t=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return(0,N.a7)(this.url,e.name);let a=e.name;if(!a&&this.url){const l=(0,N.Qc)(this.url);null!=l&&(a=l.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&t&&(a=t+" - "+a),(0,N.ld)(a)}set url(n){const e=(0,N.XG)({layer:this,url:n,nonStandardUrlAllowed:!1,logger:F});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(n,e,t,a){(0,N.wH)(this,n,"layers",e,a)}get parsedUrl(){const n=this._get("url"),e=(0,D.mN)(n);return null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(n,e){var t=this;return(0,c.Z)(function*(){t.indexInfo=(0,r.T)(t.parsedUrl.path,t.rootNode,n,t.apiKey,F,e),null==t.fullExtent||t.fullExtent.hasZ||t._updateExtent(yield t.indexInfo)})()}_updateExtent(n){if("page"===n?.type){const e=n.rootIndex%n.pageSize,t=n.rootPage?.nodes?.[e];if(null==t?.obb?.center||null==t.obb.halfSize)throw new m.Z("sceneservice:invalid-node-page","Invalid node page.");if(t.obb.center[0]<W||null==this.fullExtent||this.fullExtent.hasZ)return;const a=t.obb.halfSize,l=t.obb.center[2],P=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=l-P,this.fullExtent.zmax=l+P}else if("node"===n?.type){const e=n.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<W)return;const t=e[2],a=e[3],{fullExtent:l}=this;l&&(l.zmin=t-a,l.zmax=t+a)}}_fetchService(n){var e=this;return(0,c.Z)(function*(){if(null==e.url)throw new m.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const t=yield e._fetchFirstLayerId(n);null!=t&&(e.layerId=t)}return e._fetchServiceLayer(n)})()}_fetchFirstLayerId(n){var e=this;return(0,c.Z)(function*(){const t=yield(0,S.Z)(e.url,{query:{f:"json",token:e.apiKey},responseType:"json",signal:n});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id})()}_fetchServiceLayer(n){var e=this;return(0,c.Z)(function*(){const t=yield(0,S.Z)(e.parsedUrl?.path??"",{query:{f:"json",token:e.apiKey},responseType:"json",signal:n});t.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));let a=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(a=!0),a)return e._fetchVoxelServiceLayer();const l=t.data;e.read(l,e._getServiceContext()),e.validateLayer(l)})()}_fetchVoxelServiceLayer(n){var e=this;return(0,c.Z)(function*(){const t=(yield(0,S.Z)(e.parsedUrl?.path+"/layer",{query:{f:"json",token:e.apiKey},responseType:"json",signal:n})).data;e.read(t,e._getServiceContext()),e.validateLayer(t)})()}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}_ensureLoadBeforeSave(){var n=this;return(0,c.Z)(function*(){yield n.load(),"beforeSave"in n&&"function"==typeof n.beforeSave&&(yield n.beforeSave())})()}validateLayer(n){}_updateTypeKeywords(n,e,t){n.typeKeywords||(n.typeKeywords=[]);const a=e.getTypeKeywords();for(const l of a)n.typeKeywords.push(l);n.typeKeywords&&(n.typeKeywords=n.typeKeywords.filter((l,P,A)=>A.indexOf(l)===P),t===V.newItem&&(n.typeKeywords=n.typeKeywords.filter(l=>"Hosted Service"!==l)))}_saveAs(n,e){var t=this;return(0,c.Z)(function*(){const a={...H,...e};let l=I.default.from(n);if(!l)throw new m.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");(0,T.w)(l),l.id&&(l=l.clone(),l.id=null);const P=l.portal||R.Z.getDefault();yield t._ensureLoadBeforeSave(),l.type=z,l.portal=P;const A={origin:"portal-item",url:null,messages:[],portal:P,portalItem:l,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},_={layers:[t.write({},A)]};return yield Promise.all(A.resources.pendingOperations??[]),yield t._validateAgainstJSONSchema(_,A,a),l.url=t.url,l.title||(l.title=t.title),t._updateTypeKeywords(l,a,V.newItem),yield P.signIn(),yield P.user?.addItem({item:l,folder:a?.folder,data:_}),yield(0,E.Hn)(t.resourceReferences,A,null),t.portalItem=l,(0,M.D)(A),A.portalItem=l,l})()}_save(n){var e=this;return(0,c.Z)(function*(){const t={...H,...n};if(!e.portalItem)throw new m.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if((0,T.w)(e.portalItem),e.portalItem.type!==z)throw new m.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${z}"`);yield e._ensureLoadBeforeSave();const a={origin:"portal-item",url:e.portalItem.itemUrl&&(0,D.mN)(e.portalItem.itemUrl),messages:[],portal:e.portalItem.portal||R.Z.getDefault(),portalItem:e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[e.write({},a)]};return yield Promise.all(a.resources.pendingOperations??[]),yield e._validateAgainstJSONSchema(l,a,t),e.portalItem.url=e.url,e.portalItem.title||(e.portalItem.title=e.title),e._updateTypeKeywords(e.portalItem,t,V.existingItem),yield(0,E.bx)(e.portalItem,l,e.resourceReferences,a,null),(0,M.D)(a),e.portalItem})()}_validateAgainstJSONSchema(n,e,t){return(0,c.Z)(function*(){let a=e.messages?.filter(_=>"error"===_.type).map(_=>new m.Z(_.name,_.message,_.details))??[];t?.validationOptions?.ignoreUnsupported&&(a=a.filter(_=>"layer:unsupported"!==_.name&&"symbol:unsupported"!==_.name&&"symbol-layer:unsupported"!==_.name&&"property:unsupported"!==_.name&&"url:unsupported"!==_.name&&"scenemodification:unsupported"!==_.name));const l=t?.validationOptions,P=l?.enabled,A=null;if(P&&A){const _=(yield A()).validate(n,t.portalItemLayerType);if(_.length>0){const Q=`Layer item did not validate:\n${_.join("\n")}`;if(F.error(`_validateAgainstJSONSchema(): ${Q}`),"throw"===l.failPolicy){const X=_.map(Y=>new m.Z("sceneservice:schema-validation",Y)).concat(a);throw new m.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:X})}}}if(a.length>0)throw new m.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})})()}};return(0,p._)([(0,y.Cb)(s.id)],h.prototype,"id",void 0),(0,p._)([(0,y.Cb)({type:b.Z})],h.prototype,"spatialReference",void 0),(0,p._)([(0,g.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readSpatialReference",null),(0,p._)([(0,y.Cb)({type:U.Z})],h.prototype,"fullExtent",void 0),(0,p._)([(0,g.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],h.prototype,"readFullExtent",null),(0,p._)([(0,y.Cb)({readOnly:!0,type:C.Z})],h.prototype,"heightModelInfo",void 0),(0,p._)([(0,y.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],h.prototype,"minScale",void 0),(0,p._)([(0,y.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],h.prototype,"maxScale",void 0),(0,p._)([(0,y.Cb)({readOnly:!0})],h.prototype,"version",void 0),(0,p._)([(0,g.r)("version",["store.version"])],h.prototype,"readVersion",null),(0,p._)([(0,y.Cb)({type:String,json:{read:{source:"copyrightText"}}})],h.prototype,"copyright",void 0),(0,p._)([(0,y.Cb)({type:String,json:{read:!1}})],h.prototype,"sublayerTitleMode",void 0),(0,p._)([(0,y.Cb)({type:String})],h.prototype,"title",void 0),(0,p._)([(0,g.r)("portal-item","title")],h.prototype,"readTitlePortalItem",null),(0,p._)([(0,g.r)("service","title",["name"])],h.prototype,"readTitleService",null),(0,p._)([(0,y.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],h.prototype,"layerId",void 0),(0,p._)([(0,y.Cb)(s.HQ)],h.prototype,"url",null),(0,p._)([(0,w.c)("url")],h.prototype,"writeUrl",null),(0,p._)([(0,y.Cb)()],h.prototype,"parsedUrl",null),(0,p._)([(0,y.Cb)({readOnly:!0})],h.prototype,"store",void 0),(0,p._)([(0,y.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],h.prototype,"rootNode",void 0),h=(0,p._)([(0,L.j)(f)],h),h},W=-1e38;var V,Z;(Z=V||(V={}))[Z.existingItem=0]="existingItem",Z[Z.newItem=1]="newItem";const z="Scene Service",H={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var J;!function(Z){Z[Z.SAVE=0]="SAVE",Z[Z.SAVE_AS=1]="SAVE_AS"}(J||(J={}))},7741:($,O,o)=>{o.d(O,{T:()=>m});var c=o(15861),p=o(66476),S=o(57964);function m(v,D,y,B,j,K){return x.apply(this,arguments)}function x(){return(x=(0,c.Z)(function*(v,D,y,B,j,K){let g=null;if(null!=y){const U=`${v}/nodepages/`,C=U+Math.floor(y.rootIndex/y.nodesPerPage);try{return{type:"page",rootPage:(yield(0,p.Z)(C,{query:{f:"json",token:B},responseType:"json",signal:K})).data,rootIndex:y.rootIndex,pageSize:y.nodesPerPage,lodMetric:y.lodSelectionMetricType,urlPrefix:U}}catch(b){j?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",C,b),g=b}}if(!D)return null;const L=D?.split("/").pop(),w=`${v}/nodes/`,M=w+L;try{return{type:"node",rootNode:(yield(0,p.Z)(M,{query:{f:"json",token:B},responseType:"json",signal:K})).data,urlPrefix:w}}catch(U){throw new S.Z("sceneservice:root-node-missing","Root node missing.",{pageError:g,nodeError:U,url:M})}})).apply(this,arguments)}},5251:($,O,o)=>{o.r(O),o.d(O,{addOrUpdateResource:()=>D,contentToBlob:()=>U,fetchResources:()=>x,getSiblingOfSameType:()=>b,getSiblingOfSameTypeI:()=>N,removeAllResources:()=>K,removeResource:()=>B,splitPrefixFileNameAndExtension:()=>w});var c=o(15861),p=o(66476),S=o(57964),m=o(6785);function x(s){return v.apply(this,arguments)}function v(){return(v=(0,c.Z)(function*(s,r={},i){yield s.load(i);const u=(0,m.v_)(s.itemUrl,"resources"),{start:d=1,num:R=10,sortOrder:I="asc",sortField:T="created"}=r,E={query:{start:d,num:R,sortOrder:I,sortField:T,token:s.apiKey},signal:i?.signal},f=yield s.portal.request(u,E);return{total:f.total,nextStart:f.nextStart,resources:f.resources.map(({created:F,size:G,resource:W})=>({created:new Date(F),size:G,resource:s.resourceFromPath(W)}))}})).apply(this,arguments)}function D(s,r,i,u){return y.apply(this,arguments)}function y(){return(y=(0,c.Z)(function*(s,r,i,u){if(!s.hasPath())throw new S.Z(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const d=s.portalItem;yield d.load(u);const R=(0,m.v_)(d.userItemUrl,"add"===r?"addResources":"updateResources"),[I,T]=L(s.path),E=new FormData;return I&&"."!==I&&E.append("resourcesPrefix",I),null!=u&&u.compress&&E.append("compress","true"),E.append("fileName",T),E.append("file",i,T),E.append("f","json"),u?.access&&E.append("access",u.access),yield d.portal.request(R,{method:"post",body:E,signal:u?.signal}),s})).apply(this,arguments)}function B(s,r,i){return j.apply(this,arguments)}function j(){return(j=(0,c.Z)(function*(s,r,i){if(!r.hasPath())throw new S.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield s.load(i);const u=(0,m.v_)(s.userItemUrl,"removeResources");yield s.portal.request(u,{method:"post",query:{resource:r.path},signal:i?.signal}),r.portalItem=null})).apply(this,arguments)}function K(s,r){return g.apply(this,arguments)}function g(){return(g=(0,c.Z)(function*(s,r){yield s.load(r);const i=(0,m.v_)(s.userItemUrl,"removeResources");return s.portal.request(i,{method:"post",query:{deleteAll:!0},signal:r?.signal})})).apply(this,arguments)}function L(s){const r=s.lastIndexOf("/");return-1===r?[".",s]:[s.slice(0,r),s.slice(r+1)]}function w(s){const[r,i]=function M(s){const r=(0,m.Ml)(s);return null==r?[s,""]:[s.slice(0,s.length-r.length-1),`.${r}`]}(s),[u,d]=L(r);return[u,d,i]}function U(s){return C.apply(this,arguments)}function C(){return(C=(0,c.Z)(function*(s){return"blob"===s.type?s.blob:"json"===s.type?new Blob([s.jsonString],{type:"application/json"}):(yield(0,p.Z)(s.url,{responseType:"blob"})).data})).apply(this,arguments)}function b(s,r){if(!s.hasPath())return null;const[i,,u]=w(s.path);return s.portalItem.resourceFromPath((0,m.v_)(i,r+u))}function N(s,r){if(!s.hasPath())return null;const[i,,u]=w(s.path);return s.portalItem.resourceFromPath((0,m.v_)(i,r+u))}},65820:($,O,o)=>{o.d(O,{w:()=>m});var c=o(11931),p=o(57964),S=o(40907);function m(x){if(c.default.apiKey&&(0,S.r)(x.portal.url))throw new p.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${x.portal.url} when using an api key`)}},46018:($,O,o)=>{o.d(O,{Hn:()=>D,Pl:()=>N,bx:()=>B});var c=o(15861),p=o(37636),S=o(57964),m=o(79412),x=o(19986),v=o(5251);function D(r,i){return y.apply(this,arguments)}function y(){return(y=(0,c.Z)(function*(r,i,u=null){const d=yield K(r,i,u);yield L(d,i,u)})).apply(this,arguments)}function B(r,i,u,d){return j.apply(this,arguments)}function j(){return(j=(0,c.Z)(function*(r,i,u,d,R=null){const I=yield K(u,d,R);yield r.update({data:i}),yield L(I,d,R)})).apply(this,arguments)}function K(r,i){return g.apply(this,arguments)}function g(){return(g=(0,c.Z)(function*(r,i,u=null){if(!i?.resources)return;const d=i.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=i.portalItem;const R=new Set(i.resources.toKeep.map(f=>f.resource.path)),I=new Set,T=[];R.forEach(f=>{d.delete(f),r.paths.push(f)});for(const f of i.resources.toUpdate)if(d.delete(f.resource.path),R.has(f.resource.path)||I.has(f.resource.path)){const{resource:F,content:G,finish:W,error:V}=f,z=(0,v.getSiblingOfSameTypeI)(F,(0,x.DO)());r.paths.push(z.path),T.push(M({resource:z,content:G,compress:f.compress,finish:W,error:V},u))}else r.paths.push(f.resource.path),T.push(C(f,u)),I.add(f.resource.path);for(const f of i.resources.toAdd)r.paths.push(f.resource.path),d.has(f.resource.path)?d.delete(f.resource.path):T.push(M(f,u));if(0===T.length)return d;const E=yield(0,m.UO)(T);if((0,m.k_)(u),E.length>0)throw new S.Z("save:resources","Failed to save one or more resources",{errors:E});return d})).apply(this,arguments)}function L(r,i){return w.apply(this,arguments)}function w(){return(w=(0,c.Z)(function*(r,i,u=null){if(!r||!i.portalItem)return;const d=[];for(const R of r){const I=i.portalItem.resourceFromPath(R);d.push(I.portalItem.removeResource(I,u))}yield(0,m.as)(d)})).apply(this,arguments)}function M(r,i){return U.apply(this,arguments)}function U(){return(U=(0,c.Z)(function*(r,i){const u={...i??{},compress:r.compress},d=yield(0,p.q6)(r.resource.portalItem.addResource(r.resource,yield(0,v.contentToBlob)(r.content),u));if(!0!==d.ok)throw r.error?.(d.error),d.error;r.finish?.(r.resource)})).apply(this,arguments)}function C(r,i){return b.apply(this,arguments)}function b(){return(b=(0,c.Z)(function*(r,i){const u=yield(0,p.q6)(r.resource.update(yield(0,v.contentToBlob)(r.content),i));if(!0!==u.ok)throw r.error?.(u.error),u.error;r.finish?.(r.resource)})).apply(this,arguments)}function N(r){return s.apply(this,arguments)}function s(){return(s=(0,c.Z)(function*(r){const i=[];for(const u of r.allLayers)if("beforeSave"in u&&"function"==typeof u.beforeSave){const d=u.beforeSave();d&&i.push(d)}yield Promise.allSettled(i)})).apply(this,arguments)}}}]);