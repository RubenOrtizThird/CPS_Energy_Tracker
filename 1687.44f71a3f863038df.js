"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[1687],{38737:(gt,Ee,C)=>{var R,w;C.d(Ee,{Y:()=>R}),(w=R||(R={}))[w.KILOBYTES=1024]="KILOBYTES",w[w.MEGABYTES=1048576]="MEGABYTES",w[w.GIGABYTES=1073741824]="GIGABYTES"},9922:(gt,Ee,C)=>{function R(w,q,J,T){let F=null,_e=1e3;"number"==typeof q?(_e=q,T=J):(F=q??null,_e=J);let ge,de=0;const V=()=>{de=0,w.apply(T,ge)},se=(...X)=>{F&&F.apply(T,X),ge=X,_e?de||(de=setTimeout(V,_e)):V()};return se.remove=()=>{de&&(clearTimeout(de),de=0)},se.forceUpdate=()=>{de&&(clearTimeout(de),V())},se.hasPendingUpdates=()=>!!de,se}C.d(Ee,{P:()=>R})},46708:(gt,Ee,C)=>{C.d(Ee,{F:()=>ge,e:()=>F});var R=C(15861),w=C(15462),q=C(82784),J=C(93792),T=C(91866);function F(V,se,X){return _e.apply(this,arguments)}function _e(){return(_e=(0,R.Z)(function*(V,se,X){const Ce=yield ge(V,se,X);return J.Z.fromJSON(Ce)})).apply(this,arguments)}function ge(V,se,X){return de.apply(this,arguments)}function de(){return(de=(0,R.Z)(function*(V,se,X){const Ce=(0,w.en)(V),Fe={...X},he=T.Z.from(se),{data:ye}=yield(0,q.JT)(Ce,he,he.sourceSpatialReference,Fe);return ye})).apply(this,arguments)}},85596:(gt,Ee,C)=>{C.d(Ee,{Z:()=>Ce});var V,R=C(50484),w=C(89317),q=C(80543),J=C(1535),_e=(C(57678),C(14007),C(10141));const se={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let X=V=class extends w.wq{constructor(Fe){super(Fe),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:Fe}=this,he=function ge(Fe){const{exifInfo:he,exifName:ye,tagName:le}=Fe;if(!he||!ye||!le)return null;const z=he.find(yt=>yt.name===ye);return z?function de(Fe){const{tagName:he,tags:ye}=Fe;return ye&&he&&ye.find(z=>z.name===he)?.value||null}({tagName:le,tags:z.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:Fe});return se[he]||null}clone(){return new V({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,R._)([(0,q.Cb)({type:String})],X.prototype,"contentType",void 0),(0,R._)([(0,q.Cb)()],X.prototype,"exifInfo",void 0),(0,R._)([(0,q.Cb)({readOnly:!0})],X.prototype,"orientationInfo",null),(0,R._)([(0,q.Cb)({type:J.z8})],X.prototype,"id",void 0),(0,R._)([(0,q.Cb)({type:String})],X.prototype,"globalId",void 0),(0,R._)([(0,q.Cb)({type:String})],X.prototype,"keywords",void 0),(0,R._)([(0,q.Cb)({type:String})],X.prototype,"name",void 0),(0,R._)([(0,q.Cb)({json:{read:!1}})],X.prototype,"parentGlobalId",void 0),(0,R._)([(0,q.Cb)({json:{read:!1}})],X.prototype,"parentObjectId",void 0),(0,R._)([(0,q.Cb)({type:J.z8})],X.prototype,"size",void 0),(0,R._)([(0,q.Cb)({json:{read:!1}})],X.prototype,"url",void 0),X=V=(0,R._)([(0,_e.j)("esri.layers.support.AttachmentInfo")],X);const Ce=X},91687:(gt,Ee,C)=>{C.r(Ee),C.d(Ee,{default:()=>ur});var R=C(15861),w=C(50484),q=C(93300),J=C(4703),T=C(77675),F=C(80543),ge=(C(1535),C(57678)),V=(C(14007),C(10141)),se=C(99002),Ce=(C(91531),C(83944)),Fe=C(90984),he=C(9922),ye=C(73018),le=C(53021),z=C(57964),yt=C(38737),Bn=(C(32017),C(55117)),Rt=C(49602);function Lt(d,h,g="arithmetic"){return{type:(0,Rt.UF)(h),value:d,unit:h,rotationType:g}}(function jn(d,h){(0,Rt.UF)(h)})(0,"meters"),function Wn(d,h){(0,Rt.UF)(h)}(0,"square-meters"),Lt(0,"radians"),Lt(0,"degrees");var De=C(72578),Te=C(37689);const Si=["B","kB","MB","GB","TB"];var tt=C(35458),Le=C(73514),Gn=C(85596),Ni=C(12768),Ot=C(94678),ot=C(85295),Qn=C(85971),St=C(43157),Xn=C(4978),rt=C(764);const Vi=J.Z.getLogger("esri.widgets.Feature.support.featureUtils"),Jn=/href=(""|'')/gi,qn=/(\{([^\{\r\n]+)\})/g,es=/\'/g,Ui=/^\s*expression\//i,ts=/(\n)/gi,is=/[\u00A0-\u9999<>\&]/gim,ns=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,ss=/^(?:mailto:|tel:)/,$i="relationships/",Zi=(0,Ot.Ze)("short-date-short-time");function Di(d){if(null!=d)return(d.sourceLayer||d.layer)??void 0}function bt(d,h){return Nt.apply(this,arguments)}function Nt(){return(Nt=(0,R.Z)(function*(d,h){return"function"==typeof d?d(h):d})).apply(this,arguments)}function Bi(d=""){if(d)return!ss.test(d.trim().toLowerCase())}function Vt(d){return!!d&&Ui.test(d)}function zi(d,h){const g=function os(d,h){if(!Vt(h)||!d)return null;const g=h.replace(Ui,"").toLowerCase();let y=null;return d.some(v=>v.name.toLowerCase()===g&&(y=v,!0)),y}(h,d?.fieldName);return g?g.title||null:d?d.label||d.fieldName:null}function at(d,h){const g=Ut(h,d);return g?g.name:d}function Ut(d,h){return d&&"function"==typeof d.getField&&h?d.getField(h)??null:null}function ji(d){return`${d}`.trim()}function We({attributes:d,globalAttributes:h,layer:g,text:y,expressionAttributes:v,fieldInfoMap:b}){return y?$t({formattedAttributes:h,template:hs(y,{...h,...v,...d},g),fieldInfoMap:b}):""}function $t({formattedAttributes:d,template:h,fieldInfoMap:g}){return ji(function as(d){return d.replaceAll(Jn,"")}((0,De.gx)((0,De.gx)(h,y=>function rs(d,h){return`{${h.get(d.toLowerCase())?.fieldName||d}}`}(y,g)),d)))}function Zt(d,h){return d.replaceAll(qn,(g,y,v)=>{const b=Ut(h,v);return b?`{${b.name}}`:y})}function hs(d,h,g){const y=Zt(d,g);return y&&y.replaceAll(ns,(v,b,M)=>function cs(d,h,g){const y=(h=ji(h))&&"{"!==h[0];return(0,De.gx)(d,function us(d,h=!1){const g={...d};return Object.keys(g).forEach(y=>function ds(d,h,g=!1){const y=h[d];if("string"==typeof y){const v="%27",b=(g?encodeURIComponent(y):y).replaceAll(es,v);h[d]=b}}(y,g,h)),g}(g,y||!1))}(v,b||M,h))}function Dt(d){return function ms(d){return null!=d&&"object"==typeof d&&"fieldsIndex"in d&&"geometryType"in d&&"getField"in d&&"load"in d&&"loaded"in d&&"objectIdField"in d&&"spatialReference"in d&&"type"in d&&("feature"===d.type||"scene"===d.type)&&"when"in d}(d)&&function fs(d){return null!=d&&"object"==typeof d&&"createQuery"in d&&"queryFeatureCount"in d&&"queryObjectIds"in d&&"queryRelatedFeatures"in d&&"queryRelatedFeaturesCount"in d&&"relationships"in d}(d)}function Bt(d,h,g,y){return d.trim().split(h).map(v=>(0,Te.uf)(Number(v),(0,Te.sh)(y))).join(g)}function Wi(d,h){if(d?.length&&h)return d.find(g=>g.fieldName?.toLowerCase()===h.toLowerCase())}function Hi(d){const h=[];if(!d)return h;const{fieldInfos:g,content:y}=d;return g&&h.push(...g),y&&Array.isArray(y)&&y.forEach(v=>{if("fields"===v.type){const b=v?.fieldInfos;b&&h.push(...b)}}),h}function zt(d){return d.replaceAll(is,h=>`&#${h.charCodeAt(0)};`)}function lt(d){return"string"==typeof d?d.replaceAll(ts,'<br class="esri-text-new-line" />'):d}function Yi(d){const{value:h,fieldName:g,fieldInfos:y,fieldInfoMap:v,layer:b,graphic:M,timeZone:I}=d;if(null==h)return"";const _=function bs({fieldName:d,value:h,graphic:g,layer:y}){if(Oe(d)||!y||"function"!=typeof y.getFieldDomain)return null;const v=g&&y.getFieldDomain(d,{feature:g});return v&&"coded-value"===v.type?v.getName(h):null}({fieldName:g,value:h,graphic:M,layer:b});if(_)return _;const x=function vs({fieldName:d,graphic:h,layer:g}){if(Oe(d)||!g||"function"!=typeof g.getFeatureType)return null;const{typeIdField:y}=g;if(!y||d!==y)return null;const v=g.getFeatureType(h);return v?v.name:null}({fieldName:g,graphic:M,layer:b});if(x)return x;if(v.get(g.toLowerCase()))return function gs(d,h){const{fieldInfos:g,fieldName:y,preventPlacesFormatting:v,layer:b,timeZone:M}=h,I=Wi(g,y),_=Ut(b,y);if(I&&!(0,ot.Ec)(y)){const E=_?.type,P=I.format?.dateFormat;if("date"===E||"date-only"===E||"time-only"===E||"timestamp-offset"===E||P)return(0,St.$8)(d,{format:P,fieldType:E,timeZoneOptions:{layerTimeZone:b&&"preferredTimeZone"in b?b.preferredTimeZone:null,viewTimeZone:M,datesInUnknownTimezone:!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone)}})}const x=I?.format;return"string"==typeof d&&(0,ot.Ec)(y)&&x?function ys(d,h){return d=d.trim(),/\d{2}-\d{2}/.test(d)?d:d.includes(",")?Bt(d,",",", ",h):d.includes(";")?Bt(d,";","; ",h):d.includes(" ")?Bt(d," "," ",h):(0,Te.uf)(Number(d),(0,Te.sh)(h))}(d,x):"string"==typeof(d=function ps(d,h){if("string"==typeof d&&h&&null==h.dateFormat&&(null!=h.places||null!=h.digitSeparator)){const g=Number(d);if(!isNaN(g))return g}return d}(d,x))||null==d||null==x?lt(d):(0,Te.uf)(d,v?{...(0,Te.sh)(x),minimumFractionDigits:0,maximumFractionDigits:20}:(0,Te.sh)(x))}(h,{fieldInfos:y||Array.from(v.values()),fieldName:g,layer:b,timeZone:I});const E=b?.fieldsIndex?.get(g);return E&&((0,St.a8)(E)||(0,ot.sX)(E))?(0,St.$8)(h,{fieldType:E.type,timeZoneOptions:{layerTimeZone:b&&"preferredTimeZone"in b?b.preferredTimeZone:null,viewTimeZone:I,datesInUnknownTimezone:!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone)}}):lt(h)}function jt({fieldInfos:d,attributes:h,layer:g,graphic:y,fieldInfoMap:v,relatedInfos:b,timeZone:M}){const I={};return b?.forEach(_=>function _s({attributes:d,relatedInfo:h,fieldInfoMap:g,fieldInfos:y,layer:v,timeZone:b}){d&&h&&(h.relatedFeatures?.forEach(M=>Gi({attributes:d,graphic:M,relatedInfo:h,fieldInfoMap:g,fieldInfos:y,layer:v,timeZone:b})),h.relatedStatsFeatures?.forEach(M=>Gi({attributes:d,graphic:M,relatedInfo:h,fieldInfoMap:g,fieldInfos:y,layer:v,timeZone:b})))}({attributes:I,relatedInfo:_,fieldInfoMap:v,fieldInfos:d,layer:g,timeZone:M})),h&&Object.keys(h).forEach(_=>{I[_]=Yi({fieldName:_,fieldInfos:d,fieldInfoMap:v,layer:g,value:h[_],graphic:y,timeZone:M})}),I}function ki(d,h){return Wt.apply(this,arguments)}function Wt(){return(Wt=(0,R.Z)(function*(d,h){const{layer:g,graphic:y,outFields:v,objectIds:b,returnGeometry:M,spatialReference:I}=d,_=b[0];if("number"!=typeof _&&"string"!=typeof _)return Vi.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:g,graphic:y,objectId:_,requiredFields:v}),null;if(!(0,Qn.S1)(g)?.operations?.supportsQuery)return Vi.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:g,graphic:y,requiredFields:v,returnGeometry:M}),null;const x=g.createQuery();return x.objectIds=b,x.outFields=v?.length?v:[g.objectIdField],x.returnGeometry=!!M,x.returnZ=!!M,x.returnM=!!M,x.outSpatialReference=I,(yield g.queryFeatures(x,h)).features[0]})).apply(this,arguments)}function Ht(){return(Ht=(0,R.Z)(function*(d){if(!d.expressionInfos?.length)return!1;const h=yield(0,Xn.LC)(),{arcadeUtils:{hasGeometryFunctions:g}}=h;return g(d)})).apply(this,arguments)}function Yt(){return Yt=(0,R.Z)(function*({graphic:d,popupTemplate:h,layer:g,spatialReference:y},v){if(!g||!h||("function"==typeof g.load&&(yield g.load(v)),!d.attributes))return;const b=d.attributes[g.objectIdField];if(null==b)return;const M=[b],I=yield h.getRequiredFields(g.fieldsIndex),_=(0,ot.R9)(I,d),x=_?[]:I,E=h.returnGeometry||(yield function Fs(d){return Ht.apply(this,arguments)}(h));if(_&&!E)return;const P=yield ki({layer:g,graphic:d,outFields:x,objectIds:M,returnGeometry:E,spatialReference:y},v);P&&(P.geometry&&(d.geometry=P.geometry),P.attributes&&(d.attributes={...d.attributes,...P.attributes}))}),Yt.apply(this,arguments)}function Oe(d=""){return!!d&&d.includes($i)}function Gi({attributes:d,graphic:h,relatedInfo:g,fieldInfos:y,fieldInfoMap:v,layer:b,timeZone:M}){d&&h&&g&&Object.keys(h.attributes).forEach(I=>{const _=function Is(d){return d?`${$i}${d.layerId}/${d.fieldName}`:""}({layerId:g.relation.id.toString(),fieldName:I});d[_]=Yi({fieldName:_,fieldInfos:y,fieldInfoMap:v,layer:b,value:h.attributes[I],graphic:h,timeZone:M})})}const Qi=d=>{if(!d)return!1;const h=d.toUpperCase();return h.includes("CURRENT_TIMESTAMP")||h.includes("CURRENT_DATE")||h.includes("CURRENT_TIME")},Xi=({layer:d,method:h,query:g,definitionExpression:y})=>{if(!d.capabilities?.query?.supportsCacheHint||"attachments"===h)return;const v=null!=g.where?g.where:null,b=null!=g.geometry?g.geometry:null;Qi(y)||Qi(v)||"extent"===b?.type||"tile"===g.resultType||(g.cacheHint=!0)};function Ki(d,h,g){const y="scene"===h.type&&h.associatedLayer?h.associatedLayer.url:h.url;return d.filter(Dt).find(v=>v!==h&&v.url===y&&v.layerId===g.relatedTableId)}const Ji={editing:!1,operations:{add:!0,update:!0,delete:!0}},qi=Ce.Z.ofType(Gn.Z);let ve=class extends Le.Z{constructor(d){super(d),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...Ji},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new qi,this.fileInfos=new Ce.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,T.YP)(()=>this.graphic,()=>this._graphicChanged(),T.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(d){return{...Ji,...d}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:d}=this;if(!d)return!1;const h=d.layer||d.sourceLayer;return h?.loaded&&"capabilities"in h&&h.capabilities&&"operations"in h.capabilities&&"supportsResizeAttachments"in h.capabilities.operations&&h.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var d=this;return(0,R.Z)(function*(){const{_attachmentLayer:h,attachmentInfos:g}=d;if(!h||"function"!=typeof h.queryAttachments)throw new z.Z("invalid-layer","getAttachments(): A valid layer is required.");const y=d._getObjectId(),v=new Ni.Z({objectIds:[y],returnMetadata:!0}),b=[],M=h.queryAttachments(v).then(_=>_[y]||b).catch(()=>b);d._getAttachmentsPromise=M,d.notifyChange("state");const I=yield M;return g.removeAll(),I.length&&g.addMany(I),d._getAttachmentsPromise=null,d.notifyChange("state"),I})()}addAttachment(d,h=this.graphic){var g=this;return(0,R.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v,capabilities:b}=g;if(!h)throw new z.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:h});if(!d)throw new z.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:d});if(!b.operations?.add)throw new z.Z("invalid-capabilities","addAttachment(): add capabilities are required.");if(!y||"function"!=typeof y.addAttachment)throw new z.Z("invalid-layer","addAttachment(): A valid layer is required.");const M=y.addAttachment(h,d).then(_=>g._queryAttachment(_.objectId,h)),I=yield M;return v.add(I),I})()}deleteAttachment(d){var h=this;return(0,R.Z)(function*(){const{_attachmentLayer:g,attachmentInfos:y,graphic:v,capabilities:b}=h;if(!d)throw new z.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:d});if(!b.operations?.delete)throw new z.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!g||"function"!=typeof g.deleteAttachments)throw new z.Z("invalid-layer","deleteAttachment(): A valid layer is required.");if(!v)throw new z.Z("invalid-graphic","deleteAttachment(): A graphic is required.");const M=g.deleteAttachments(v,[d.id]).then(()=>d),I=yield M;return y.remove(I),I})()}updateAttachment(d,h=this.activeAttachmentInfo){var g=this;return(0,R.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v,graphic:b,capabilities:M}=g;if(!d)throw new z.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:d});if(!h)throw new z.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:h});if(!M.operations?.update)throw new z.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");const I=v.indexOf(h);if(!y||"function"!=typeof y.updateAttachment)throw new z.Z("invalid-layer","updateAttachment(): A valid layer is required.");if(!b)throw new z.Z("invalid-graphic","updateAttachment(): A graphic is required.");const _=y.updateAttachment(b,h.id,d).then(E=>g._queryAttachment(E.objectId)),x=yield _;return v.splice(I,1,x),x})()}commitFiles(){var d=this;return(0,R.Z)(function*(){return yield Promise.all(d.fileInfos.items.map(h=>d.addAttachment(h.form))),d.fileInfos.removeAll(),d.getAttachments()})()}addFile(d,h){if(!d||!h)return null;const g={file:d,form:h};return this.fileInfos.add(g),g}updateFile(d,h,g=this.activeFileInfo){if(!d||!h||!g)return null;const y=this.fileInfos.indexOf(g);return y>-1&&this.fileInfos.splice(y,1,{file:d,form:h}),this.fileInfos.items[y]}deleteFile(d){const h=this.fileInfos.find(g=>g.file===d);return h?(this.fileInfos.remove(h),h):null}_queryAttachment(d,h){var g=this;return(0,R.Z)(function*(){const{_attachmentLayer:y}=g;if(!d||!y?.queryAttachments)throw new z.Z("invalid-attachment-id","Could not query attachment.");const v=g._getObjectId(h),b=new Ni.Z({objectIds:[v],attachmentsWhere:`AttachmentId=${d}`,returnMetadata:!0});return y.queryAttachments(b).then(M=>M[v][0])})()}_getObjectId(d=this.graphic){return d?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:d}=this,h=Di(d);this._attachmentLayer=h?"scene"===h.type&&null!=h.associatedLayer?h.associatedLayer:h:null}};(0,w._)([(0,F.Cb)()],ve.prototype,"capabilities",void 0),(0,w._)([(0,ye.p)("capabilities")],ve.prototype,"castCapabilities",null),(0,w._)([(0,F.Cb)()],ve.prototype,"activeAttachmentInfo",void 0),(0,w._)([(0,F.Cb)()],ve.prototype,"activeFileInfo",void 0),(0,w._)([(0,F.Cb)({readOnly:!0,type:qi})],ve.prototype,"attachmentInfos",void 0),(0,w._)([(0,F.Cb)()],ve.prototype,"fileInfos",void 0),(0,w._)([(0,F.Cb)({type:tt.Z})],ve.prototype,"graphic",void 0),(0,w._)([(0,F.Cb)()],ve.prototype,"mode",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ve.prototype,"state",null),(0,w._)([(0,F.Cb)()],ve.prototype,"filesEnabled",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ve.prototype,"supportsResizeAttachments",null),ve=(0,w._)([(0,V.j)("esri.widgets.Attachments.AttachmentsViewModel")],ve);const kt=ve;var Ts=C(98930);function en(d){const h=d.toLowerCase();return"image/bmp"===h||"image/emf"===h||"image/exif"===h||"image/gif"===h||"image/x-icon"===h||"image/jpeg"===h||"image/png"===h||"image/tiff"===h||"image/x-wmf"===h}var it=C(90643),U=C(89219),Me=C(70868),Ae=C(40846),be=C(26440),A=C(2485);const tn={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},j="esri-attachments",S={base:j,loaderContainer:`${j}__loader-container`,loader:`${j}__loader`,fadeIn:`${j}--fade-in`,container:`${j}__container`,containerList:`${j}__container--list`,containerPreview:`${j}__container--preview`,actions:`${j}__actions`,deleteButton:`${j}__delete-button`,addAttachmentButton:`${j}__add-attachment-button`,errorMessage:`${j}__error-message`,items:`${j}__items`,item:`${j}__item`,itemButton:`${j}__item-button`,itemMask:`${j}__item-mask`,itemMaskIcon:`${j}__item-mask--icon`,itemImage:`${j}__image`,itemImageResizable:`${j}__image--resizable`,itemLabel:`${j}__label`,itemFilename:`${j}__filename`,itemChevronIcon:`${j}__item-chevron-icon`,itemLink:`${j}__item-link`,itemLinkOverlay:`${j}__item-link-overlay`,itemLinkOverlayIcon:`${j}__item-link-overlay-icon`,itemEditIcon:`${j}__item-edit-icon`,itemAddIcon:`${j}__item-add-icon`,itemAddButton:`${j}__item-add-button`,formNode:`${j}__form-node`,fileFieldset:`${j}__file-fieldset`,fileLabel:`${j}__file-label`,fileName:`${j}__file-name`,fileInput:`${j}__file-input`,metadata:`${j}__metadata`,metadataFieldset:`${j}__metadata-fieldset`,progressBar:`${j}__progress-bar`},Gt=window.CSS;let ue=class extends le.Z{constructor(d,h){super(d,h),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...tn},this._supportsImageOrientation=Gt&&Gt.supports&&Gt.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(d){return d?.viewModel||(d={viewModel:new kt,...d}),d}initialize(){this.addHandles([(0,T.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,T.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,T.YP)(()=>this.viewModel?.mode,()=>this._modeChanged(),T.nn)])}loadDependencies(){return(0,it.h)({icon:()=>C.e(4540).then(C.bind(C,24540))})}get capabilities(){return this.viewModel.capabilities}set capabilities(d){this.viewModel.capabilities=d}get effectiveDisplayType(){const{displayType:d}=this;return d&&"auto"!==d?d:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}castVisibleElements(d){return{...tn,...d}}addAttachment(){const{_addAttachmentForm:d,viewModel:h}=this;return this._set("submitting",!0),this._set("error",null),h.addAttachment(d).then(g=>(this._set("submitting",!1),this._set("error",null),h.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new z.Z("attachments:add-attachment",this.messages.addErrorMessage,g)),g})}deleteAttachment(d){const{viewModel:h}=this;return this._set("submitting",!0),this._set("error",null),h.deleteAttachment(d).then(g=>(this._set("submitting",!1),this._set("error",null),h.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new z.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,g)),g})}updateAttachment(){const{viewModel:d}=this,{_updateAttachmentForm:h}=this;return this._set("submitting",!0),this._set("error",null),d.updateAttachment(h).then(g=>(this._set("submitting",!1),this._set("error",null),d.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new z.Z("attachments:update-attachment",this.messages.updateErrorMessage,g)),g})}addFile(){const d=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",d}updateFile(){const{viewModel:d}=this,h=d.updateFile(this.selectedFile,this._updateAttachmentForm,d.activeFileInfo);return d.mode="view",h}deleteFile(d){const h=this.viewModel.deleteFile(d||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",h}render(){const{submitting:d,viewModel:h}=this,{state:g}=h;return(0,A.u)("div",{class:this.classes(S.base,U.z.widget)},d?this._renderProgressBar():null,"loading"===g?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:d,visibleElements:h}=this;return d&&h.errorMessage?(0,A.u)("div",{class:S.errorMessage,key:"error-message"},d.message):null}_renderAttachments(){const{activeFileInfo:d,mode:h,activeAttachmentInfo:g}=this.viewModel;return"add"===h?this._renderAddForm():"edit"===h?this._renderDetailsForm(g||d):this._renderAttachmentContainer()}_renderLoading(){return(0,A.u)("div",{class:S.loaderContainer,key:"loader"},(0,A.u)("div",{class:S.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,A.u)("div",{class:S.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:d,selectedFile:h}=this,g=d||!h,y=this.visibleElements.cancelAddButton?(0,A.u)("button",{bind:this,class:this.classes(U.z.button,U.z.buttonTertiary,U.z.buttonSmall,U.z.buttonHalf,d&&U.z.buttonDisabled),disabled:d,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,v=this.visibleElements.addSubmitButton?(0,A.u)("button",{class:this.classes(U.z.button,U.z.buttonSecondary,U.z.buttonSmall,U.z.buttonHalf,{[U.z.buttonDisabled]:g}),disabled:g,type:"submit"},this.messages.add):null,b=h?(0,A.u)("span",{class:S.fileName,key:"file-name"},h.name):null,M=(0,A.u)("form",{afterCreate:Ae.Yo,afterRemoved:Ae.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,A.u)("fieldset",{class:S.fileFieldset},b,(0,A.u)("label",{class:this.classes(S.fileLabel,U.z.button,U.z.buttonSecondary)},h?this.messages.changeFile:this.messages.selectFile,(0,A.u)("input",{bind:this,class:S.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),v,y);return(0,A.u)("div",{class:S.formNode,key:"add-form-container"},M)}_renderDetailsForm(d){const{visibleElements:h,viewModel:g,selectedFile:y,submitting:v}=this,{capabilities:b}=g,M=v||!y;let I,_,x,E;y?(I=y.type,_=y.name,x=y.size):d&&"file"in d?(I=d.file.type,_=d.file.name,x=d.file.size):d&&"contentType"in d&&(I=d.contentType,_=d.name,x=d.size,E=d.url);const P=b.editing&&b.operations?.delete&&h.deleteButton?(0,A.u)("button",{bind:this,class:this.classes(U.z.button,U.z.buttonSmall,U.z.buttonTertiary,S.deleteButton,{[U.z.buttonDisabled]:v}),disabled:v,key:"delete-button",onclick:k=>this._submitDeleteAttachment(k,d),type:"button"},this.messages.delete):void 0,L=b.editing&&b.operations?.update&&h.updateButton?(0,A.u)("button",{class:this.classes(U.z.button,U.z.buttonSmall,U.z.buttonThird,{[U.z.buttonDisabled]:M}),disabled:M,key:"update-button",type:"submit"},this.messages.update):void 0,O=this.visibleElements.cancelUpdateButton?(0,A.u)("button",{bind:this,class:this.classes(U.z.button,U.z.buttonSmall,U.z.buttonTertiary,U.z.buttonThird,{[U.z.buttonDisabled]:v}),disabled:v,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,N=b.editing&&b.operations?.update?(0,A.u)("fieldset",{class:S.fileFieldset,key:"file"},(0,A.u)("span",{class:S.fileName,key:"file-name"},_),(0,A.u)("label",{class:this.classes(S.fileLabel,U.z.button,U.z.buttonSecondary)},this.messages.changeFile,(0,A.u)("input",{bind:this,class:S.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,Z=(0,A.u)("fieldset",{class:S.metadataFieldset,key:"size"},(0,A.u)("label",null,function kn(d,h){let g=0===(h=Math.round(h))?0:Math.floor(Math.log(h)/Math.log(yt.Y.KILOBYTES));g=(0,Bn.uZ)(g,0,Si.length-1);const y=(0,Te.uf)(h/yt.Y.KILOBYTES**g,{maximumFractionDigits:2});return(0,De.gx)(d.units.bytes[Si[g]],{fileSize:y})}(this.messagesUnits,x??0))),W=(0,A.u)("fieldset",{class:S.metadataFieldset,key:"content-type"},(0,A.u)("label",null,I)),B=null!=E?(0,A.u)("a",{class:S.itemLink,href:E,rel:"noreferrer",target:"_blank"},this._renderImageMask(d,400),(0,A.u)("div",{class:S.itemLinkOverlay},(0,A.u)("span",{class:S.itemLinkOverlayIcon},(0,A.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(d,400),Q=(0,A.u)("form",{afterCreate:Ae.Yo,afterRemoved:Ae.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:k=>this._submitUpdateAttachment(k,d)},(0,A.u)("div",{class:S.metadata},Z,W),N,(0,A.u)("div",{class:S.actions},P,O,L));return(0,A.u)("div",{class:S.formNode,key:"edit-form-container"},B,Q)}_renderImageMask(d,h){return d?"file"in d?this._renderGenericImageMask(d.file.name,d.file.type):this._renderImageMaskForAttachment(d,h):null}_renderGenericImageMask(d,h){const{supportsResizeAttachments:g}=this.viewModel,y=function Ps(d){const h=(0,Ts.V)("esri/themes/base/images/files/");return d?"text/plain"===d?`${h}text-32.svg`:"application/pdf"===d?`${h}pdf-32.svg`:"text/csv"===d?`${h}csv-32.svg`:"application/gpx+xml"===d?`${h}gpx-32.svg`:"application/x-dwf"===d?`${h}cad-32.svg`:"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?`${h}code-32.svg`:"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===d||"application/gzip"===d||"application/x-compress"===d||"application/x-apple-diskimage"===d||"application/x-rar-compressed"===d||"application/zip"===d?`${h}zip-32.svg`:d.includes("image/")?`${h}image-32.svg`:d.includes("audio/")?`${h}sound-32.svg`:d.includes("video/")?`${h}video-32.svg`:d.includes("msexcel")||d.includes("ms-excel")||d.includes("spreadsheetml")?`${h}excel-32.svg`:d.includes("msword")||d.includes("ms-word")||d.includes("wordprocessingml")?`${h}word-32.svg`:d.includes("powerpoint")||d.includes("presentationml")?`${h}report-32.svg`:`${h}generic-32.svg`:`${h}generic-32.svg`}(h),v={[S.itemImageResizable]:g};return(0,A.u)("div",{class:this.classes(S.itemMaskIcon,S.itemMask),key:y},(0,A.u)("img",{alt:d,class:this.classes(v,S.itemImage),src:y,title:d}))}_renderImageMaskForAttachment(d,h){const{supportsResizeAttachments:g}=this.viewModel;if(!d)return null;const{contentType:y,name:v,url:b}=d;if(!g||!en(y))return this._renderGenericImageMask(v,y);const M=this._getCSSTransform(d),I=M?{transform:M,"image-orientation":"none"}:{},_=`${b}${b?.includes("?")?"&":"?"}w=${h}`,x={[S.itemImageResizable]:g};return(0,A.u)("div",{class:this.classes(S.itemMask),key:_},(0,A.u)("img",{alt:v,class:this.classes(x,S.itemImage),src:_,styles:I,title:v}))}_renderFile(d){const{file:h}=d;return(0,A.u)("li",{class:S.item,key:h},(0,A.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:S.itemButton,key:"details-button",onclick:()=>this._startEditFile(d),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(d),(0,A.u)("label",{class:S.itemLabel},(0,A.u)("span",{class:S.itemFilename},h.name||this.messages.noTitle),(0,A.u)("span",{"aria-hidden":"true",class:this.classes(S.itemChevronIcon,(0,Ae.dZ)(this.container)?Me.W.left:Me.W.right)}))))}_renderAttachmentInfo({attachmentInfo:d,displayType:h}){const{viewModel:g,effectiveDisplayType:y}=this,{capabilities:v,supportsResizeAttachments:b}=g,{contentType:M,name:I,url:_}=d,x=this._renderImageMask(d,"list"===h?48:400),E=v.editing?(0,A.u)("span",{"aria-hidden":"true",class:this.classes(S.itemChevronIcon,(0,Ae.dZ)(this.container)?Me.W.left:Me.W.right)}):null,P=[x,"preview"===y&&b&&en(M)?null:(0,A.u)("label",{class:S.itemLabel},(0,A.u)("span",{class:S.itemFilename},I||this.messages.noTitle),E)],L=v.editing?(0,A.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:S.itemButton,"data-attachment-info-id":d.id,key:"details-button",onclick:()=>this._startEditAttachment(d),title:this.messages.attachmentDetails,type:"button"},P):(0,A.u)("a",{class:S.itemButton,href:_??void 0,key:"details-link",target:"_blank"},P);return(0,A.u)("li",{class:S.item,key:d},L)}_renderAttachmentContainer(){const{effectiveDisplayType:d,viewModel:h,visibleElements:g}=this,{attachmentInfos:y,capabilities:v,fileInfos:b}=h,M=!!y?.length,I=!!b?.length,_={[S.containerList]:"preview"!==d,[S.containerPreview]:"preview"===d},x=v.editing&&v.operations?.add&&g.addButton?(0,A.u)("button",{bind:this,class:this.classes(U.z.button,U.z.buttonTertiary,S.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,A.u)("span",{"aria-hidden":"true",class:this.classes(S.itemAddIcon,Me.W.plus)}),this.messages.add):void 0,E=M?(0,A.u)("ul",{class:S.items,key:"attachments-list"},y.toArray().map(O=>this._renderAttachmentInfo({attachmentInfo:O,displayType:d}))):void 0,P=I?(0,A.u)("ul",{class:S.items,key:"file-list"},b.toArray().map(O=>this._renderFile(O))):void 0,L=I||M?void 0:(0,A.u)("div",{class:U.z.empty},this.messages.noAttachments);return(0,A.u)("div",{class:this.classes(S.container,_),key:"attachments-container"},E,P,L,x)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(d){const h=d.target,g=h.files?.item(0);this._set("selectedFile",g)}_submitDeleteAttachment(d,h){d.preventDefault(),h&&("file"in h?this.deleteFile(h.file):h&&this.deleteAttachment(h))}_submitAddAttachment(d){d.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(d,h){d.preventDefault(),h&&"file"in h?this.updateFile():this.updateAttachment()}_startEditAttachment(d){const{viewModel:h}=this;h.activeFileInfo=null,h.activeAttachmentInfo=d,h.mode="edit"}_startEditFile(d){const{viewModel:h}=this;h.activeAttachmentInfo=null,h.activeFileInfo=d,h.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(d){d.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(d){const{orientationInfo:h}=d;return!this._supportsImageOrientation&&h?[h.rotation?`rotate(${h.rotation}deg)`:"",h.mirrored?"scaleX(-1)":""].join(" "):""}};(0,w._)([(0,F.Cb)()],ue.prototype,"capabilities",null),(0,w._)([(0,F.Cb)()],ue.prototype,"displayType",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ue.prototype,"effectiveDisplayType",null),(0,w._)([(0,F.Cb)()],ue.prototype,"graphic",null),(0,w._)([(0,F.Cb)()],ue.prototype,"label",null),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Attachments/t9n/Attachments")],ue.prototype,"messages",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/core/t9n/Units")],ue.prototype,"messagesUnits",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ue.prototype,"selectedFile",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ue.prototype,"submitting",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ue.prototype,"error",void 0),(0,w._)([(0,F.Cb)({type:kt})],ue.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)()],ue.prototype,"visibleElements",void 0),(0,w._)([(0,ye.p)("visibleElements")],ue.prototype,"castVisibleElements",null),ue=(0,w._)([(0,V.j)("esri.widgets.Attachments")],ue);const Rs=ue;let dt=class extends kt{constructor(d){super(d),this.description=null,this.title=null}};(0,w._)([(0,F.Cb)()],dt.prototype,"description",void 0),(0,w._)([(0,F.Cb)()],dt.prototype,"title",void 0),dt=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],dt);const Qt=dt;var Xt=C(83022);const Kt="esri-feature-element-info",Jt={base:Kt,title:`${Kt}__title`,description:`${Kt}__description`};let nt=class extends le.Z{constructor(d,h){super(d,h),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,A.u)("div",{class:Jt.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:d}=this;return d?(0,A.u)(Xt.X,{class:Jt.title,level:this.headingLevel},d):null}_renderDescription(){const{description:d}=this;return d?(0,A.u)("div",{class:Jt.description,key:"description"},d):null}};(0,w._)([(0,F.Cb)()],nt.prototype,"description",void 0),(0,w._)([(0,F.Cb)()],nt.prototype,"headingLevel",void 0),(0,w._)([(0,F.Cb)()],nt.prototype,"title",void 0),nt=(0,w._)([(0,V.j)("esri.widgets.Feature.support.FeatureElementInfo")],nt);const wt=nt;let Pe=class extends le.Z{constructor(d,h){super(d,h),this._featureElementInfo=null,this.attachmentsWidget=new Rs,this.headingLevel=2,this.viewModel=new Qt}initialize(){this._featureElementInfo=new wt,this.addHandles([(0,T.YP)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),T.nn),(0,T.YP)(()=>this.viewModel,d=>this.attachmentsWidget.viewModel=d,T.nn)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get displayType(){return this.attachmentsWidget.displayType}set displayType(d){this.attachmentsWidget.displayType=d}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){const{attachmentsWidget:d}=this;return(0,A.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),d?.render())}_setupFeatureElementInfo(){const{description:d,title:h,headingLevel:g}=this;this._featureElementInfo?.set({description:d,title:h,headingLevel:g})}};(0,w._)([(0,F.Cb)({readOnly:!0})],Pe.prototype,"attachmentsWidget",void 0),(0,w._)([(0,F.Cb)()],Pe.prototype,"description",null),(0,w._)([(0,F.Cb)()],Pe.prototype,"displayType",null),(0,w._)([(0,F.Cb)()],Pe.prototype,"graphic",null),(0,w._)([(0,F.Cb)()],Pe.prototype,"headingLevel",void 0),(0,w._)([(0,F.Cb)()],Pe.prototype,"title",null),(0,w._)([(0,F.Cb)({type:Qt})],Pe.prototype,"viewModel",void 0),Pe=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureAttachments")],Pe);const Os=Pe;let Be=class extends Le.Z{constructor(d){super(d),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,T.YP)(()=>this.creator,h=>{this._destroyContent(),this._createContent(h)},T.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:d,graphic:h,destroyer:g}=this;d&&h&&(bt(g,{graphic:h}).catch(()=>null),this._set("created",null))}_createContent(d){var h=this;return(0,R.Z)(function*(){const g=h.graphic;if(!g||!d)return;const y=bt(d,{graphic:g}).catch(()=>null);h._loadingPromise=y,h.notifyChange("state");const v=yield y;y===h._loadingPromise&&(h._loadingPromise=null,h.notifyChange("state"),h._set("created",v))})()}};(0,w._)([(0,F.Cb)({readOnly:!0})],Be.prototype,"created",void 0),(0,w._)([(0,F.Cb)()],Be.prototype,"creator",void 0),(0,w._)([(0,F.Cb)()],Be.prototype,"destroyer",void 0),(0,w._)([(0,F.Cb)({type:tt.Z})],Be.prototype,"graphic",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],Be.prototype,"state",null),Be=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Be);const Ct=Be;var qt=C(36911);const ei="esri-feature-content",ti={base:ei,loaderContainer:`${ei}__loader-container`,loader:`${ei}__loader`};let st=class extends le.Z{constructor(d,h){super(d,h),this.viewModel=null,this._addTargetToAnchors=g=>{Array.from(g.querySelectorAll("a")).forEach(y=>{Bi(y.href)&&!y.hasAttribute("target")&&y.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(d){this.viewModel&&(this.viewModel.creator=d)}get graphic(){return this.viewModel?.graphic}set graphic(d){this.viewModel&&(this.viewModel.graphic=d)}render(){const d=this.viewModel?.state;return(0,A.u)("div",{class:ti.base},"loading"===d?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,A.u)("div",{class:ti.loaderContainer,key:"loader"},(0,A.u)("div",{class:ti.loader}))}_renderCreated(){const d=this.viewModel?.created;return d?d instanceof HTMLElement?(0,A.u)("div",{afterCreate:this._attachToNode,bind:d,key:d}):(0,qt.Qd)(d)?(0,A.u)("div",{key:d},!d.destroyed&&d.render()):(0,A.u)("div",{afterCreate:this._addTargetToAnchors,innerHTML:d,key:d}):null}_attachToNode(d){d.appendChild(this)}};(0,w._)([(0,F.Cb)()],st.prototype,"creator",null),(0,w._)([(0,F.Cb)()],st.prototype,"graphic",null),(0,w._)([(0,F.Cb)({type:Ct})],st.prototype,"viewModel",void 0),st=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureContent")],st);const Ft=st;var Ss=C(59869),nn=C(42271);let Se=class extends Le.Z{constructor(d){super(d),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:d,fieldInfos:h}=this,g=[];return h?.forEach(y=>{if(y.hasOwnProperty("visible")&&!y.visible)return;const v=y.clone();v.label=zi(v,d),g.push(v)}),g}};(0,w._)([(0,F.Cb)()],Se.prototype,"attributes",void 0),(0,w._)([(0,F.Cb)({type:[Ss.Z]})],Se.prototype,"expressionInfos",void 0),(0,w._)([(0,F.Cb)()],Se.prototype,"description",void 0),(0,w._)([(0,F.Cb)({type:[nn.Z]})],Se.prototype,"fieldInfos",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],Se.prototype,"formattedFieldInfos",null),(0,w._)([(0,F.Cb)()],Se.prototype,"title",void 0),Se=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Se);const Mt=Se,Ns=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];const It="esri-feature-fields",_t={base:It,fieldHeader:`${It}__field-header`,fieldData:`${It}__field-data`,fieldDataDate:`${It}__field-data--date`};let xe=class extends le.Z{constructor(d,h){super(d,h),this._featureElementInfo=null,this.viewModel=new Mt,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new wt,this.addHandles((0,T.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),T.nn))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(d){this.viewModel.attributes=d}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(d){this.viewModel.expressionInfos=d}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(d){this.viewModel.fieldInfos=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){return(0,A.u)("div",{class:_t.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(d,h){const{attributes:g}=this.viewModel,y=d.fieldName,v=d.label||y,b=g?null==g[y]?"":g[y]:"",M=!(!d.format||!d.format.dateFormat),I="number"!=typeof b||M?function Us(d,h){if("string"!=typeof h||!h)return h;const g=function Vs(d){let h=null;return Ns.some(g=>(g.pattern.test(d)&&(h=g),!!h)),h}(h);if(!g)return h;const y=h.match(g.pattern),b=(0,De.gx)((0,De.gx)(g.label,{messages:d,hierPart:y&&y[2]}),{appName:g.appName});return h.replace(g.pattern,`<a${g.target?` target="${g.target}"`:""} href="$1"${"_blank"===g.target?' rel="noreferrer"':""}>${b}</a>`)}(this.messagesURIUtils,b):this._forceLTR(b),_={[_t.fieldDataDate]:M};return(0,A.u)("tr",{key:`fields-element-info-row-${y}-${h}`},(0,A.u)("th",{class:_t.fieldHeader,innerHTML:v,key:`fields-element-info-row-header-${y}-${h}`}),(0,A.u)("td",{class:this.classes(_t.fieldData,_),innerHTML:I,key:`fields-element-info-row-data-${y}-${h}`}))}_renderFields(){const{formattedFieldInfos:d}=this.viewModel;return d?.length?(0,A.u)("table",{class:U.z.table,summary:this.messages.fieldsSummary},(0,A.u)("tbody",null,d.map((h,g)=>this._renderFieldInfo(h,g)))):null}_setupFeatureElementInfo(){const{description:d,title:h}=this;this._featureElementInfo?.set({description:d,title:h})}_forceLTR(d){return`&lrm;${d}`}};(0,w._)([(0,F.Cb)()],xe.prototype,"attributes",null),(0,w._)([(0,F.Cb)()],xe.prototype,"description",null),(0,w._)([(0,F.Cb)()],xe.prototype,"expressionInfos",null),(0,w._)([(0,F.Cb)()],xe.prototype,"fieldInfos",null),(0,w._)([(0,F.Cb)()],xe.prototype,"title",null),(0,w._)([(0,F.Cb)({type:Mt,nonNullable:!0})],xe.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Feature/t9n/Feature")],xe.prototype,"messages",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/support/t9n/uriUtils")],xe.prototype,"messagesURIUtils",void 0),xe=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureFields")],xe);const sn=xe;var Zs=C(64023),Ds=C(17009),Bs=C(66476),oe=C(79412),ii=(C(46054),C(46708)),zs=(C(11931),C(26152),C(6785),C(82921),C(33721),C(10842),C(26894),C(32184),C(12628),C(85039)),ni=(C(5391),C(64222),C(93566),C(40485),C(93792),C(91866)),si=(C(2189),C(46556)),js=(C(89047),C(91085));const on=J.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),rn=new Map;function At(d){if(!Oe(d))return null;const[h,g]=d.split("/").slice(1);return{layerId:h,fieldName:g}}function oi(){return(oi=(0,R.Z)(function*(d,h,g,y){const v=g.layerId.toString(),{layerInfo:b,relation:M,relatedFields:I,outStatistics:_,url:x,sourceSpatialReference:E}=h,P=function Js(d){return d?(0,ge.Tw)(d):void 0}(I),L=function qs(d){return d?(0,ge.Tw)(d,(h,g)=>JSON.stringify(h.toJSON())===JSON.stringify(g.toJSON())):void 0}(_);if(!b||!M)return null;const O=function Ys({originRelationship:d,relationships:h,layerId:g}){let y=null;return h&&h.some(v=>(`${v.relatedTableId}`===g&&v.id===d?.id&&(y=v),!!y)),y}({originRelationship:M,relationships:b.relationships,layerId:v});if(O?.relationshipTableId&&O.keyFieldInRelationshipTable){const Z=(yield function Xs(d,h,g,y){const v=new si.default;return v.outFields=["*"],v.relationshipId="number"==typeof h.id?h.id:parseInt(h.id,10),v.objectIds=[d.attributes[g.objectIdField]],g.queryRelatedFeatures?.(v,y)??Promise.resolve({})}(d,O,g,y))[d.attributes[g.objectIdField]];if(!Z)return null;const W=Z.features.map(B=>B.attributes[b.objectIdField]);if(L?.length&&b.supportsStatistics){const B=new ni.Z;B.where=function Ks(d,h,g){let y=0;const v=[];for(;y<h.length;)v.push(`${d} IN (${h.slice(y,g+y)})`),y+=g;return v.join(" OR ")}(b.objectIdField,W,1e3),B.outFields=P,B.outStatistics=L,B.sourceSpatialReference=E;const Q={features:Promise.resolve(Z),statsFeatures:(0,ii.e)(x,B)};return(0,oe.as)(Q)}}const N=O?.keyField;if(N){const Z=(0,ot.H7)(function oo(d,h){if(null!=d){h=h.toLowerCase();for(const g of d)if(g&&g.name.toLowerCase()===h)return g}return null}(b.fields,N)),W=function ks(d,h){const g=h.toLowerCase();for(const y in d)if(y.toLowerCase()===g)return d[y];return null}(d.attributes,M.keyField),B=Z?`${N}=${W}`:`${N}='${W}'`,Q=(0,ii.e)(x,new ni.Z({where:B,outFields:P,sourceSpatialReference:E}),y),k=L?.length&&b.supportsStatistics?(0,ii.e)(x,new ni.Z({where:B,outFields:P,outStatistics:L,sourceSpatialReference:E}),y):null,ae={features:Q};return k&&(ae.statsFeatures=k),(0,oe.as)(ae)}return null})).apply(this,arguments)}const an={chartAnimation:!0};let ee=class extends Le.Z{constructor(d){super(d),this.abilities={...an},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(d){return{...an,...d}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(d){this._setContentElementMedia(d)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(d){const{formattedMediaInfoCount:h}=this;this.activeMediaInfoIndex=(d+h)%h}_pageContentElementMedia(d){const{activeMediaInfoIndex:h}=this;this._setContentElementMedia(h+d)}_formatMediaInfos(){const{mediaInfos:d,layer:h}=this,g=this.attributes??{},y=this.formattedAttributes??{},v=this.expressionAttributes??{},b=this.fieldInfoMap??new Map;return d?.map(M=>{const I=M?.clone();if(!I)return null;if(I.title=We({attributes:g,fieldInfoMap:b,globalAttributes:y,expressionAttributes:v,layer:h,text:I.title}),I.caption=We({attributes:g,fieldInfoMap:b,globalAttributes:y,expressionAttributes:v,layer:h,text:I.caption}),I.altText=We({attributes:g,fieldInfoMap:b,globalAttributes:y,expressionAttributes:v,layer:h,text:I.altText}),"image"===I.type){const{value:_}=I;return this._setImageValue({value:_,formattedAttributes:y,layer:h}),I.value.sourceURL?I:void 0}if("pie-chart"===I.type||"line-chart"===I.type||"column-chart"===I.type||"bar-chart"===I.type){const{value:_}=I;return this._setChartValue({value:_,chartType:I.type,attributes:g,formattedAttributes:y,layer:h,expressionAttributes:v}),I}return null}).filter(ge.pC)??[]}_setImageValue(d){const h=this.fieldInfoMap??new Map,{value:g,formattedAttributes:y,layer:v}=d,{linkURL:b,sourceURL:M}=g;if(M){const I=Zt(M,v);g.sourceURL=$t({formattedAttributes:y,template:I,fieldInfoMap:h})}if(b){const I=Zt(b,v);g.linkURL=$t({formattedAttributes:y,template:I,fieldInfoMap:h})}}_setChartValue(d){const{value:h,attributes:g,formattedAttributes:y,chartType:v,layer:b,expressionAttributes:M}=d,{popupTemplate:I,relatedInfos:_}=this,{fields:x,normalizeField:E}=h,P=b;if(h.fields=function ls(d,h){return d&&d.map(g=>at(g,h))}(x,P),E&&(h.normalizeField=at(E,P)),!x.some(O=>!!(null!=y[O]||Oe(O)&&_?.size)))return;const L=I?.fieldInfos??[];x.forEach((O,N)=>{const Z=h.colors?.[N];if(Oe(O))return void(h.series=[...h.series,...this._getRelatedChartInfos({fieldInfos:L,fieldName:O,formattedAttributes:y,chartType:v,value:h,color:Z})]);const W=this._getChartOption({value:h,attributes:g,chartType:v,formattedAttributes:y,expressionAttributes:M,fieldName:O,fieldInfos:L,color:Z});h.series.push(W)})}_getRelatedChartInfos(d){const{fieldInfos:h,fieldName:g,formattedAttributes:y,chartType:v,value:b,color:M}=d,I=[],_=At(g),x=_&&this.relatedInfos?.get(_.layerId.toString());if(!x)return I;const{relatedFeatures:E,relation:P}=x;if(!P||!E)return I;const{cardinality:L}=P;return E.forEach(O=>{const{attributes:N}=O;N&&Object.keys(N).forEach(Z=>{Z===_.fieldName&&I.push(this._getChartOption({value:b,attributes:N,formattedAttributes:y,fieldName:g,chartType:v,relatedFieldName:Z,hasMultipleRelatedFeatures:E?.length>1,fieldInfos:h,color:M}))})}),"one-to-many"===L||"many-to-many"===L?I:[I[0]]}_getTooltip({label:d,value:h,chartType:g}){return"pie-chart"===g?`${d}`:`${d}: ${h}`}_getChartOption(d){const{value:h,attributes:g,formattedAttributes:y,expressionAttributes:v,fieldName:b,relatedFieldName:M,fieldInfos:I,chartType:_,hasMultipleRelatedFeatures:x,color:E}=d,P=this.layer,L=this.fieldInfoMap??new Map,{normalizeField:O,tooltipField:N}=h,Z=O?Oe(O)?g[At(O).fieldName]:g[O]:null,W=Vt(b)&&v&&void 0!==v[b]?v[b]:M&&void 0!==g[M]?g[M]:void 0!==g[b]?g[b]:y[b],B=new Ds.Z({fieldName:b,color:E,value:void 0===W?null:W&&Z?W/Z:W});if(Oe(b)){const $e=L.get(b.toLowerCase()),Ze=N&&L.get(N.toLowerCase()),cr=$e?.fieldName??b,Pi=x&&N?At(N).fieldName:Ze?.fieldName??N;return B.tooltip=this._getTooltip({label:x&&Pi?g[Pi]:y[Pi]??$e?.label??$e?.fieldName??M,value:x&&M?g[M]:y[cr],chartType:_}),B}const Q=Wi(I,b),k=at(b,P),ae=N&&void 0!==y[N]?y[N]:zi(Q||new nn.Z({fieldName:k}),this.popupTemplate?.expressionInfos);return B.tooltip=this._getTooltip({label:ae,value:y[k],chartType:_}),B}};(0,w._)([(0,F.Cb)()],ee.prototype,"abilities",void 0),(0,w._)([(0,ye.p)("abilities")],ee.prototype,"castAbilities",null),(0,w._)([(0,F.Cb)()],ee.prototype,"activeMediaInfoIndex",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ee.prototype,"activeMediaInfo",null),(0,w._)([(0,F.Cb)()],ee.prototype,"attributes",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"description",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"fieldInfoMap",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"formattedAttributes",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"expressionAttributes",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ee.prototype,"formattedMediaInfos",null),(0,w._)([(0,F.Cb)()],ee.prototype,"isAggregate",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"layer",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ee.prototype,"formattedMediaInfoCount",null),(0,w._)([(0,F.Cb)()],ee.prototype,"mediaInfos",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"popupTemplate",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"relatedInfos",void 0),(0,w._)([(0,F.Cb)()],ee.prototype,"title",void 0),ee=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ee);const He=ee;var ro=C(55774),Re=C(36766);const te="esri-feature-media",pe={base:te,mediaContainer:`${te}__container`,mediaItemContainer:`${te}__item-container`,mediaItem:`${te}__item`,mediaItemText:`${te}__item-text`,mediaItemTitle:`${te}__item-title`,mediaItemCaption:`${te}__item-caption`,mediaNavigation:`${te}__item-navigation`,mediaPagination:`${te}__pagination`,mediaPaginationText:`${te}__pagination-text`,mediaPrevious:`${te}__previous`,mediaPreviousIconLTR:`${te}__previous-icon`,mediaPreviousIconRTL:`${te}__previous-icon--rtl`,mediaNext:`${te}__next`,mediaNextIconLTR:`${te}__next-icon`,mediaNextIconRTL:`${te}__next-icon--rtl`,mediaChart:`${te}__chart`,mediaPaginationButton:`${te}__pagination-button`,mediaPaginationIcon:`${te}__pagination-icon`,mediaChartRendered:`${te}__chart--rendered`},ze="category",ut="value";let me=class extends le.Z{constructor(d,h){var g;super(d,h),g=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new He,this.messages=null,this._disposeChart=y=>{this._chartRootMap.get(y)?.dispose(),this._chartRootMap.delete(y)},this._createChart=function(){var y=(0,R.Z)(function*(v){const{destroyed:b,viewModel:M}=g;if(b||!M||!v)return;const{createRoot:I}=yield Promise.all([C.e(1603),C.e(8592),C.e(1157)]).then(C.bind(C,21157)),_=yield I(v);g._chartRootMap.set(v,_),g._renderChart({mediaInfo:M.activeMediaInfo,root:_})});return function(v){return y.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new wt,this.addHandles([(0,T.YP)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),T.nn),(0,T.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),T.nn)])}loadDependencies(){return(0,it.h)({icon:()=>C.e(4540).then(C.bind(C,24540))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(d){this.viewModel.attributes=d}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(d){this.viewModel.activeMediaInfoIndex=d}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(d){this.viewModel.fieldInfoMap=d}get layer(){return this.viewModel.layer}set layer(d){this.viewModel.layer=d}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(d){this.viewModel.mediaInfos=d}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(d){this.viewModel.popupTemplate=d}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(d){this.viewModel.relatedInfos=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){return(0,A.u)("div",{bind:this,class:pe.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:d,activeMediaInfoIndex:h}=this.viewModel,g=this._renderMediaText();return d?(0,A.u)("div",{class:pe.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,A.u)("div",{class:pe.mediaNavigation},g,d>1?(0,A.u)("div",{class:pe.mediaPagination},this._renderMediaPageButton("previous"),(0,A.u)("span",{class:pe.mediaPaginationText},(0,Re.n)(this.messages.pageText,{index:h+1,total:d})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:d}=this.viewModel;if(!d)return null;const h=d&&d.title?(0,A.u)("div",{class:pe.mediaItemTitle,innerHTML:d.title,key:"media-title"}):null,g=d&&d.caption?(0,A.u)("div",{class:pe.mediaItemCaption,innerHTML:d.caption,key:"media-caption"}):null;return h||g?(0,A.u)("div",{class:pe.mediaItemText,key:"media-text"},h,g):null}_renderImageMediaInfo(d){const{_refreshIntervalInfo:h}=this,{activeMediaInfoIndex:g,formattedMediaInfoCount:y}=this.viewModel,{value:v,refreshInterval:b,altText:M,title:I,type:_}=d,{sourceURL:x,linkURL:E}=v,P=Bi(E??void 0)?"_blank":"_self",L="_blank"===P?"noreferrer":"",O=b?h:null,W=(0,A.u)("img",{alt:M||I,key:`media-${_}-${g}-${y}-${O?O.timestamp:0}`,src:(O?O.sourceURL:x)??void 0});return(E?(0,A.u)("a",{href:E,rel:L,target:P,title:I},W):null)??W}_renderChartMediaInfo(d){const{activeMediaInfoIndex:h,formattedMediaInfoCount:g}=this.viewModel;return(0,A.u)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:pe.mediaChart,key:`media-${d.type}-${h}-${g}`})}_renderMediaInfoType(){const{activeMediaInfo:d}=this.viewModel;return d?"image"===d.type?this._renderImageMediaInfo(d):d.type.includes("chart")?this._renderChartMediaInfo(d):null:null}_renderMediaInfo(){const{activeMediaInfo:d}=this.viewModel;return d?(0,A.u)("div",{class:pe.mediaItemContainer,key:"media-container"},(0,A.u)("div",{class:pe.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(d){if(this.viewModel.formattedMediaInfoCount<2)return null;const h="previous"===d,g=h?this.messages.previous:this.messages.next;return(0,A.u)("button",{"aria-label":g,bind:this,class:pe.mediaPaginationButton,key:h?"media-previous":"media-next",onclick:h?this._previous:this._next,tabIndex:0,title:g,type:"button"},(0,A.u)("calcite-icon",{class:pe.mediaPaginationIcon,icon:h?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const{description:d,title:h}=this;this._featureElementInfo?.set({description:d,title:h})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:d,layer:h}=this.viewModel;return d&&h?.featureReduction&&"renderer"in h.featureReduction?h.featureReduction.renderer:h?.renderer}_getSeriesColors(d){return(0,R.Z)(function*(){const{colorAm5:h}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),g=new Map;return d.forEach(y=>{y.color&&g.set(y,h(y.color.toCss(!0)))}),g})()}_getRendererColors(){var d=this;return(0,R.Z)(function*(){const{colorAm5:h}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),g=new Map,y=d._getRenderer();if(!y)return g;const b=yield(0,Zs.zB)(y);return b.delete("default"),Array.from(b.values()).every(M=>1===M?.length)&&Array.from(b.keys()).forEach(M=>{const I=b.get(M)?.[0]?.toCss(!0);I&&g.set(M,h(I))}),g})()}_handleMediaKeyup(d){const h=(0,Fe.kK)(d);"ArrowLeft"===h&&(d.stopPropagation(),this.viewModel.previous()),"ArrowRight"===h&&(d.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(d){var h=this;return(0,R.Z)(function*(){const{root:g,mediaInfo:y}=d,{value:v,type:b}=y,{ResponsiveThemeAm5:M,DarkThemeAm5:I,AnimatedThemeAm5:_,ColorSetAm5:x,ThemeAm5:E,esriChartColorSet:P}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),L=E.new(g);L.rule("ColorSet").set("colors",P),L.rule("ColorSet").set("reuse",!0);const O=[M.new(g),L];(0,ro.$o)()&&O.push(I.new(g)),h._canAnimateChart()&&O.push(_.new(g)),g.setThemes(O);const N=yield h._getRendererColors(),Z=yield h._getSeriesColors(v.series),W=x.new(g,{}),B=Z.get(v.series[0]),Q=B?{lineSettings:{stroke:B}}:void 0,k=v.series.map((ae,ft)=>{const $e=Z.get(ae)||N.get(ae.fieldName)||W.getIndex(ft);return{[ze]:ae.tooltip,[ut]:ae.value,columnSettings:{fill:$e,stroke:$e},...Q}}).filter(ae=>"pie-chart"!==b||null!=ae.value&&ae.value>0);"pie-chart"===b?h._createPieChart(d,k):h._createXYChart(d,k)})()}_getDirection(){return(0,Ae.dZ)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,Ae.dZ)(this.container)}_customizeChartTooltip(d,h="horizontal"){var g=this;return(0,R.Z)(function*(){const{colorAm5:y}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576));d.setAll({pointerOrientation:h}),d.get("background")?.setAll({stroke:y("rgba(50, 50, 50, 1)")}),d.label.setAll({direction:g._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(d,h){var g=this;return(0,R.Z)(function*(){const{TooltipAm5:y}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{PieChartAm5:v,PieSeriesAm5:b}=yield Promise.all([C.e(1603),C.e(4305),C.e(5498)]).then(C.bind(C,65498)),{mediaInfo:M,root:I}=d,{title:_}=M,P=I.container.children.push(v.new(I,{ariaLabel:M?.altText||M?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),L="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",O=y.new(I,{labelText:L}),N=P.series.push(b.new(I,{name:_,valueField:ut,categoryField:ze,tooltip:O}));N.ticks.template.set("forceHidden",!0),N.labels.template.set("forceHidden",!0),N.slices.template.states.create("active",{shiftRadius:5}),g._customizeChartTooltip(O),N.slices.template.setAll({ariaLabel:L,focusable:!0,templateField:"columnSettings"}),N.data.setAll(h),N.appear(g._getChartSeriesAnimationMS()),P.appear(g._getChartAnimationMS()),P.root.dom.classList.toggle(pe.mediaChartRendered,!0)})()}_getMinSeriesValue(d){let h=0;return d.forEach(g=>h=Math.min(g.value,h)),h}_createColumnChart(d,h,g){var y=this;return(0,R.Z)(function*(){const{TooltipAm5:v,ScrollbarAm5:b}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{CategoryAxisAm5:M,AxisRendererXAm5:I,ValueAxisAm5:_,AxisRendererYAm5:x,ColumnSeriesAm5:E}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{mediaInfo:P,root:L}=h,{value:O,title:N}=P;d.setAll({wheelX:"panX",wheelY:"zoomX"});const Z=d.xAxes.push(M.new(L,{renderer:I.new(L,{inversed:y._isInversed()}),categoryField:ze}));Z.get("renderer").labels.template.setAll({forceHidden:!0});const W=d.yAxes.push(_.new(L,{renderer:x.new(L,{inside:!1}),min:y._getMinSeriesValue(O.series)}));W.get("renderer").labels.template.setAll({direction:y._getDirection()});const B="{categoryX}",Q=v.new(L,{labelText:B}),k=d.series.push(E.new(L,{name:N,xAxis:Z,yAxis:W,valueYField:ut,categoryXField:ze,tooltip:Q}));y._customizeChartTooltip(Q),k.columns.template.setAll({ariaLabel:B,focusable:!0,templateField:"columnSettings"}),O.series.length>15&&d.set("scrollbarX",b.new(L,{orientation:"horizontal"})),Z.data.setAll(g),k.data.setAll(g),k.appear(y._getChartSeriesAnimationMS()),d.appear(y._getChartAnimationMS())})()}_createBarChart(d,h,g){var y=this;return(0,R.Z)(function*(){const{TooltipAm5:v,ScrollbarAm5:b}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{CategoryAxisAm5:M,AxisRendererXAm5:I,ValueAxisAm5:_,AxisRendererYAm5:x,ColumnSeriesAm5:E}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{mediaInfo:P,root:L}=h,{value:O,title:N}=P;d.setAll({wheelX:"panY",wheelY:"zoomY"});const Z=d.yAxes.push(M.new(L,{renderer:x.new(L,{inversed:!0}),categoryField:ze}));Z.get("renderer").labels.template.setAll({forceHidden:!0});const W=d.xAxes.push(_.new(L,{renderer:I.new(L,{inside:!1,inversed:y._isInversed()}),min:y._getMinSeriesValue(O.series)}));W.get("renderer").labels.template.setAll({direction:y._getDirection()});const B="{categoryY}",Q=v.new(L,{labelText:B}),k=d.series.push(E.new(L,{name:N,xAxis:W,yAxis:Z,valueXField:ut,categoryYField:ze,tooltip:Q}));y._customizeChartTooltip(Q,"vertical"),k.columns.template.setAll({ariaLabel:B,focusable:!0,templateField:"columnSettings"}),O.series.length>15&&d.set("scrollbarY",b.new(L,{orientation:"vertical"})),Z.data.setAll(g),k.data.setAll(g),k.appear(y._getChartSeriesAnimationMS()),d.appear(y._getChartAnimationMS())})()}_createLineChart(d,h,g){var y=this;return(0,R.Z)(function*(){const{TooltipAm5:v,ScrollbarAm5:b}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{CategoryAxisAm5:M,AxisRendererXAm5:I,ValueAxisAm5:_,AxisRendererYAm5:x,LineSeriesAm5:E}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{root:P,mediaInfo:L}=h,{value:O,title:N}=L;d.setAll({wheelX:"panX",wheelY:"zoomX"});const Z=d.xAxes.push(M.new(P,{renderer:I.new(P,{inversed:y._isInversed()}),categoryField:ze}));Z.get("renderer").labels.template.setAll({forceHidden:!0});const W=d.yAxes.push(_.new(P,{renderer:x.new(P,{inside:!1}),min:y._getMinSeriesValue(O.series)}));W.get("renderer").labels.template.setAll({direction:y._getDirection()});const Q=g[0]?.lineSettings?.stroke,k=v.new(P,{getFillFromSprite:!Q,labelText:"{categoryX}"});Q&&k.get("background")?.setAll({fill:Q});const ae=d.series.push(E.new(P,{name:N,xAxis:Z,yAxis:W,valueYField:ut,categoryXField:ze,tooltip:k}));ae.strokes.template.setAll({templateField:"lineSettings"}),y._customizeChartTooltip(k,"vertical"),O.series.length>15&&d.set("scrollbarX",b.new(P,{orientation:"horizontal"})),Z.data.setAll(g),ae.data.setAll(g),ae.appear(y._getChartSeriesAnimationMS()),d.appear(y._getChartAnimationMS())})()}_createXYChart(d,h){var g=this;return(0,R.Z)(function*(){const{XYChartAm5:y,XYCursorAm5:v}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{root:b,mediaInfo:M}=d,{type:I}=M,x=b.container.children.push(y.new(b,{ariaLabel:M?.altText||M?.title||"",focusable:!0,panX:!0,panY:!0}));x.set("cursor",v.new(b,{})),"column-chart"===I&&(yield g._createColumnChart(x,d,h)),"bar-chart"===I&&(yield g._createBarChart(x,d,h)),"line-chart"===I&&(yield g._createLineChart(x,d,h)),x.root.dom.classList.toggle(pe.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:d}=this;d&&(clearTimeout(d),this._refreshTimer=null)}_updateMediaInfoTimestamp(d){const h=Date.now();this._refreshIntervalInfo={timestamp:h,sourceURL:d&&this._getImageSource(d,h)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:d}=this.viewModel;d&&"image"===d.type&&d.refreshInterval&&this._setRefreshTimeout(d)}_setRefreshTimeout(d){const{refreshInterval:h,value:g}=d;if(!h)return;const y=6e4*h;this._updateMediaInfoTimestamp(g.sourceURL);const v=setInterval(()=>{this._updateMediaInfoTimestamp(g.sourceURL)},y);this._refreshTimer=v}_getImageSource(d,h){const g=d.includes("?")?"&":"?",[y,v=""]=d.split("#");return`${y}${g}timestamp=${h}${v?"#":""}${v}`}};(0,w._)([(0,F.Cb)()],me.prototype,"_refreshIntervalInfo",void 0),(0,w._)([(0,F.Cb)()],me.prototype,"attributes",null),(0,w._)([(0,F.Cb)()],me.prototype,"activeMediaInfoIndex",null),(0,w._)([(0,F.Cb)()],me.prototype,"description",null),(0,w._)([(0,F.Cb)()],me.prototype,"fieldInfoMap",null),(0,w._)([(0,F.Cb)()],me.prototype,"layer",null),(0,w._)([(0,F.Cb)()],me.prototype,"mediaInfos",null),(0,w._)([(0,F.Cb)()],me.prototype,"popupTemplate",null),(0,w._)([(0,F.Cb)()],me.prototype,"relatedInfos",null),(0,w._)([(0,F.Cb)()],me.prototype,"title",null),(0,w._)([(0,F.Cb)({type:He})],me.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Feature/t9n/Feature")],me.prototype,"messages",void 0),me=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureMedia")],me);const ln=me;C(20004),C(37462),C(52225),C(49497);var ho=C(90629),po=C(57229),dn=(C(98522),C(23002)),mo=C(43573),fo=C(90373);const go=["$datastore","$map","$layer","$aggregatedfeatures"],vo=J.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function bo(d){return"string"==typeof d?lt(zt(d)):Array.isArray(d)?function wo(d){return`<ul class="esri-widget__list">${d.map(h=>`<li>${"string"==typeof h?lt(zt(h)):h}</li>`).join("")}</ul>`}(d):"esri.arcade.Dictionary"===d?.declaredClass?function Co(d){return`<table class="esri-widget__table">${d.keys().map(h=>{const g=d.field(h);return`<tr><th>${h}</th><td>${"string"==typeof g?lt(zt(g)):g}</td></tr>`}).join("")}</table>`}(d):d}function un(){return Promise.all([C.e(3866),C.e(4025)]).then(C.bind(C,34025))}function Io(d){return ai.apply(this,arguments)}function ai(){return(ai=(0,R.Z)(function*({graphic:d,view:h}){const{isAggregate:g,layer:y}=d;if(!g||!y||"2d"!==h?.type)return[];const v=yield h.whenLayerView(y);if(!function Mo(d){return"createQuery"in d&&"queryFeatures"in d}(v))return[];const b=v.createQuery(),M=d.getObjectId();b.aggregateIds=null!=M?[M]:[];const{features:I}=yield v.queryFeatures(b);return I})).apply(this,arguments)}function cn(d){return li.apply(this,arguments)}function li(){return(li=(0,R.Z)(function*({expressionInfo:d,arcadeUtils:h,interceptor:g,spatialReference:y,map:v,graphic:b,view:M}){if(!d?.expression)return null;const I=h.createSyntaxTree(d.expression),_=go.filter(O=>h.hasVariable(I,O)),[x]=yield Promise.all([Io({graphic:b,view:M}),h.loadScriptDependencies(I,!0,_)]),E=h.getViewInfo({spatialReference:y}),P=h.createExecContext(b,E,M?.timeZone);P.interceptor=g,P.useAsync=!0,function Fo({aggregatedFeatures:d,arcadeUtils:h,featureSetVars:g,context:y,viewInfo:v,map:b,graphic:M,interceptor:I}){g.forEach(_=>{const x=_.toLowerCase(),E=v.sr;if("$map"===x&&(y.vars[x]=h.convertMapToFeatureSetCollection({map:b,spatialReference:E,interceptor:I})),"$layer"===x&&(y.vars[x]=h.convertFeatureLayerToFeatureSet({layer:M.sourceLayer,spatialReference:E,interceptor:I})),"$datastore"===x&&(y.vars[x]=h.convertServiceUrlToWorkspace({url:M.sourceLayer.url,spatialReference:E,interceptor:I})),"$aggregatedfeatures"===x){const L=M.layer,{fields:O,objectIdField:N,geometryType:Z,spatialReference:W,displayField:B}=L,Q=new fo.default({fields:O,objectIdField:N,geometryType:Z,spatialReference:W,displayField:B,..."feature"===L.type?{templates:L.templates,typeIdField:L.typeIdField,types:L.types}:null,source:d});y.vars[x]=h.convertFeatureLayerToFeatureSet({layer:Q,spatialReference:W,interceptor:I})}})}({aggregatedFeatures:x,arcadeUtils:h,featureSetVars:_,context:P,viewInfo:E,map:v,graphic:b,interceptor:g});const L=h.createFunction(I,P);return h.executeAsyncFunction(L,P).catch(O=>vo.error("arcade-execution-error",{error:O,graphic:b,expressionInfo:d}))})).apply(this,arguments)}function _o(d){return di.apply(this,arguments)}function di(){return(di=(0,R.Z)(function*({expressionInfos:d,spatialReference:h,graphic:g,interceptor:y,map:v,view:b}){if(!d?.length)return{};const M=yield un(),I={};for(const E of d)I[`expression/${E.name}`]=cn({expressionInfo:E,arcadeUtils:M,interceptor:y,spatialReference:h,map:v,graphic:g,view:b});const _=yield(0,oe.as)(I),x={};for(const E in _)x[E]=bo(_[E].value);return x})).apply(this,arguments)}let we=class extends Le.Z{constructor(d){var h;super(d),h=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:g}=this;g&&g.abort(),this._abortController=null},this._createVM=()=>{const g=this.contentElement?.type;this.contentElementViewModel?.destroy();const y="fields"===g?new Mt:"media"===g?new He:"text"===g?new Ct:null;this._set("contentElementViewModel",y)},this._compile=(0,R.Z)(function*(){h._cancelQuery();const g=new AbortController;h._abortController=g,yield h._compileExpression(),h._abortController===g&&(h._abortController=null)}),this._compileThrottled=(0,he.P)(this._compile,1,this),this._compileExpression=(0,R.Z)(function*(){const{expressionInfo:g,graphic:y,interceptor:v,spatialReference:b,map:M,view:I,_abortController:_}=h;if(!(g&&y&&b&&M))return void h._set("contentElement",null);const x=yield un();if(_!==h._abortController)return;const E=yield cn({arcadeUtils:x,expressionInfo:g,graphic:y,interceptor:v,map:M,spatialReference:b,view:I});if(!E||"esri.arcade.Dictionary"!==E.declaredClass)return void h._set("contentElement",null);const P=yield E.castAsJsonAsync(_?.signal),L=P?.type,O="media"===L?po.Z.fromJSON(P):"text"===L?dn.Z.fromJSON(P):"fields"===L?ho.Z.fromJSON(P):null;h._set("contentElement",O)}),this.addHandles([(0,T.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),T.nn),(0,T.YP)(()=>[this.contentElement],()=>this._createVM(),T.nn)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(d){this._override("spatialReference",d)}get state(){const{_abortController:d,contentElement:h,contentElementViewModel:g}=this;return d?"loading":h||g?"ready":"disabled"}get map(){return this.view?.map??null}set map(d){this._override("map",d)}};(0,w._)([(0,F.Cb)()],we.prototype,"_abortController",void 0),(0,w._)([(0,F.Cb)({type:mo.Z})],we.prototype,"expressionInfo",void 0),(0,w._)([(0,F.Cb)({type:tt.Z})],we.prototype,"graphic",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],we.prototype,"contentElement",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],we.prototype,"contentElementViewModel",void 0),(0,w._)([(0,F.Cb)()],we.prototype,"interceptor",void 0),(0,w._)([(0,F.Cb)()],we.prototype,"spatialReference",null),(0,w._)([(0,F.Cb)({readOnly:!0})],we.prototype,"state",null),(0,w._)([(0,F.Cb)()],we.prototype,"map",null),(0,w._)([(0,F.Cb)()],we.prototype,"view",void 0),we=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],we);const ui=we,ci="esri-feature",hi={base:`${ci}-expression`,loadingSpinnerContainer:`${ci}__loading-container`,spinner:`${ci}__loading-spinner`};let xt=class extends le.Z{constructor(d,h){super(d,h),this._contentWidget=null,this.viewModel=new ui}initialize(){this.addHandles((0,T.YP)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),T.nn))}destroy(){this._destroyContentWidget()}render(){const{state:d}=this.viewModel;return(0,A.u)("div",{class:hi.base},"loading"===d?this._renderLoading():"disabled"===d?null:this._contentWidget?.render())}_renderLoading(){return(0,A.u)("div",{class:hi.loadingSpinnerContainer,key:"loading-container"},(0,A.u)("span",{class:this.classes(Me.W.loadingIndicator,U.z.rotating,hi.spinner)}))}_destroyContentWidget(){const{_contentWidget:d}=this;d&&(d.viewModel=null,d.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:d,contentElement:h}=this.viewModel,g=h?.type;this._destroyContentWidget();const y=d?"fields"===g?new sn({viewModel:d}):"media"===g?new ln({viewModel:d}):"text"===g?new Ft({viewModel:d}):null:null;this._contentWidget=y,this.scheduleRender()}};(0,w._)([(0,F.Cb)({type:ui})],xt.prototype,"viewModel",void 0),xt=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureExpression")],xt);const xo=xt;var pi,Eo=C(51172),To=C(25387),hn=C(84373);C(480),C(73191),C(42534),(pi||(pi={})).TOO_SHORT="length-validation-error::too-short";const No=d=>{const h=[];if(d.formTemplate){const{description:g,title:y}=d.formTemplate;d.fields?.forEach(v=>{const b=y&&(0,De.pZ)(y,v.name),M=g&&(0,De.pZ)(g,v.name);(b||M)&&h.push(v.name)})}return h};let H=class extends((0,To.J)((0,hn.IG)(Le.Z))){constructor(d){var h;super(d),h=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:g}=this;g&&g.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:g}=this;g&&g.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:g}=this;g&&g.abort(),this._queryPageAbortController=null},this._queryController=(0,R.Z)(function*(){h._cancelQuery();const g=new AbortController;h._queryAbortController=g,yield(0,oe.R8)(h._query()),h._queryAbortController===g&&(h._queryAbortController=null)}),this._queryFeatureCountController=(0,R.Z)(function*(){h._loaded=!1,h._cancelQueryFeatureCount();const g=new AbortController;h._queryFeatureCountAbortController=g,yield(0,oe.R8)(h._queryFeatureCount()),h._queryFeatureCountAbortController===g&&(h._queryFeatureCountAbortController=null),h._loaded=!0}),this._queryPageController=(0,R.Z)(function*(){const g=new AbortController;h._queryPageAbortController=g,yield(0,oe.R8)(h._queryPage()),h._queryPageAbortController===g&&(h._queryPageAbortController=null)}),this._queryDebounced=(0,oe.Ds)(this._queryController,100),this._queryFeatureCountDebounced=(0,oe.Ds)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,oe.Ds)(this._queryPageController,100),this._query=(0,R.Z)(function*(){const{_queryAbortController:g,relatedFeatures:y}=h;h.featureCount&&(h._destroyRelatedFeatureViewModels(),h.featurePage=1,y.removeAll(),h.destroyed||y.addMany(h._sliceFeatures(yield h._queryRelatedFeatures({signal:g?.signal}))))}),this.addHandles([(0,T.YP)(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),T.nn),(0,T.YP)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,T.YP)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(d){const{featuresPerPage:h,featureCount:g}=this,v=Math.ceil(g/h)||1;this._set("featurePage",Math.min(Math.max(d,1),v))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:d,relatedLayer:h}=this;return d&&h?.loaded?d.map(g=>{const y=g.clone();return y.field=at(g.field,h),y}):d??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const d=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&d?.supportsCount&&d?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(d){this._set("displayCount",Math.min(Math.max(d,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new Ce.Z}get relatedLayer(){const{layer:d,map:h,relationship:g}=this;return d?.loaded&&h&&g?function Es(d,h,g){return d&&h&&g?Ki(d.allLayers,h,g)||Ki(d.allTables,h,g):null}(h,d,g)??null:null}get relationship(){const{relationshipId:d,layer:h}=this;return"number"==typeof d?h?.relationships?.find(({id:g})=>g===d)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Ce.Z}get state(){const{_queryAbortController:d,_queryFeatureCountAbortController:h,_queryPageAbortController:g,canQuery:y,_loaded:v,canLoad:b}=this;return h||b&&!v?"loading":d||g?"querying":y?"ready":"disabled"}getRelatedFeatureByObjectId(d){return this.relatedFeatures.find(h=>h.getObjectId()===d)}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(d=>!d.destroyed&&d.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var d=this;return(0,R.Z)(function*(){const{layer:h,relatedLayer:g,relationshipId:y,objectId:v,_queryFeatureCountAbortController:b,canQuery:M,supportsCacheHint:I}=d;if(yield h?.load(),yield g?.load(),!M||!h||!g)return void d._set("featureCount",0);const _=g.createQuery(),x=new si.default({cacheHint:I,relationshipId:y,returnGeometry:!1,objectIds:[v],where:_.where??void 0}),E=yield h.queryRelatedFeaturesCount(x,{signal:b?.signal});d._set("featureCount",E[v]||0)})()}_sliceFeatures(d){const{showAllEnabled:h,displayCount:g}=this;return h?d:g?d.slice(0,g):[]}_queryPage(){var d=this;return(0,R.Z)(function*(){const{relatedFeatures:h,featurePage:g,showAllEnabled:y,_queryPageAbortController:v,featureCount:b}=d;!y||g<2||!b||h.addMany(yield d._queryRelatedFeatures({signal:v?.signal}))})()}_queryRelatedFeatures(d){var h=this;return(0,R.Z)(function*(){const{orderByFieldsFixedCasing:g,showAllEnabled:y,featuresPerPage:v,displayCount:b,layer:M,relationshipId:I,featurePage:_,featureCount:x,relatedLayer:E,supportsCacheHint:P}=h,{canQuery:L,objectId:O}=h;if(!L||!M||!E)return[];const N=y?((_-1)*v+x)%x:0,Z=y?v:b,W=E.objectIdField,B=[...g.map(Ze=>Ze.field),...No(E),W].filter(ge.pC),Q=g.map(Ze=>`${Ze.field} ${Ze.order}`),k=E.createQuery(),ae=new si.default({orderByFields:Q,start:N,num:Z,outFields:B,cacheHint:P,relationshipId:I,returnGeometry:!1,objectIds:[O],where:k.where??void 0}),ft=yield M.queryRelatedFeatures(ae,{signal:d?.signal}),$e=ft[O]?.features||[];return $e.forEach(Ze=>{Ze.sourceLayer=E,Ze.layer=E}),$e})()}};(0,w._)([(0,F.Cb)()],H.prototype,"_loaded",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"_queryAbortController",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"_queryPageAbortController",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"_queryFeatureCountAbortController",void 0),(0,w._)([(0,F.Cb)({value:1})],H.prototype,"featurePage",null),(0,w._)([(0,F.Cb)()],H.prototype,"featuresPerPage",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"orderByFieldsFixedCasing",null),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"supportsCacheHint",null),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"canLoad",null),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"canQuery",null),(0,w._)([(0,F.Cb)()],H.prototype,"description",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"itemDescriptionFieldName",null),(0,w._)([(0,F.Cb)({value:3})],H.prototype,"displayCount",null),(0,w._)([(0,F.Cb)({type:tt.Z})],H.prototype,"graphic",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"layer",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"map",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"objectId",null),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"objectIdField",null),(0,w._)([(0,F.Cb)()],H.prototype,"orderByFields",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"relatedFeatures",null),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"relatedLayer",null),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"relationship",null),(0,w._)([(0,F.Cb)()],H.prototype,"featureCount",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],H.prototype,"relatedFeatureViewModels",null),(0,w._)([(0,F.Cb)()],H.prototype,"relationshipId",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"showAllEnabled",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"state",null),(0,w._)([(0,F.Cb)()],H.prototype,"title",void 0),(0,w._)([(0,F.Cb)()],H.prototype,"getRelatedFeatureByObjectId",null),H=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],H);const fi=H,ct="esri-feature",ht=`${ct}-relationship`,Ne={base:ht,listContainer:`${ht}__list`,listItem:`${ht}__list-item`,listItemHidden:`${ht}__list-item--hidden`,listContainerQuerying:`${ht}__list--querying`,featureObserver:`${ct}__feature-observer`,stickySpinnerContainer:`${ct}__sticky-loading-container`,loadingSpinnerContainer:`${ct}__loading-container`,spinner:`${ct}__loading-spinner`},bn={title:!0,description:!0};let fe=class extends le.Z{constructor(d,h){super(d,h),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([g])=>{g?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new fi,this.messages=null,this.messagesCommon=null,this.visibleElements={...bn},this._increaseFeaturePage=()=>{const{state:g,showAllEnabled:y,relatedFeatures:v,featuresPerPage:b,featurePage:M}=this.viewModel;"ready"===g&&y&&v.length>=b*M&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new wt,this.addHandles([(0,T.YP)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),T.nn),(0,T.YP)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,T.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,it.h)({icon:()=>C.e(4540).then(C.bind(C,24540)),list:()=>Promise.all([C.e(7771),C.e(2102),C.e(8592),C.e(6985)]).then(C.bind(C,66985)),"list-item":()=>Promise.all([C.e(7771),C.e(5782),C.e(8592),C.e(9475)]).then(C.bind(C,99475)),notice:()=>Promise.all([C.e(7771),C.e(2347)]).then(C.bind(C,72347))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,Eo.SC)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:d,featureCount:h,displayCount:g,state:y}=this.viewModel;return!d&&!!h&&"ready"===y&&(h>g||0===g)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get featureCountDescription(){const{messages:d}=this,{featureCount:h}=this.viewModel;return(0,Re.n)(d?.numberRecords,{number:h})}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}castVisibleElements(d){return{...bn,...d}}render(){const{state:d}=this.viewModel;return(0,A.u)("div",{class:this.classes(Ne.base,U.z.widget)},this._featureElementInfo?.render(),"loading"===d?this._renderLoading():"disabled"===d?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,A.u)("div",{class:Ne.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,A.u)("span",{class:this.classes(Me.W.loadingIndicator,U.z.rotating,Ne.spinner)})}_renderLoading(){return(0,A.u)("div",{class:Ne.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,A.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const d=(0,Ae.dZ)(this.container)?"chevron-left":"chevron-right";return(0,A.u)("calcite-icon",{icon:d,scale:"s",slot:"content-end"})}_renderRelatedFeature(d){const{itemDescriptionFieldName:h}=this.viewModel,g=d.title;return d.description=h&&d.formattedAttributes?.global[h],(0,A.u)("calcite-list-item",{class:this.classes(Ne.listItem,{[Ne.listItemHidden]:"loading"===d.state}),description:d.description??"",key:d.uid,label:g,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:d})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,A.u)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,A.u)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,A.u)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,A.u)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Ne.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:d}=this.viewModel;return(0,A.u)("calcite-list",null,d.toArray().map(h=>this._renderRelatedFeature(h)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:d}=this,{state:h}=this.viewModel;return(0,A.u)("div",{class:this.classes(Ne.listContainer,{[Ne.listContainerQuerying]:"querying"===h}),key:"list-container"},d?this._renderList():"ready"===h?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,A.u)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,A.u)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:d}=this.viewModel,h="related-feature-viewmodels";this.removeHandles(h),d?.forEach(g=>{this.addHandles((0,T.YP)(()=>[g.title,g.state],()=>this.scheduleRender(),T.nn),h)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:d,visibleElements:h}=this,g=h.description&&this.description,y=h.title&&this.title;this._featureElementInfo?.set({description:g,title:y,headingLevel:d})}_handleRelatedFeatureObserverChange(){var d=this;return(0,R.Z)(function*(){d._unobserveRelatedFeatureObserver();const{state:h,showAllEnabled:g}=d.viewModel;yield(0,oe.e4)(0),d._relatedFeatureIntersectionObserverNode&&"ready"===h&&g&&d._relatedFeatureIntersectionObserver.observe(d._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(d){this._relatedFeatureIntersectionObserverNode=d}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,w._)([(0,F.Cb)()],fe.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],fe.prototype,"displayShowAllButton",null),(0,w._)([(0,F.Cb)({readOnly:!0})],fe.prototype,"displayListItems",null),(0,w._)([(0,F.Cb)()],fe.prototype,"description",null),(0,w._)([(0,F.Cb)({readOnly:!0})],fe.prototype,"featureCountDescription",null),(0,w._)([(0,F.Cb)()],fe.prototype,"headingLevel",void 0),(0,w._)([(0,F.Cb)()],fe.prototype,"title",null),(0,w._)([(0,F.Cb)({type:fi})],fe.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Feature/t9n/Feature")],fe.prototype,"messages",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/t9n/common")],fe.prototype,"messagesCommon",void 0),(0,w._)([(0,F.Cb)()],fe.prototype,"visibleElements",void 0),(0,w._)([(0,ye.p)("visibleElements")],fe.prototype,"castVisibleElements",null),fe=(0,w._)([(0,V.j)("esri.widgets.Feature.FeatureRelationship")],fe);const wn=fe;var pt;const Cn="content-view-models",Fn="relationship-view-models",Mn={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let G=pt=class extends((0,hn.IG)(Le.Z)){constructor(d){super(d),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=(0,he.P)(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Mn},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=h=>{const{abilities:g}=this;return"attachments"===h.type&&!!g.attachmentsContent||"custom"===h.type&&!!g.customContent||"fields"===h.type&&!!g.fieldsContent||"media"===h.type&&!!g.mediaContent||"text"===h.type&&!!g.textContent||"expression"===h.type&&!!g.expressionContent||"relationship"===h.type&&!!g.relationshipContent},this.addHandles((0,T.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),T.nn))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function Cs(d,h){const g=new Map;return d&&d.forEach(y=>{const v=at(y.fieldName,h);y.fieldName=v,g.set(v.toLowerCase(),y)}),g}(Hi(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Di(this.graphic)}castAbilities(d){return{...Mn,...d}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(d){this._set("graphic",d?d.clone():null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(d){this._override("spatialReference",d)}get map(){return this.view?.map||null}set map(d){this._override("map",d)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(d,h){const g=this.contentViewModels[d];g instanceof He&&g.setActiveMedia(h)}nextMedia(d){const h=this.contentViewModels[d];h instanceof He&&h.next()}previousMedia(d){const h=this.contentViewModels[d];h instanceof He&&h.previous()}updateGeometry(){var d=this;return(0,R.Z)(function*(){const{graphic:h,spatialReference:g,_sourceLayer:y}=d;yield y?.load();const v=y?.objectIdField;if(!v||!h||!y)return;const b=h?.attributes?.[v];if(null==b)return;const M=[b];if(!h.geometry){const I=yield ki({layer:y,graphic:h,outFields:[],objectIds:M,returnGeometry:!0,spatialReference:g}),_=I?.geometry;_&&(h.geometry=_)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var d=this;return(0,R.Z)(function*(){d._cancelFeatureQuery(),d._error=null,d._clear();const{graphic:h}=d;if(!h)return;const g=new AbortController;d._featureAbortController=g;try{yield d._queryFeature({signal:g.signal})}catch(y){(0,oe.D_)(y)||(d._error=y,J.Z.getLogger(d).error("error","The popupTemplate could not be displayed for this feature.",{error:y,graphic:h,popupTemplate:d._effectivePopupTemplate}))}d._featureAbortController===g&&(d._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:d}=this;d&&d.abort(),this._featureAbortController=null}_compileContentElement(d,h){return"attachments"===d.type?this._compileAttachments(d,h):"custom"===d.type?this._compileCustom(d,h):"fields"===d.type?this._compileFields(d,h):"media"===d.type?this._compileMedia(d,h):"text"===d.type?this._compileText(d,h):"expression"===d.type?this._compileExpression(d,h):"relationship"===d.type?this._compileRelationship(d,h):void 0}_compileContent(d){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(d)?d.filter(this._isAllowedContentType).map((h,g)=>this._compileContentElement(h,g)).filter(ge.pC):"string"==typeof d?this._compileText(new dn.Z({text:d}),0).text:d}_destroyContentViewModels(){this.removeHandles(Fn),this.removeHandles(Cn),this.contentViewModels.forEach(d=>d&&!d.destroyed&&d.destroy()),this._set("contentViewModels",[])}_matchesFeature(d,h){const g=d?.graphic?.getObjectId(),y=h?.getObjectId();return null!=g&&null!=y&&g===y}_setRelatedFeaturesViewModels({relatedFeatureViewModels:d,relatedFeatures:h,map:g}){const{view:y,spatialReference:v}=this;h?.filter(Boolean).forEach(b=>{d.find(M=>this._matchesFeature(M,b))||d.add(new pt({abilities:{relationshipContent:!1},map:g,view:y,spatialReference:v,graphic:b}))}),d.forEach(b=>{h?.find(I=>this._matchesFeature(b,I))||d.remove(b)})}_setExpressionContentVM(d,h){const g=this.formattedAttributes,{contentElement:y,contentElementViewModel:v}=d,b=y?.type;v&&b&&("fields"===b&&(this._createFieldsFormattedAttributes({contentElement:y,contentElementIndex:h,formattedAttributes:g}),v.set(this._createFieldsVMParams(y,h))),"media"===b&&(this._createMediaFormattedAttributes({contentElement:y,contentElementIndex:h,formattedAttributes:g}),v.set(this._createMediaVMParams(y,h))),"text"===b&&v.set(this._createTextVMParams(y)))}_compileRelationship(d,h){const{displayCount:g,orderByFields:y,relationshipId:v,title:b,description:M}=d,{_sourceLayer:I,graphic:_,map:x}=this;if(!Dt(I))return;const E=new fi({displayCount:g,graphic:_,orderByFields:y,relationshipId:v,layer:I,map:x,...this._compileTitleAndDesc({title:b,description:M})});return this.contentViewModels[h]=E,this.addHandles((0,T.on)(()=>E.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(E)),Fn),d}_compileExpression(d,h){const{expressionInfo:g}=d,{graphic:y,map:v,spatialReference:b,view:M}=this,I=new ui({expressionInfo:g,graphic:y,interceptor:pt.interceptor,map:v,spatialReference:b,view:M});return this.contentViewModels[h]=I,this.addHandles((0,T.YP)(()=>I.contentElementViewModel,()=>this._setExpressionContentVM(I,h),T.nn),Cn),d}_compileAttachments(d,h){const{graphic:g}=this,{description:y,title:v}=d;return this.contentViewModels[h]=new Qt({graphic:g,...this._compileTitleAndDesc({title:v,description:y})}),d}_compileCustom(d,h){const{graphic:g}=this,{creator:y,destroyer:v}=d;return this.contentViewModels[h]=new Ct({graphic:g,creator:y,destroyer:v}),d}_compileTitleAndDesc({title:d,description:h}){const{_fieldInfoMap:g,_sourceLayer:y,graphic:v,formattedAttributes:b}=this,M=v?.attributes,I=this._expressionAttributes,_=b.global;return{title:We({attributes:M,fieldInfoMap:g,globalAttributes:_,expressionAttributes:I,layer:y,text:d}),description:We({attributes:M,fieldInfoMap:g,globalAttributes:_,expressionAttributes:I,layer:y,text:h})}}_createFieldsVMParams(d,h){const g=this._effectivePopupTemplate,y=this.formattedAttributes,v={...y?.global,...y?.content[h]},b=d?.fieldInfos||g?.fieldInfos,M=b?.filter(({fieldName:E})=>Vt(E)||Oe(E)||v.hasOwnProperty(E)),I=g?.expressionInfos,{description:_,title:x}=d;return{attributes:v,expressionInfos:I,fieldInfos:M,...this._compileTitleAndDesc({title:x,description:_})}}_compileFields(d,h){const g=d.clone(),y=new Mt(this._createFieldsVMParams(d,h));return this.contentViewModels[h]=y,g.fieldInfos=y.formattedFieldInfos.slice(0),g}_createMediaVMParams(d,h){const{abilities:g,graphic:y,_fieldInfoMap:v,_effectivePopupTemplate:b,relatedInfos:M,_sourceLayer:I,_expressionAttributes:_}=this,x=this.formattedAttributes,E=y?.attributes??{},{description:P,mediaInfos:L,title:O}=d;return{abilities:{chartAnimation:g.chartAnimation},activeMediaInfoIndex:d.activeMediaInfoIndex||0,attributes:E,isAggregate:y?.isAggregate,layer:I,fieldInfoMap:v,formattedAttributes:{...x?.global,...x?.content[h]},expressionAttributes:_,mediaInfos:L,popupTemplate:b,relatedInfos:M,...this._compileTitleAndDesc({title:O,description:P})}}_compileMedia(d,h){const g=d.clone(),y=new He(this._createMediaVMParams(d,h));return g.mediaInfos=y.formattedMediaInfos.slice(0),this.contentViewModels[h]=y,g}_createTextVMParams(d){const{graphic:h,_fieldInfoMap:g,_sourceLayer:y,_expressionAttributes:v}=this;return d&&d.text&&(d.text=We({attributes:h?.attributes??{},fieldInfoMap:g,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:v,layer:y,text:d.text})),{graphic:h,creator:d.text}}_compileText(d,h){const g=d.clone();return this.contentViewModels[h]=new Ct(this._createTextVMParams(g)),g}_compileLastEditInfo(){const{_effectivePopupTemplate:d,_sourceLayer:h,graphic:g,view:y}=this;if(!d)return;const{lastEditInfoEnabled:v}=d,b=h?.editFieldsInfo;return v&&b?function ws(d,h,g,y){const{creatorField:v,creationDateField:b,editorField:M,editDateField:I}=d;if(!h)return;const _=(0,rt.Np)(y&&"preferredTimeZone"in y?y.preferredTimeZone:null,!(!y||!("datesInUnknownTimezone"in y)||!y.datesInUnknownTimezone),g,Zi,"date"),x={...Zi,..._},E=h[I];if("number"==typeof E){const L=h[M];return{type:"edit",date:(0,Ot.p6)(E,x),user:L}}const P=h[b];if("number"==typeof P){const L=h[v];return{type:"create",date:(0,Ot.p6)(P,x),user:L}}return null}(b,g?.attributes,y?.timeZone??rt.By,h):void 0}_compileTitle(d){const{_fieldInfoMap:h,_sourceLayer:g,graphic:y,_expressionAttributes:v}=this;return We({attributes:y?.attributes??{},fieldInfoMap:h,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:v,layer:g,text:d})}_getTitle(){var d=this;return(0,R.Z)(function*(){const{_effectivePopupTemplate:h,graphic:g}=d;if(!g)return null;const y=h?.title;return bt(y,{graphic:g})})()}_getContent(){var d=this;return(0,R.Z)(function*(){const{_effectivePopupTemplate:h,graphic:g}=d;if(!g)return null;const y=h?.content;return bt(y,{graphic:g})})()}_queryFeature(d){var h=this;return(0,R.Z)(function*(){const{_featureAbortController:g,_sourceLayer:y,graphic:v,_effectivePopupTemplate:b}=h,M=h.map,I=h.view,_=h.spatialReference;if(g!==h._featureAbortController||!v)return;yield function Ms(d,h){return Yt.apply(this,arguments)}({graphic:v,popupTemplate:b,layer:y,spatialReference:_},d);const{content:{value:x},title:{value:E}}=yield(0,oe.as)({content:h._getContent(),title:h._getTitle()}),{expressionAttributes:{value:P}}=yield(0,oe.as)({checkForRelatedFeatures:h._checkForRelatedFeatures(d),expressionAttributes:_o({expressionInfos:b?.expressionInfos,spatialReference:_,graphic:v,map:M,interceptor:pt.interceptor,view:I})});g===h._featureAbortController&&v&&(h._expressionAttributes=P,h._graphicExpressionAttributes={...v.attributes,...P},h._set("formattedAttributes",h._createFormattedAttributes(x)),h._set("title",h._compileTitle(E)),h._set("lastEditInfo",h._compileLastEditInfo()||null),h._set("content",h._compileContent(x)||null))})()}_createMediaFormattedAttributes({contentElement:d,contentElementIndex:h,formattedAttributes:g}){const{_effectivePopupTemplate:y,graphic:v,relatedInfos:b,_sourceLayer:M,_fieldInfoMap:I,_graphicExpressionAttributes:_}=this;g.content[h]=jt({fieldInfos:y?.fieldInfos,graphic:v,attributes:{..._,...d.attributes},layer:M,fieldInfoMap:I,relatedInfos:b,timeZone:this.view?.timeZone??rt.By})}_createFieldsFormattedAttributes({contentElement:d,contentElementIndex:h,formattedAttributes:g}){if(d.fieldInfos){const{graphic:y,relatedInfos:v,_sourceLayer:b,_fieldInfoMap:M,_graphicExpressionAttributes:I}=this;g.content[h]=jt({fieldInfos:d.fieldInfos,graphic:y,attributes:{...I,...d.attributes},layer:b,fieldInfoMap:M,relatedInfos:v,timeZone:this.view?.timeZone??rt.By})}}_createFormattedAttributes(d){const{_effectivePopupTemplate:h,graphic:g,relatedInfos:y,_sourceLayer:v,_fieldInfoMap:b,_graphicExpressionAttributes:M}=this,I=h?.fieldInfos,_={global:jt({fieldInfos:I,graphic:g,attributes:M,layer:v,fieldInfoMap:b,relatedInfos:y,timeZone:this.view?.timeZone??rt.By}),content:[]};return Array.isArray(d)&&d.forEach((x,E)=>{"fields"===x.type&&this._createFieldsFormattedAttributes({contentElement:x,contentElementIndex:E,formattedAttributes:_}),"media"===x.type&&this._createMediaFormattedAttributes({contentElement:x,contentElementIndex:E,formattedAttributes:_})}),_}_checkForRelatedFeatures(d){const{graphic:h,_effectivePopupTemplate:g}=this;return this._queryRelatedInfos(h,Hi(g),d)}_queryRelatedInfos(d,h,g){var y=this;return(0,R.Z)(function*(){const{relatedInfos:v,_sourceLayer:b}=y;v.clear();const M=null!=b?.associatedLayer?yield b?.associatedLayer.load(g):b;if(!M||!d||!h.filter(E=>E&&Oe(E.fieldName))?.length)return;h.forEach(E=>y._configureRelatedInfo(E,M));const _=yield function io({relatedInfos:d,layer:h},g){const y={};return d.forEach((v,b)=>{const{relation:M}=v;if(!M){const P=new z.Z("relation-required","A relation is required on a layer to retrieve related records.");throw on.error(P),P}const{relatedTableId:I}=M;if("number"!=typeof I){const P=new z.Z("A related table ID is required on a layer to retrieve related records.");throw on.error(P),P}const _=`${h.url}/${I}`,x=rn.get(_),E=x??function to(d,h){return(0,Bs.Z)(d,{query:{f:"json"},signal:h?.signal})}(_);x||rn.set(_,E),y[b]=E}),(0,oe.Hl)((0,oe.as)(y),g)}({relatedInfos:v,layer:M},g);Object.keys(_).forEach(E=>{const P=v.get(E.toString()),L=_[E]?.value;P&&L&&(P.layerInfo=L.data)});const x=yield function no({graphic:d,relatedInfos:h,layer:g},y){const v={};return h.forEach((b,M)=>{b.layerInfo&&(v[M]=function eo(d,h,g,y){return oi.apply(this,arguments)}(d,b,g,y))}),(0,oe.as)(v)}({graphic:d,relatedInfos:v,layer:M},g);Object.keys(x).forEach(E=>{!function Qs(d,h){if(!h||!d)return;const{features:g,statsFeatures:y}=d,v=g?.value;h.relatedFeatures=v?v.features:[];const b=y?.value;h.relatedStatsFeatures=b?b.features:[]}(x[E]?.value,v.get(E.toString()))})})()}_configureRelatedInfo(d,h){const{relatedInfos:g}=this,y=At(d.fieldName);if(!y)return;const{layerId:v,fieldName:b}=y;if(!v)return;const M=g.get(v.toString())||function Gs(d,h){const g=function Hs(d,h){if(!h.relationships)return null;let g=null;const{relationships:y}=h;return y.some(v=>v.id===parseInt(d,10)&&(g=v,!0)),g}(d,h);if(g)return{url:`${h.url}/${g.relatedTableId}`,sourceSpatialReference:h.spatialReference,relation:g,relatedFields:[],outStatistics:[]}}(v,h);M&&(function so({relatedInfo:d,fieldName:h,fieldInfo:g}){if(d.relatedFields?.push(h),g.statisticType){const y=new js.Z({statisticType:g.statisticType,onStatisticField:h,outStatisticFieldName:h});d.outStatistics?.push(y)}}({relatedInfo:M,fieldName:b,fieldInfo:d}),this.relatedInfos.set(v,M))}};G.interceptor=new class Vo{constructor(h,g){this.preLayerQueryCallback=h,this.preRequestCallback=g,this.preLayerQueryCallback||(this.preLayerQueryCallback=y=>{}),this.preRequestCallback||(this.preLayerQueryCallback=y=>{})}}(({query:d,layer:h,method:g})=>{Xi({layer:h,method:g,query:d,definitionExpression:`${h.definitionExpression} ${h.serviceDefinitionExpression}`})},({queryPayload:d,layer:h,method:g})=>{Xi({layer:h,method:g,query:d,definitionExpression:`${h.definitionExpression} ${h.serviceDefinitionExpression}`})}),(0,w._)([(0,F.Cb)()],G.prototype,"_error",void 0),(0,w._)([(0,F.Cb)()],G.prototype,"_featureAbortController",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"_effectivePopupTemplate",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"_fieldInfoMap",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"_sourceLayer",null),(0,w._)([(0,F.Cb)()],G.prototype,"abilities",void 0),(0,w._)([(0,ye.p)("abilities")],G.prototype,"castAbilities",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"content",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"contentViewModels",void 0),(0,w._)([(0,F.Cb)()],G.prototype,"description",void 0),(0,w._)([(0,F.Cb)({type:Boolean})],G.prototype,"defaultPopupTemplateEnabled",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"isTable",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"state",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"formattedAttributes",void 0),(0,w._)([(0,F.Cb)({type:tt.Z,value:null})],G.prototype,"graphic",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"lastEditInfo",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"relatedInfos",void 0),(0,w._)([(0,F.Cb)()],G.prototype,"spatialReference",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"title",void 0),(0,w._)([(0,F.Cb)()],G.prototype,"map",null),(0,w._)([(0,F.Cb)({readOnly:!0})],G.prototype,"waitingForContent",null),(0,w._)([(0,F.Cb)()],G.prototype,"view",void 0),G=pt=(0,w._)([(0,V.j)("esri.widgets.FeatureViewModel")],G);const gi=G;var K=C(19399);const In=d=>{let h=class extends d{constructor(){super(...arguments),this.renderNodeContent=g=>(0,qt.Qd)(g)&&!g.destroyed?(0,A.u)("div",{class:K.i.contentNode,key:g},g.render()):g instanceof HTMLElement?(0,A.u)("div",{afterCreate:this._attachToNode,bind:g,class:K.i.contentNode,key:g}):(0,qt.o)(g)?(0,A.u)("div",{afterCreate:this._attachToNode,bind:g.domNode,class:K.i.contentNode,key:g}):null}_attachToNode(g){g.appendChild(this)}};return h=(0,w._)([(0,V.j)("esri.widgets.Feature.ContentMixin")],h),h};var yi;const _n={title:!0,content:!0,lastEditedInfo:!0},An="relationship-handles";let ne=yi=class extends(In(le.Z)){constructor(d,h){super(d,h),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={..._n},this.viewModel=new gi}initialize(){this.addHandles((0,T.YP)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),T.nn))}loadDependencies(){return(0,it.h)({notice:()=>Promise.all([C.e(7771),C.e(2347)]).then(C.bind(C,72347))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(d){this.viewModel.defaultPopupTemplateEnabled=d}get isTable(){return this.viewModel.isTable}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(d){this.viewModel.spatialReference=d}get title(){return this.viewModel.title}castVisibleElements(d){return{..._n,...d}}get map(){return this.viewModel.map}set map(d){this.viewModel.map=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}setActiveMedia(d,h){return this.viewModel.setActiveMedia(d,h)}nextMedia(d){return this.viewModel.nextMedia(d)}previousMedia(d){return this.viewModel.previousMedia(d)}render(){const{state:d}=this.viewModel,h=(0,A.u)("div",{class:K.i.container,key:"container"},this._renderTitle(),"error"===d?this._renderError():"loading"===d?this._renderLoading():this._renderContentContainer());return(0,A.u)("div",{class:this.classes(K.i.base,U.z.widget)},h)}_renderError(){const{messagesCommon:d,messages:h,visibleElements:g}=this;return(0,A.u)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},g.title?(0,A.u)("div",{key:"error-title",slot:"title"},d.errorMessage):null,(0,A.u)("div",{key:"error-message",slot:"message"},h.loadingError))}_renderLoading(){return(0,A.u)("div",{class:K.i.loadingSpinnerContainer,key:"loading-container"},(0,A.u)("span",{class:this.classes(Me.W.loadingIndicator,U.z.rotating,K.i.spinner)}))}_renderContentContainer(){const{visibleElements:d}=this;return d.content?(0,A.u)("div",{class:K.i.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:d,title:h}=this;return d.title?(0,A.u)(Xt.X,{class:K.i.title,innerHTML:h,level:this.headingLevel}):null}_renderContent(){const d=this.viewModel.content,h="content";if(!d)return null;if(Array.isArray(d))return d.length?(0,A.u)("div",{class:K.i.contentNode,key:`${h}-content-elements`},d.map(this._renderContentElement,this)):null;if("string"==typeof d){const g=this._contentWidgets[0];return!g||g.destroyed?null:(0,A.u)("div",{class:this.classes(K.i.contentNode,K.i.contentNodeText),key:`${h}-content`},g.render())}return this.renderNodeContent(d)}_renderContentElement(d,h){const{visibleElements:g}=this;if("boolean"!=typeof g.content&&!g.content?.[d.type])return null;switch(d.type){case"attachments":return this._renderAttachments(h);case"custom":return this._renderCustom(d,h);case"fields":return this._renderFields(h);case"media":return this._renderMedia(h);case"text":return this._renderText(d,h);case"expression":return this._renderExpression(h);case"relationship":return this._renderRelationship(h);default:return null}}_renderAttachments(d){const h=this._contentWidgets[d];if(!h||h.destroyed)return null;const{state:g,attachmentInfos:y}=h.viewModel;return"loading"===g||y.length>0?(0,A.u)("div",{class:this.classes(K.i.contentElement),key:this._buildKey("attachments-element",d)},h.render()):null}_renderRelationship(d){const h=this._contentWidgets[d];return h&&!h.destroyed&&this.flowItems?(0,A.u)("div",{class:K.i.contentElement,key:this._buildKey("relationship-element",d)},h.render()):null}_renderExpression(d){const h=this._contentWidgets[d];return!h||h.destroyed?null:(0,A.u)("div",{class:K.i.contentElement,key:this._buildKey("expression-element",d)},h.render())}_renderCustom(d,h){const{creator:g}=d,y=this._contentWidgets[h];return!y||y.destroyed?null:g?(0,A.u)("div",{class:K.i.contentElement,key:this._buildKey("custom-element",h)},y.render()):null}_renderFields(d){const h=this._contentWidgets[d];return!h||h.destroyed?null:(0,A.u)("div",{class:K.i.contentElement,key:this._buildKey("fields-element",d)},h.render())}_renderMedia(d){const h=this._contentWidgets[d];return!h||h.destroyed?null:(0,A.u)("div",{class:K.i.contentElement,key:this._buildKey("media-element",d)},h.render())}_renderLastEditInfo(){const{visibleElements:d,messages:h}=this,{lastEditInfo:g}=this.viewModel;if(!g||!d.lastEditedInfo)return null;const{date:y,user:v}=g,M=(0,Re.n)("edit"===g.type?v?h.lastEditedByUser:h.lastEdited:v?h.lastCreatedByUser:h.lastCreated,{date:y,user:v});return(0,A.u)("div",{class:this.classes(K.i.lastEditedInfo,K.i.contentElement),key:"edit-info-element"},M)}_renderText(d,h){const y=this._contentWidgets[h];return!y||y.destroyed?null:d.text?(0,A.u)("div",{class:this.classes(K.i.contentElement,K.i.text),key:this._buildKey("text-element",h)},y.render()):null}_buildKey(d,...h){return`${d}__${this.viewModel?.graphic?.uid||"0"}-${h.join("-")}`}_destroyContentWidget(d){d&&(d.viewModel=null,!d.destroyed&&d.destroy())}_destroyContentWidgets(){this.removeHandles(An),this._contentWidgets.forEach(d=>this._destroyContentWidget(d)),this._contentWidgets=[]}_addFeatureRelationshipHandles(d){const{flowItems:h,visibleElements:g}=this;this.addHandles([(0,T.on)(()=>d,"select-record",({featureViewModel:y})=>{h&&(y.abilities={relationshipContent:!0},h.push(new yi({flowItems:h,viewModel:y,visibleElements:g})))}),(0,T.on)(()=>d,"show-all-records",()=>{if(!h)return;const{viewModel:y}=d;y.showAllEnabled=!0;const v=new wn({visibleElements:{title:!1,description:!1},viewModel:y});this._addFeatureRelationshipHandles(v),h.push(v)})],An)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:d,visibleElements:h}=this,g=this.viewModel?.content,{contentViewModels:y}=this.viewModel;if(Array.isArray(g))g.forEach((v,b)=>{if("attachments"===v.type&&(this._contentWidgets[b]=new Os({displayType:v.displayType,headingLevel:h.title?d+1:d,viewModel:y[b]})),"fields"===v.type&&(this._contentWidgets[b]=new sn({viewModel:y[b]})),"media"===v.type&&(this._contentWidgets[b]=new ln({viewModel:y[b]})),"text"===v.type&&(this._contentWidgets[b]=new Ft({viewModel:y[b]})),"custom"===v.type&&(this._contentWidgets[b]=new Ft({viewModel:y[b]})),"expression"===v.type&&(this._contentWidgets[b]=new xo({viewModel:y[b]})),"relationship"===v.type){const M=new wn({viewModel:y[b]});this._addFeatureRelationshipHandles(M),this._contentWidgets[b]=M}},this);else{const v=y[0];v&&!v.destroyed&&(this._contentWidgets[0]=new Ft({viewModel:v}))}this.scheduleRender()}};(0,w._)([(0,F.Cb)()],ne.prototype,"graphic",null),(0,w._)([(0,F.Cb)()],ne.prototype,"defaultPopupTemplateEnabled",null),(0,w._)([(0,F.Cb)()],ne.prototype,"flowItems",void 0),(0,w._)([(0,F.Cb)()],ne.prototype,"headingLevel",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],ne.prototype,"isTable",null),(0,w._)([(0,F.Cb)()],ne.prototype,"label",null),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Feature/t9n/Feature")],ne.prototype,"messages",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/t9n/common")],ne.prototype,"messagesCommon",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/support/t9n/uriUtils")],ne.prototype,"messagesURIUtils",void 0),(0,w._)([(0,F.Cb)()],ne.prototype,"spatialReference",null),(0,w._)([(0,F.Cb)({readOnly:!0})],ne.prototype,"title",null),(0,w._)([(0,F.Cb)()],ne.prototype,"visibleElements",void 0),(0,w._)([(0,ye.p)("visibleElements")],ne.prototype,"castVisibleElements",null),(0,w._)([(0,F.Cb)()],ne.prototype,"map",null),(0,w._)([(0,F.Cb)()],ne.prototype,"view",null),(0,w._)([(0,F.Cb)({type:gi})],ne.prototype,"viewModel",void 0),ne=yi=(0,w._)([(0,V.j)("esri.widgets.Feature")],ne);const $o=ne;var Zo=C(88278);let Ye=class extends Zo.Z.EventedAccessor{constructor(d){super(d),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,T.gx)(()=>{const h=this.screenLocationEnabled?this.view:null;return h?[h.size,"3d"===h.type?h.camera:h.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,T.YP)(()=>this.screenLocation,(h,g)=>{null!=h&&null!=g&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:d,view:h,screenLocationEnabled:g}=this;return g&&null!=d&&null!=h&&h.ready?h.toScreen(d):null}};(0,w._)([(0,F.Cb)()],Ye.prototype,"location",void 0),(0,w._)([(0,F.Cb)()],Ye.prototype,"screenLocation",null),(0,w._)([(0,F.Cb)()],Ye.prototype,"screenLocationEnabled",void 0),(0,w._)([(0,F.Cb)()],Ye.prototype,"view",void 0),Ye=(0,w._)([(0,V.j)("esri.widgets.support.AnchorElementViewModel")],Ye);const xn=Ye;let Tt=class extends xn{constructor(d){super(d),this.visible=!1}};(0,w._)([(0,F.Cb)()],Tt.prototype,"visible",void 0),Tt=(0,w._)([(0,V.j)("esri.widgets.CompassViewModel")],Tt);const En=Tt,vi="esri-spinner",bi_base=vi,bi_spinnerStart=`${vi}--start`,bi_spinnerFinish=`${vi}--finish`;let ke=class extends le.Z{constructor(d,h){super(d,h),this._animationDelay=500,this._animationPromise=null,this.viewModel=new En}initialize(){this.addHandles((0,T.YP)(()=>this.visible,d=>this._visibleChange(d)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}show(d){const{location:h,promise:g}=d??{};h&&(this.viewModel.location=h),this.visible=!0,g&&g.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:d}=this,{screenLocation:h}=this.viewModel,g=!!h,b={[bi_spinnerStart]:d&&g,[bi_spinnerFinish]:!d&&g},M=this._getPositionStyles();return(0,A.u)("div",{class:this.classes(bi_base,b),styles:M})}_visibleChange(d){if(d)return void(this.viewModel.screenLocationEnabled=!0);const h=(0,oe.e4)(this._animationDelay);this._animationPromise=h,h.catch(()=>{}).then(()=>{this._animationPromise===h&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:d,view:h}=this.viewModel;if(null==h||null==d)return{};const{padding:g}=h;return{left:d.x-g.left+"px",top:d.y-g.top+"px"}}};(0,w._)([(0,F.Cb)()],ke.prototype,"location",null),(0,w._)([(0,F.Cb)()],ke.prototype,"view",null),(0,w._)([(0,F.Cb)({type:En})],ke.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)()],ke.prototype,"visible",null),ke=(0,w._)([(0,V.j)("esri.widgets.Spinner")],ke);const Bo=ke,ce="esri-features",re={icon:`${ce}__icon`,actionImage:`${ce}__action-image`,base:ce,container:`${ce}__container`,contentContainer:`${ce}__content-container`,contentFeature:`${ce}__content-feature`,flowItemCollapsed:`${ce}__flow-item--collapsed`,header:`${ce}__header`,footer:`${ce}__footer`,featureMenuObserver:`${ce}__feature-menu-observer`,actionExit:`${ce}__action--exit`,loader:`${ce}__loader`,featuresHeading:`${ce}__heading`,paginationActionBar:`${ce}__pagination-action-bar`,paginationPrevious:`${ce}__pagination-previous`,paginationNext:`${ce}__pagination-next`};let Ge=class extends le.Z{constructor(d,h){super(d,h),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=g=>{this.emit("open-related-feature",{feature:g})}}loadDependencies(){return(0,it.h)({action:()=>Promise.all([C.e(7771),C.e(5782),C.e(8507)]).then(C.bind(C,18507)),"flow-item":()=>Promise.all([C.e(7771),C.e(5782),C.e(2805),C.e(4661),C.e(8592),C.e(6546)]).then(C.bind(C,66546))})}render(){const{flowItems:d}=this,h=d?.toArray();return(0,A.u)(A.D,null,h?.map(g=>this._renderRelatedRecordsFlowItem(g)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const d=this.flowItems?.pop();d&&("showAllEnabled"in d.viewModel&&(d.viewModel.showAllEnabled=!1),d&&(d.viewModel=null,d.destroy()))}_renderRelatedRecordsFlowItem(d){const{messages:h,closable:g,closed:y}=this,v="graphic"in d&&!d.isTable;return(0,A.u)("calcite-flow-item",{bind:this,closable:g,closed:y,description:this._getRelatedRecordsFlowItemDescription(d),heading:d.title??"",key:`flow-item-${d.viewModel.uid}`,onCalciteFlowItemBack:this._handleRelatedRecordsBackClick,onCalciteFlowItemClose:this._handleCloseClick},(0,A.u)("calcite-action",{appearance:"transparent",bind:this,class:re.actionExit,icon:"move-up",key:"exit-related-records-action",label:h.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:h.exitRelatedRecords,title:h.exitRelatedRecords}),v?(0,A.u)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:h.selectFeature,onclick:()=>this._handleOpenRelatedFeature(d),scale:"m",slot:"header-actions-end",text:h.selectFeature,title:h.selectFeature}):null,(0,A.u)("div",{class:re.container},d.render()))}_getRelatedRecordsFlowItemDescription(d){return"featureCountDescription"in d?d.featureCountDescription:d.viewModel.description??""}};(0,w._)([(0,F.Cb)()],Ge.prototype,"flowItems",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Features/t9n/Features")],Ge.prototype,"messages",void 0),(0,w._)([(0,F.Cb)()],Ge.prototype,"closed",void 0),(0,w._)([(0,F.Cb)()],Ge.prototype,"closable",void 0),Ge=(0,w._)([(0,V.j)("esri.widgets.Features.FeaturesRelatedRecords")],Ge);const zo=Ge;C(71950);var Qe=C(56295),jo=C(19994);class Wo{constructor(){this._set=new Set,this._observable=new jo.s}get size(){return(0,Qe.it)(this._observable),this._set.size}add(h){const g=this._set.size;return this._set.add(h),this._set.size!==g&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(h){const g=this._set.delete(h);return g&&this._observable.notify(),g}entries(){return(0,Qe.it)(this._observable),this._set.entries()}forEach(h,g){(0,Qe.it)(this._observable),this._set.forEach((y,v)=>h.call(g,y,v,this),g)}has(h){return(0,Qe.it)(this._observable),this._set.has(h)}keys(){return(0,Qe.it)(this._observable),this._set.keys()}values(){return(0,Qe.it)(this._observable),this._set.values()}[Symbol.iterator](){return(0,Qe.it)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}var Ho=C(48230),Tn=C(95060),ko=C(38826);function Pn(d){return d&&"function"==typeof d.highlight}var Go=C(72031),Rn=C(25917);const Xe=Ce.Z.ofType({key:"type",defaultKeyValue:"button",base:Go.Z,typeMap:{button:se.Z,toggle:Rn.Z}}),je=new se.Z({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Me.W.zoomInMagnifyingGlass}),wi=new se.Z({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Me.W.trash}),Ke=new se.Z({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Me.W.zoomInMagnifyingGlass}),Ve=new Rn.Z({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Me.W.table,value:!1}),Pt=J.Z.getLogger("esri.widgets.Popup.PopupViewModel"),Xo=d=>{const{event:h,view:g,viewModel:y}=d,{action:v}=h;if(!v)return Promise.reject(new z.Z("trigger-action:missing-arguments","Event has no action"));const{disabled:b,id:M}=v;if(!M)return Promise.reject(new z.Z("trigger-action:invalid-action","action.id is missing"));if(b)return Promise.reject(new z.Z("trigger-action:invalid-action","Action is disabled"));if(M===je.id)return function Jo(d){return Fi.apply(this,arguments)}(y).catch(oe.H9);if(M===Ke.id)return function qo(d){return Mi.apply(this,arguments)}(y);if(M===Ve.id)return y.browseClusterEnabled=!y.browseClusterEnabled,y.featureMenuOpen=y.browseClusterEnabled,Promise.resolve();if(M===wi.id){y.visible=!1;const{selectedFeature:I}=y;if(!I)return Promise.reject(new z.Z(`trigger-action:${wi.id}`,"selectedFeature is required",{selectedFeature:I}));const{sourceLayer:_}=I;return _?_.remove(I):g?.graphics.remove(I),Promise.resolve()}return Promise.resolve()};function Ln(d){const{selectedFeature:h,location:g,view:y}=d;return y?h??g??null:null}function Je(d){return!!d&&d.isAggregate&&"cluster"===d.sourceLayer?.featureReduction?.type}function Ci(){return(Ci=(0,R.Z)(function*(d,h){if("3d"!==h?.type||!d||"esri.Graphic"!==d.declaredClass)return!0;const g=h.getViewForGraphic(d);if(g&&"whenGraphicBounds"in g){let y=null;try{y=yield g.whenGraphicBounds(d,{useViewElevation:!0})}catch{}return!y||!y.boundingBox||y.boundingBox[0]===y.boundingBox[3]&&y.boundingBox[1]===y.boundingBox[4]&&y.boundingBox[2]===y.boundingBox[5]}return!0})).apply(this,arguments)}function Fi(){return Fi=(0,R.Z)(function*(d){const{location:h,selectedFeature:g,view:y,zoomFactor:v}=d,b=Ln(d);if(!y||!b){const E=new z.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:b,view:y});throw Pt.error(E),E}const M=y.scale/v,I=d.selectedFeature?.geometry,_=I??h,x=null!=_&&"point"===_.type&&(yield function Ko(d,h){return Ci.apply(this,arguments)}(g,y));je.active=!0,je.disabled=!0;try{yield d.zoomTo({target:{target:b,scale:x?M:void 0}})}catch{const P=new z.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:g});Pt.error(P)}finally{je.active=!1,je.disabled=!1,d.zoomToLocation=null,x&&(d.location=_)}}),Fi.apply(this,arguments)}function Mi(){return(Mi=(0,R.Z)(function*(d){const{selectedFeature:h,view:g}=d;if("2d"!==g?.type){const M=new z.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:g});throw Pt.error(M),M}if(!h||!Je(h)){const M=new z.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:h});throw Pt.error(M),M}const[y,v]=yield Ai(g,h);Ke.active=!0,Ke.disabled=!0;const{extent:b}=yield y.queryExtent(v);yield d.zoomTo({target:b}),Ke.active=!1,Ke.disabled=!1})).apply(this,arguments)}function Ii(){return(Ii=(0,R.Z)(function*(d){const{view:h,selectedFeature:g}=d;if(!h||!g)return;const[y,v]=yield Ai(h,g),{extent:b}=yield y.queryExtent(v);d.selectedClusterBoundaryFeature.geometry=b,h.graphics.add(d.selectedClusterBoundaryFeature)})).apply(this,arguments)}function _i(){return(_i=(0,R.Z)(function*(d){const{selectedFeature:h,view:g}=d;if(!g||!h)return;const[y,v]=yield Ai(g,h);Ve.active=!0,Ve.disabled=!0;const{features:b}=yield y.queryFeatures(v);Ve.active=!1,Ve.disabled=!1,Ve.value=!0,d?.open({features:[h].concat(b),featureMenuOpen:!0})})).apply(this,arguments)}function Ai(d,h){return xi.apply(this,arguments)}function xi(){return(xi=(0,R.Z)(function*(d,h){const g=yield d.whenLayerView(h.sourceLayer),y=g.createQuery(),v=h.getObjectId();return y.aggregateIds=null!=v?[v]:[],[g,y]})).apply(this,arguments)}function On(d){if(null==d)return null;switch(d.type){case"point":return d;case"extent":return d.center;case"polygon":return d.centroid;case"multipoint":case"polyline":return d.extent?.center;default:return null}}var nr=C(42704),sr=C(89481);let $=class extends((0,nr._)(xn)){constructor(d){super(d),this._pendingPromises=new Wo,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new Xe,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new tt.Z({symbol:new sr.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,T.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,T.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,T.YP)(()=>this.view?.animation?.state,d=>this._animationStateChange(d)),(0,T.YP)(()=>this.location,d=>this._locationChange(d)),(0,T.YP)(()=>this.selectedFeature,d=>this._selectedFeatureChange(d)),(0,T.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,T.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,T.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",d=>Xo({event:d,viewModel:this,view:this.view})),(0,T.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),T.Z_),(0,T.YP)(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),(0,T.YP)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,T.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,T.YP)(()=>this.browseClusterEnabled,d=>d?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const d=this._get("allActions")||new Xe;d.removeAll();const{actions:h,defaultActions:g,defaultPopupTemplateEnabled:y,includeDefaultActions:v,selectedFeature:b}=this,M=v?g.concat(h):h,I=b&&("function"==typeof b.getEffectivePopupTemplate&&b.getEffectivePopupTemplate(y)||b.popupTemplate),_=I?.actions;return(I?.overwriteActions?_:_?.concat(M)??M)?.filter(Boolean).forEach(E=>d.add(E)),d}get defaultActions(){const d=this._get("defaultActions")||new Xe;return d.removeAll(),d.addMany(Je(this.selectedFeature)?[Ke.clone(),Ve.clone()]:[je.clone()]),d}get featureCount(){return this.features.length}set features(d){const h=d||[];this._set("features",h);const{pendingPromisesCount:g,promiseCount:y,selectedFeatureIndex:v}=this,b=y&&h.length;b&&g&&-1===v?this.selectedFeatureIndex=0:b&&-1!==v||(this.selectedFeatureIndex=h.length?0:-1)}set location(d){let h=d;const g=this.view?.spatialReference?.isWebMercator;d?.spatialReference?.isWGS84&&g&&(h=(0,Ho.$)(d)),this._set("location",h)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(d){this._pendingPromises.clear(),this.features=[],Array.isArray(d)&&d.length?(this._set("promises",d),(d=d.slice(0)).forEach(h=>{this._pendingPromises.add(h),h.then(v=>{this._pendingPromises.has(h)&&this._updateFeatures(v),this._updatePendingPromises(h)},()=>this._updatePendingPromises(h))})):this._set("promises",[])}get selectedFeature(){const{features:d,selectedFeatureIndex:h}=this;return-1===h?null:d[h]||null}get selectedFeatureIndex(){const d=this._get("selectedFeatureIndex");return"number"==typeof d?d:-1}set selectedFeatureIndex(d){const{featureCount:h}=this;d=isNaN(d)||d<-1||!h?-1:(d+h)%h,this.activeFeature=null,this._set("selectedFeatureIndex",d)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.view?.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some(d=>d.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:d}=this,h=Ln(this);return h&&d?this.callGoTo({target:{target:h,scale:d.scale}}):Promise.reject(new z.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:h,view:d}))}zoomTo(d){return this.callGoTo(d)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(d,h){const{view:g}=this;if(!g||!d)throw new z.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:d,view:g});return g.fetchPopupFeatures(d,{event:h?.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:h?.signal})}open(d){const h={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...d,visible:!0},{fetchFeatures:g}=h;delete h.fetchFeatures,g&&this._setFetchFeaturesPromises(h.location);const y=["actionsMenuOpen","collapsed"];for(const v of y)delete h[v];this.set(h)}triggerAction(d){const h=this.allActions.at(d);h&&!h.disabled&&this.emit("trigger-action",{action:h})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function ir(d){Ve.value=!1;const h=d.features.filter(g=>Je(g));h.length&&(d.features=h)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var d=this;return(0,R.Z)(function*(){const{view:h,selectedFeature:g}=d;"2d"===h?.type?Je(g)?(yield function er(d){return Ii.apply(this,arguments)}(d),yield function tr(d){return _i.apply(this,arguments)}(d)):J.Z.getLogger(d).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",g):J.Z.getLogger(d).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",g)})()}handleViewClick(d){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(d)}_animationStateChange(d){this.zoomToLocation||(je.disabled="waiting-for-target"===d)}_clearBrowsedClusterGraphics(){const d=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(ge.pC);this.view?.graphics?.removeMany(d),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Je(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(d){const{selectedFeature:h,updateLocationEnabled:g}=this;g&&d&&(!h||h.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:d,featureCount:h,featurePage:g,featuresPerPage:y,featureViewModels:v}=this;if(null===g)return;const b=((g-1)*y+h)%h;v.slice(b,b+y).forEach((I,_)=>{I&&(I.graphic??=d[b+_])})}_selectedFeatureChange(d){var h=this;return(0,R.Z)(function*(){const{location:g,updateLocationEnabled:y,view:v}=h;if(d&&v){if(h.browseClusterEnabled)return h._selectedClusterFeature&&(v.graphics.remove(h._selectedClusterFeature),h._selectedClusterFeature=null),Je(d)?void 0:(d.symbol=yield(0,ko.zd)(d),h._selectedClusterFeature=d,void v.graphics.add(h._selectedClusterFeature));if(!y&&g||!d.geometry){if(y&&!d.geometry){yield h.centerAtLocation();const b=v.center?.clone();b&&(h.location=b)}}else h.location=On(d.geometry)}})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(d){var h=this;return(0,R.Z)(function*(){const{clientOnlyGraphics:g,promisesPerLayerView:y}=yield h._fetchFeaturesWithController(h._getScreenPoint(d||h.location)),v=Promise.resolve(g),b=y.map(M=>M.promise);h.promises=[v,...b]})()}_destroyFeatureVMs(){this.featureViewModels.forEach(d=>d&&!d.destroyed&&d.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:d,features:h,featureViewModels:g,view:y}=this;if(Je(d)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!h?.length)return;const v=g.slice(0),b=[];h.forEach((M,I)=>{if(!M)return;let _=null;if(v.some((x,E)=>(x&&x.graphic===M&&(_=x,v.splice(E,1)),!!_)),_)b[I]=_;else{const x=new gi({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:y?.spatialReference,graphic:M===d?M:null,map:y?.map,view:y});b[I]=x}}),v.forEach(M=>M&&!M.destroyed&&M.destroy()),this._set("featureViewModels",b)}_getScreenPoint(d){const{view:h}=this;return h&&d&&"function"==typeof h.toScreen?h.toScreen(d):null}_cancelFetchingFeatures(){const d=this._fetchFeaturesController;d&&d.abort(),this._fetchFeaturesController=null}_fetchFeaturesWithController(d,h){this._cancelFetchingFeatures();const g=new AbortController,{signal:y}=g;this._fetchFeaturesController=g;const v=this.fetchFeatures(d,{signal:y,event:h});return v.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),v}_fetchFeaturesAndOpen(d){var h=this;return(0,R.Z)(function*(){const{screenPoint:g,mapPoint:y}=d,{view:v}=h,{clientOnlyGraphics:b,promisesPerLayerView:M,location:I}=yield h._fetchFeaturesWithController(g,d),_=[Promise.resolve(b),...M.map(x=>x.promise)];v?.popup&&"open"in v.popup&&v.popup.open({location:I||y,promises:_})})()}_updatePendingPromises(d){d&&this._pendingPromises.has(d)&&this._pendingPromises.delete(d)}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(d,h){return(0,R.Z)(function*(){return yield d.when(),d.whenLayerView(h)})()}_getHighlightLayer(d){const{layer:h,sourceLayer:g}=d;return g&&"layer"in g&&g.layer?g.layer:"map-notes"===g?.type||"subtype-group"===g?.type?g:h}_getHighlightTarget(d,h){const g="imagery"===h.type?void 0:"objectIdField"in h?h.objectIdField||"OBJECTID":null,y=d.attributes;return y&&g&&y[g]||d}_mapIncludesLayer(d){return!!this.view?.map?.allLayers?.includes(d)}_highlightActiveFeature(){var d=this;return(0,R.Z)(function*(){const h="highlight-active-feature";d.removeHandles(h);const{highlightEnabled:g,view:y,activeFeature:v,visible:b}=d;if(!(v&&y&&g&&b))return;const M=d._getHighlightLayer(v);if(!(M&&M instanceof Tn.Z&&d._mapIncludesLayer(M)))return;const I=d._getLayerView(y,M);d._highlightActiveFeaturePromise=I;const _=yield I;if(!(_&&Pn(_)&&d._highlightActiveFeaturePromise===I&&d.activeFeature&&d.highlightEnabled))return;const x=_.highlight(d._getHighlightTarget(v,M));d.addHandles(x,h)})()}_highlightSelectedFeature(){var d=this;return(0,R.Z)(function*(){const h="highlight-selected-feature";d.removeHandles(h);const{selectedFeature:g,highlightEnabled:y,view:v,visible:b}=d;if(!(g&&v&&y&&b))return;const M=d._getHighlightLayer(g);if(!(M&&M instanceof Tn.Z&&d._mapIncludesLayer(M)))return;const I=d._getLayerView(v,M);d._highlightSelectedFeaturePromise=I;const _=yield I;if(!(_&&Pn(_)&&d._highlightSelectedFeaturePromise===I&&d.selectedFeature&&d.highlightEnabled&&d.visible))return;const x=_.highlight(d._getHighlightTarget(g,M));d.addHandles(x,h)})()}_updateFeatures(d){const{features:h}=this;if(!d?.length)return;if(!h.length)return void(this.features=d);const g=d.filter(y=>!h.includes(y));this.features=h.concat(g)}};(0,w._)([(0,F.Cb)()],$.prototype,"_fetchFeaturesController",void 0),(0,w._)([(0,F.Cb)({type:Xe})],$.prototype,"actions",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"active",null),(0,w._)([(0,F.Cb)()],$.prototype,"activeFeature",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"allActions",null),(0,w._)([(0,F.Cb)()],$.prototype,"autoCloseEnabled",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"autoOpenEnabled",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"browseClusterEnabled",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"content",void 0),(0,w._)([(0,F.Cb)({type:Xe,readOnly:!0})],$.prototype,"defaultActions",null),(0,w._)([(0,F.Cb)({type:Boolean})],$.prototype,"defaultPopupTemplateEnabled",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"featureCount",null),(0,w._)([(0,F.Cb)()],$.prototype,"featurePage",void 0),(0,w._)([(0,F.Cb)({value:[]})],$.prototype,"features",null),(0,w._)([(0,F.Cb)()],$.prototype,"featuresPerPage",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"featureMenuOpen",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"featureViewModelAbilities",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"featureViewModels",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"highlightEnabled",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"includeDefaultActions",void 0),(0,w._)([(0,F.Cb)({type:zs.Z})],$.prototype,"location",null),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"pendingPromisesCount",null),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"promiseCount",null),(0,w._)([(0,F.Cb)()],$.prototype,"promises",null),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"selectedClusterBoundaryFeature",void 0),(0,w._)([(0,F.Cb)({value:null,readOnly:!0})],$.prototype,"selectedFeature",null),(0,w._)([(0,F.Cb)({value:-1})],$.prototype,"selectedFeatureIndex",null),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"selectedFeatureViewModel",null),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"state",null),(0,w._)([(0,F.Cb)()],$.prototype,"title",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"updateLocationEnabled",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"view",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"visible",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"waitingForContents",null),(0,w._)([(0,F.Cb)({readOnly:!0})],$.prototype,"waitingForResult",null),(0,w._)([(0,F.Cb)()],$.prototype,"zoomFactor",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"zoomToLocation",void 0),(0,w._)([(0,F.Cb)()],$.prototype,"centerAtLocation",null),$=(0,w._)([(0,V.j)("esri.widgets.Features.FeaturesViewModel")],$);const Ei=$;let Ue=class extends Le.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],Ue.prototype,"actionBar",void 0),(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],Ue.prototype,"closeButton",void 0),(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],Ue.prototype,"collapseButton",void 0),(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],Ue.prototype,"featureNavigation",void 0),(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],Ue.prototype,"heading",void 0),(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],Ue.prototype,"spinner",void 0),Ue=(0,w._)([(0,V.j)("esri.widgets.Features.FeaturesVisibleElements")],Ue);const Sn=Ue;var Nn=C(92795);const Vn="selected-index",Un="features-spinner";let Y=class extends(In(le.Z)){constructor(d,h){var g;super(d,h),g=this,this._featureMenuIntersectionObserverCallback=([y])=>{y?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new Ce.Z,this._relatedRecordsWidget=new zo({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new Xe,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Ei,this.visibleElements=new Sn,this._renderAction=(y,v)=>{const b=this._getActionTitle(y),{type:M,active:I,uid:_,disabled:x,indicator:E}=y;return y.visible?(0,A.u)("calcite-action",{active:"toggle"===M&&y.value,appearance:"solid",bind:this,"data-action-uid":_,disabled:x,icon:this._getActionIcon(y),indicator:E,key:`action-${v}`,loading:I,onclick:this._triggerAction,scale:"s",text:b,title:this._hideActionText?b:void 0},this._getFallbackIcon(y)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=y=>{this._focusOn===y&&requestAnimationFrame((0,R.Z)(function*(){switch(y){case"menu-flow-item":yield g._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield g._rootFlowItemNode?.setFocus()}g._focusOn=null}))},this._focusFlowItemNodeThrottled=(0,he.P)(this._focusFlowItemNode,50),this._displaySpinnerThrottled=(0,he.P)(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,T.YP)(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),(0,T.YP)(()=>this.viewModel?.active,y=>this._relatedRecordsWidget.closed=!y),(0,T.YP)(()=>this.visibleElements?.closeButton,y=>this._relatedRecordsWidget.closable=y),(0,T.YP)(()=>this.visibleElements?.spinner,y=>this._spinnerEnabledChange(y)),(0,T.YP)(()=>this.viewModel?.view,(y,v)=>this._viewChange(y,v)),(0,T.YP)(()=>this.viewModel?.view?.ready,(y,v)=>this._viewReadyChange(y??!1,v??!1)),(0,T.YP)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,T.YP)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,T.YP)(()=>{const y=this.selectedFeatureWidget?.viewModel;return[y?.title,y?.state]},()=>this._setTitleFromFeatureWidget()),(0,T.YP)(()=>{const y=this.selectedFeatureWidget?.viewModel;return[y?.content,y?.state]},()=>this._setContentFromFeatureWidget()),(0,T.YP)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:y})=>this._openRelatedFeature(y))])}loadDependencies(){return(0,it.h)({action:()=>Promise.all([C.e(7771),C.e(5782),C.e(8507)]).then(C.bind(C,18507)),"action-bar":()=>Promise.all([C.e(7771),C.e(5782),C.e(2805),C.e(4661),C.e(2888),C.e(9962)]).then(C.bind(C,69962)),"action-group":()=>Promise.all([C.e(7771),C.e(5782),C.e(2805),C.e(4661),C.e(2888),C.e(3607)]).then(C.bind(C,43607)),button:()=>Promise.all([C.e(7771),C.e(2102),C.e(8901)]).then(C.bind(C,38901)),flow:()=>C.e(3669).then(C.bind(C,13669)),"flow-item":()=>Promise.all([C.e(7771),C.e(5782),C.e(2805),C.e(4661),C.e(8592),C.e(6546)]).then(C.bind(C,66546)),list:()=>Promise.all([C.e(7771),C.e(2102),C.e(8592),C.e(6985)]).then(C.bind(C,66985)),"list-item":()=>Promise.all([C.e(7771),C.e(5782),C.e(8592),C.e(9475)]).then(C.bind(C,99475)),"list-item-group":()=>Promise.all([C.e(8592),C.e(3768)]).then(C.bind(C,23768)),loader:()=>C.e(5597).then(C.bind(C,55597))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const d=this.view?.widthBreakpoint;return"xsmall"===d||"small"===d||"medium"===d}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(d){this.viewModel.content=d}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(d){this.viewModel.featureMenuOpen=d}get features(){return this.viewModel.features}set features(d){this.viewModel.features=d}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get promises(){return this.viewModel.promises}set promises(d){this.viewModel.promises=d}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(d){this.viewModel.selectedFeatureIndex=d}get selectedFeatureWidget(){const{_feature:d,headingLevel:h,_relatedRecordsFlowItems:g}=this,{selectedFeatureViewModel:y}=this.viewModel,v={title:!1};return y?(d?(d.viewModel=y,d.visibleElements=v):this._feature=new $o({flowItems:g,headingLevel:h+1,viewModel:y,visibleElements:v}),this._feature):null}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(d){this.viewModel.updateLocationEnabled=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}blur(){const{active:d}=this.viewModel;d?this._rootFlowItemNode?.blur():J.Z.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(d,h){return this.viewModel.fetchFeatures(d,h)}focus(){const{active:d}=this.viewModel;d?this._setFocusOn():J.Z.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(d){this.removeHandles(Vn),this.set({collapsed:d?.collapsed??!1}),this.viewModel.open(d),this.addHandles((0,T.gx)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(d){return this.viewModel.triggerAction(d)}render(){return(0,A.u)("div",{bind:this,class:this.classes(re.base,U.z.widget,U.z.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,A.u)("div",{class:re.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,A.u)("div",{class:re.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:d,viewModel:h}=this,{featureCount:g,selectedFeatureIndex:y,pendingPromisesCount:v}=h;return(0,A.u)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:d.selectFeature,loading:v>0,onclick:this._openFeatureMenu,scale:"s",text:(0,Re.n)(d.pageText,{index:(0,Te.uf)(y+1),total:(0,Te.uf)(g)}),textEnabled:!0,title:d.selectFeature})}_renderPagination(){const{previous:d,next:h}=this.messagesCommon.pagination;return(0,A.u)("calcite-action-bar",{class:re.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,A.u)("calcite-action-group",{scale:"s"},(0,A.u)("calcite-action",{appearance:"solid",class:re.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:d,onclick:this._previousFeature,scale:"s",text:d,title:d}),(0,A.u)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:h,onclick:this._nextFeature,scale:"s",text:h,title:h})))}_renderFeatureMenuItem(d){const{selectedFeatureViewModel:h,featureViewModels:g}=this.viewModel,y=d===h,v=g.indexOf(d);return(0,A.u)("calcite-list-item",{bind:this,"data-feature-index":v,key:`feature-menu-item-${d.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:y,onCalciteListItemSelect:this._selectFeature},(0,A.u)("span",{innerHTML:d.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:d}=this.viewModel,h=new Map;return d.forEach(g=>{const y=g?.graphic;if(!y)return;const v=y.sourceLayer??y.layer,b=h.get(v)??[];h.set(v,[...b,g])}),h}_renderFeatureMenu(){const{featureViewModels:d}=this.viewModel,h=this._groupResultsByLayer();return d.length?(0,A.u)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(h.keys()).map(g=>(0,A.u)("calcite-list-item-group",{heading:g?.title??this.messagesCommon.untitled,key:g?.uid||"untitled"},h.get(g)?.map(y=>this._renderFeatureMenuItem(y))))):null}_renderHeaderAction(d,h){return d.visible?(0,A.u)("calcite-action",{active:"toggle"===d.type&&d.value,appearance:"solid",bind:this,"data-action-uid":d.uid,disabled:d.disabled,icon:d.icon||"",indicator:d.indicator,key:`header-action-${h}`,loading:d.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:d.title||"",title:d.title||""}):null}_renderHeaderActions(){return this.headerActions.map((d,h)=>this._renderHeaderAction(d,h)).toArray()}_renderContentFeature(){const{headingLevel:d,visibleElements:h,_isCollapsed:g,_collapseEnabled:y,featureNavigationTop:v}=this,{title:b,active:M}=this.viewModel,I=h.heading&&b?b:"";return(0,A.u)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[re.contentFeature]:!0,[re.flowItemCollapsed]:g}),closable:h.closeButton,closed:!M,collapsed:g,collapseDirection:v?"down":"up",collapsible:y,headingLevel:d,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},I?(0,A.u)(Xt.X,{class:this.classes(re.featuresHeading,U.z.heading),innerHTML:I,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),g?null:(0,A.u)("div",{class:this.classes(re.container,re.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:d,featureMenuOpen:h,messages:g,messagesCommon:y}=this,{active:v,featureViewModels:b,pendingPromisesCount:M}=d;return h?(0,A.u)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!v,description:(0,Re.n)(g.total,{total:b.length}),heading:g.selectFeature,key:"feature-menu",loading:d.waitingForContents,onCalciteFlowItemBack:this._handleFeatureMenuBack},M>0?(0,A.u)("calcite-loader",{class:re.loader,inline:!0,key:"feature-menu-loader",label:y.loading,scale:"m",slot:"header-actions-end"}):null,(0,A.u)("div",{class:re.container},this._renderFeatureMenu()),(0,A.u)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:re.featureMenuObserver}),(0,A.u)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},y.back)):null}_renderContentContainer(){return(0,A.u)("calcite-flow",{key:"content-container"},this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render())}_getIconStyles(d){return{"background-image":d?`url(${d})`:""}}_getActionImage(d){const{selectedFeature:h}=this,g=h?.attributes,{image:y}=d;return y&&g?(0,Re.n)(y,g):y??""}_getFallbackIcon(d){const{className:h,icon:g}=d;if(g)return null;const y=this._getActionImage(d),v={[re.icon]:!!h,[re.actionImage]:!!y};return h&&(v[h]=!0),y||h?(0,A.u)("span",{"aria-hidden":"true",class:this.classes(re.icon,v),key:"icon",styles:y?this._getIconStyles(y):{}}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,A.u)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,A.u)("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const d=this.viewModel?.content;return d?"string"==typeof d?(0,A.u)("div",{class:K.i.contentNode,innerHTML:d,key:d}):this.renderNodeContent(d):null}_setFocusOn(){this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item",this.renderNow()}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(d){var h=this;return(0,R.Z)(function*(){yield d.viewModel.updateGeometry();const g=d.graphic,y=g?.geometry;if(null==y||null==g)return;h._destroyRelatedRecordsFlowItemWidgets(),yield h.viewModel.zoomTo({target:y});const v=On(y);h.open({features:[g],location:v??void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(d){this._rootFlowItemNode=d,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(d){this._featureMenuViewportNode=d,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(d){const{viewModel:h}=this,g=d.currentTarget["data-feature-index"];h.activeFeature=h.features?.[g]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(d){const h=d.currentTarget["data-feature-index"];isNaN(h)||(this.viewModel.selectedFeatureIndex=h),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(d){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(d),this._featureMenuIntersectionObserverNode=d}_getActionIcon(d){return d.icon?d.icon:d.image||d.className?void 0:"question"}_getActionTitle(d){const{messages:h,selectedFeature:g,messagesCommon:y}=this,{id:v}=d,b=g?.attributes,M=d.title??"",I="zoom-to-feature"===v?(0,Re.n)(M,{messages:h}):"remove-selected-feature"===v?(0,Re.n)(M,{messages:y}):"zoom-to-clustered-features"===v||"browse-clustered-features"===v?(0,Re.n)(M,{messages:h}):d.title;return I&&b?(0,Re.n)(I,b):I??""}_onMainKeydown(d){const h=(0,Fe.kK)(d);"ArrowLeft"===h&&(d.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===h&&(d.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:d}=this;d&&(this.viewModel.content=d)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:d,messagesCommon:h}=this,g=d?.viewModel;d&&(this.viewModel.title="error"===g?.state?h?.errorMessage:g?.title||"")}_addSelectedFeatureIndexHandle(){const d=(0,T.YP)(()=>this.viewModel?.selectedFeatureIndex,(h,g)=>this._selectedFeatureIndexUpdated(h,g));this.addHandles(d,Vn)}_selectedFeatureIndexUpdated(d,h){const{featureCount:g}=this.viewModel;g&&d!==h&&-1!==d&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(d){const h=d.currentTarget;if(h.disabled)return;const g=h.dataset.actionUid,y=this.headerActions.find(({uid:v})=>v===g);y&&!y.disabled&&("toggle"===y?.type&&(y.value=!y.value),this.emit("trigger-header-action",{action:y}))}_triggerAction(d){const h=d.currentTarget;if(h.disabled)return;const g=h.dataset.actionUid,{allActions:y}=this.viewModel,v=y.findIndex(M=>M.uid===g),b=y.at(v);b&&"toggle"===b.type&&(b.value=!b.value),this.viewModel.triggerAction(v)}_createSpinner(d){d&&(this._spinner=new Bo({view:d}),d.ui.add(this._spinner,{key:Un,position:"manual",internal:!0}))}_wireUpView(d){this._destroySpinner(),d&&this.visibleElements?.spinner&&this._createSpinner(d)}_hideSpinner(){const{_spinner:d}=this;d&&(d.location=null,d.hide())}_viewReadyChange(d,h){d?this._wireUpView(this.viewModel?.view):h&&this.viewModel.clear()}_viewChange(d,h){d&&h&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:d}=this;d&&(d.viewModel=null,!d.destroyed&&d.destroy()),this._feature=null}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach(d=>{"showAllEnabled"in d.viewModel&&(d.viewModel.showAllEnabled=!1),d.viewModel=null,d.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:d}=this;d&&(d.screenLocationEnabled=d.active)}_displaySpinner(){const{_spinner:d}=this;if(!d)return;const{location:h,waitingForResult:g}=this.viewModel;g&&h?d.show({location:h}):d.hide()}_destroySpinner(){const{_spinner:d,view:h}=this;d&&(h?.ui?.remove(d,Un),d.destroy(),this._spinner=null)}_spinnerEnabledChange(d){this._destroySpinner(),d&&this._createSpinner(this.viewModel?.view)}};(0,w._)([(0,F.Cb)()],Y.prototype,"_focusOn",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"_relatedRecordsFlowItems",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"_hideActionText",null),(0,w._)([(0,F.Cb)()],Y.prototype,"_featureNavigationVisible",null),(0,w._)([(0,F.Cb)()],Y.prototype,"_isCollapsed",null),(0,w._)([(0,F.Cb)()],Y.prototype,"_collapseEnabled",null),(0,w._)([(0,F.Cb)()],Y.prototype,"collapsed",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"content",null),(0,w._)([(0,F.Cb)()],Y.prototype,"icon",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"featureMenuOpen",null),(0,w._)([(0,F.Cb)()],Y.prototype,"featureNavigationTop",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"features",null),(0,w._)([(0,F.Cb)({type:Xe})],Y.prototype,"headerActions",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"headingLevel",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"location",null),(0,w._)([(0,F.Cb)()],Y.prototype,"label",null),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Features/t9n/Features")],Y.prototype,"messages",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/t9n/common")],Y.prototype,"messagesCommon",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"promises",null),(0,w._)([(0,F.Cb)()],Y.prototype,"responsiveActionsEnabled",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],Y.prototype,"selectedFeature",null),(0,w._)([(0,F.Cb)()],Y.prototype,"selectedFeatureIndex",null),(0,w._)([(0,F.Cb)({readOnly:!0})],Y.prototype,"selectedFeatureWidget",null),(0,w._)([(0,F.Cb)()],Y.prototype,"title",null),(0,w._)([(0,F.Cb)()],Y.prototype,"updateLocationEnabled",null),(0,w._)([(0,F.Cb)()],Y.prototype,"view",null),(0,w._)([(0,F.Cb)({type:Ei}),(0,Nn.s)(["triggerAction","trigger-action"])],Y.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)({type:Sn,nonNullable:!0})],Y.prototype,"visibleElements",void 0),(0,w._)([(0,F.Cb)()],Y.prototype,"visible",null),Y=(0,w._)([(0,V.j)("esri.widgets.Features")],Y);const dr=Y,Ie="esri-popup",qe=`${Ie}--is-docked`,ie={base:Ie,main:`${Ie}__main-container`,shadow:`${Ie}--shadow`,isDocked:qe,isDockedTopLeft:`${qe}-top-left`,isDockedTopCenter:`${qe}-top-center`,isDockedTopRight:`${qe}-top-right`,isDockedBottomLeft:`${qe}-bottom-left`,isDockedBottomCenter:`${qe}-bottom-center`,isDockedBottomRight:`${qe}-bottom-right`,alignTopCenter:`${Ie}--aligned-top-center`,alignBottomCenter:`${Ie}--aligned-bottom-center`,alignTopLeft:`${Ie}--aligned-top-left`,alignBottomLeft:`${Ie}--aligned-bottom-left`,alignTopRight:`${Ie}--aligned-top-right`,alignBottomRight:`${Ie}--aligned-bottom-right`,pointer:`${Ie}__pointer`,pointerDirection:`${Ie}__pointer-direction`};let Ti=class extends Ei{constructor(d){super(d)}};Ti=(0,w._)([(0,V.j)("esri.widgets.Popup.PopupViewModel")],Ti);const $n=Ti;let mt=class extends Le.Z{constructor(){super(...arguments),this.closeButton=!0,this.featureNavigation=!0}};(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],mt.prototype,"closeButton",void 0),(0,w._)([(0,F.Cb)({type:Boolean,nonNullable:!0})],mt.prototype,"featureNavigation",void 0),mt=(0,w._)([(0,V.j)("esri.widgets.Features.PopupVisibleElements")],mt);const Zn=mt,Dn={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let D=class extends le.Z{constructor(d,h){super(d,h),this._dockAction=new se.Z({id:"popup-dock-action"}),this._featuresWidget=new dr({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.spinnerEnabled=!0,this.viewModel=new $n,this.visibleElements=new Zn}initialize(){this.addHandles([(0,T.YP)(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),{initial:!0}),(0,T.YP)(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),{initial:!0}),(0,T.YP)(()=>this.dockOptions,d=>{const{_dockAction:h}=this,g=this._featuresWidget.headerActions;g.remove(h),d.buttonEnabled&&g.add(h)},{initial:!0}),(0,T.YP)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,T.YP)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,T.YP)(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,T.YP)(()=>this.viewModel?.view?.size,(d,h)=>this._updateDockEnabledForViewSize(d,h)),(0,T.YP)(()=>this.viewModel?.view,(d,h)=>this._viewChange(d,h)),(0,T.YP)(()=>this.viewModel?.view?.ready,(d,h)=>this._viewReadyChange(d??!1,h??!1)),(0,T.YP)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,{initial:!0}),(0,T.YP)(()=>this._featureNavigationTop,d=>this._featuresWidget.featureNavigationTop=d,{initial:!0}),(0,T.YP)(()=>this.headingLevel,d=>this._featuresWidget.headingLevel=d,{initial:!0}),(0,T.YP)(()=>this.collapseEnabled,d=>this._featuresWidget.visibleElements.collapseButton=d,{initial:!0}),(0,T.YP)(()=>this.collapsed,d=>this._featuresWidget.collapsed=d,{initial:!0}),(0,T.YP)(()=>this.visibleElements.closeButton,d=>this._featuresWidget.visibleElements.closeButton=!!d,{initial:!0}),(0,T.YP)(()=>this.spinnerEnabled,d=>this._featuresWidget.visibleElements.spinner=d,{initial:!0}),(0,T.YP)(()=>this.visibleElements.featureNavigation,d=>this._featuresWidget.visibleElements.featureNavigation=!!d,{initial:!0}),(0,T.on)(()=>this._featuresWidget,"trigger-header-action",d=>{d.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:d,currentDockPosition:h}=this;return"bottom-left"===d||"bottom-center"===d||"bottom-right"===d||"top-left"===h||"top-center"===h||"top-right"===h}get actions(){return this.viewModel.actions}set actions(d){this.viewModel.actions=d}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(d){this.viewModel.autoCloseEnabled=d}get autoOpenEnabled(){return(0,q.Mr)(J.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(d){(0,q.Mr)(J.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=d}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(d){this.viewModel.defaultPopupTemplateEnabled=d}get content(){return this.viewModel.content}set content(d){this.viewModel.content=d}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Dn}set dockOptions(d){const h={...Dn},g=this.viewModel?.view?.breakpoints,y={};g&&(y.width=g.xsmall,y.height=g.xsmall);const v={...h,...d},b={...h.breakpoint,...y},{breakpoint:M}=v;"object"==typeof M?v.breakpoint={...b,...M}:M&&(v.breakpoint=b),this._set("dockOptions",v),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(d){this.viewModel.featureMenuOpen=d}get features(){return this.viewModel.features}set features(d){this.viewModel.features=d}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(d){this.viewModel.goToOverride=d}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(d){this.viewModel.highlightEnabled=d}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get promises(){return this.viewModel.promises}set promises(d){this.viewModel.promises=d}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(d){this.viewModel.selectedFeatureIndex=d}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(d){this.viewModel.updateLocationEnabled=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}blur(){const{active:d}=this.viewModel;d||J.Z.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(d,h){return this.viewModel.fetchFeatures(d,h)}focus(){const{active:d}=this.viewModel;d||J.Z.getLogger(this).warn("Popup can only be focused when currently active."),this.renderNow(),this._featuresWidget.focus()}next(){return this.viewModel.next()}open(d){this.set({collapsed:!!d&&!!d.collapsed,featureMenuOpen:!!d&&!!d.featureMenuOpen}),this.viewModel.open(d),this._shouldFocus(d)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(d){return this.viewModel.triggerAction(d)}render(){const{dockEnabled:d,currentAlignment:h,currentDockPosition:g}=this,{active:y}=this.viewModel,v=y&&d,b=y&&!d,M=this.selectedFeature?.layer?.title,I=this.selectedFeature?.layer?.id;return(0,A.u)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(ie.base,{[ie.alignTopCenter]:"top-center"===h,[ie.alignBottomCenter]:"bottom-center"===h,[ie.alignTopLeft]:"top-left"===h,[ie.alignBottomLeft]:"bottom-left"===h,[ie.alignTopRight]:"top-right"===h,[ie.alignBottomRight]:"bottom-right"===h,[ie.isDocked]:v,[ie.shadow]:b,[ie.isDockedTopLeft]:"top-left"===g,[ie.isDockedTopCenter]:"top-center"===g,[ie.isDockedTopRight]:"top-right"===g,[ie.isDockedBottomLeft]:"bottom-left"===g,[ie.isDockedBottomCenter]:"bottom-center"===g,[ie.isDockedBottomRight]:"bottom-right"===g}),"data-layer-id":I,"data-layer-title":M,role:"presentation"},y?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,A.u)("div",{class:ie.pointer,key:"popup-pointer",role:"presentation"},(0,A.u)("div",{class:this.classes(ie.pointerDirection,ie.shadow)}))}_renderMainContainer(){const{dockEnabled:d}=this;return(0,A.u)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(ie.main,U.z.widget,{[ie.shadow]:d})},this._featuresWidget.render())}_shouldFocus(d){var h=this;return(0,R.Z)(function*(){d?.shouldFocus&&(yield(0,T.N1)(()=>!0===h.viewModel?.active),h.focus())})()}_isOutsideView(d){const{popupHeight:h,popupWidth:g,screenLocation:y,side:v,view:b}=d;if(isNaN(g)||isNaN(h)||!b||!y)return!1;const M=b.padding;return"right"===v&&y.x+g/2>b.width-M.right||"left"===v&&y.x-g/2<M.left||"top"===v&&y.y-h<M.top||"bottom"===v&&y.y+h>b.height-M.bottom}_calculateAutoAlignment(d){if("auto"!==d)return d;const{_pointerOffsetInPx:h,_containerNode:g,_mainContainerNode:y,viewModel:v}=this,{screenLocation:b,view:M}=v;if(null==b||!M||!g)return"top-center";function I(k){return parseInt(k.replaceAll(/[^-\d\.]/g,""),10)}const _=y?window.getComputedStyle(y,null):null,x=_?I(_.getPropertyValue("max-height")):0,E=_?I(_.getPropertyValue("height")):0,{height:P,width:L}=g.getBoundingClientRect(),O=L+h,N=Math.max(P,x,E)+h,Z=this._isOutsideView({popupHeight:N,popupWidth:O,screenLocation:b,side:"right",view:M}),W=this._isOutsideView({popupHeight:N,popupWidth:O,screenLocation:b,side:"left",view:M}),B=this._isOutsideView({popupHeight:N,popupWidth:O,screenLocation:b,side:"top",view:M}),Q=this._isOutsideView({popupHeight:N,popupWidth:O,screenLocation:b,side:"bottom",view:M});return W?B?"bottom-right":"top-right":Z?B?"bottom-left":"top-left":B?Q?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(d){return"function"==typeof d?d.call(this):d}_getCurrentAlignment(){const{alignment:d,dockEnabled:h}=this;return h||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(d)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(d){const h=["left","right"];return(0,Ae.dZ)(this.container)&&h.reverse(),d?.replace(/leading/gi,h[0]).replaceAll(/trailing/gi,h[1])}_callDockPosition(d){return"function"==typeof d?d.call(this):d}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(d){if("auto"!==d)return d;const h=this.viewModel?.view,g=(0,Ae.dZ)(this.container)?"top-left":"top-right";if(!h)return g;const y=h.padding||{left:0,right:0,top:0,bottom:0},v=h.width-y.left-y.right,{breakpoints:b}=h;return b&&v<=b.xsmall?"bottom-center":g}_getDockIcon(){const d=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(d){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(d){this._mainContainerNode=d}_positionContainer(d=this._containerNode){if(d&&(this._containerNode=d),!this._containerNode)return;const{screenLocation:h}=this.viewModel,{width:g}=this._containerNode.getBoundingClientRect(),y=this._calculatePositionStyle(h,g);y&&Object.assign(this._containerNode.style,y)}_calculateFullWidth(d){const{currentAlignment:h,_pointerOffsetInPx:g}=this;return"top-left"===h||"bottom-left"===h||"top-right"===h||"bottom-right"===h?d+g:d}_calculateAlignmentPosition(d,h,g,y){const{currentAlignment:v,_pointerOffsetInPx:b}=this;if(!g)return;const{padding:M}=g,I=y/2,_=g.height-h,x=g.width-d;return"bottom-center"===v?{top:h+b-M.top,left:d-I-M.left}:"top-left"===v?{bottom:_+b-M.bottom,right:x+b-M.right}:"bottom-left"===v?{top:h+b-M.top,right:x+b-M.right}:"top-right"===v?{bottom:_+b-M.bottom,left:d+b-M.left}:"bottom-right"===v?{top:h+b-M.top,left:d+b-M.left}:"top-center"===v?{bottom:_+b-M.bottom,left:d-I-M.left}:void 0}_calculatePositionStyle(d,h){const{dockEnabled:g,view:y}=this;if(!y)return;if(g)return{left:"",top:"",right:"",bottom:""};if(null==d||!h)return;const v=this._calculateFullWidth(h),b=this._calculateAlignmentPosition(d.x,d.y,y,v);return b?{top:void 0!==b.top?`${b.top}px`:"auto",left:void 0!==b.left?`${b.left}px`:"auto",bottom:void 0!==b.bottom?`${b.bottom}px`:"auto",right:void 0!==b.right?`${b.right}px`:"auto"}:void 0}_viewChange(d,h){d&&h&&(this.close(),this.clear())}_viewReadyChange(d,h){d?this._wireUpView():h&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(d,h,g){const[y,v]=d,[b,M]=h,{width:I=0,height:_=0}=g??{};return y<=I&&b>I||y>I&&b<=I||v<=_&&M>_||v>_&&M<=_}_updateDockEnabledForViewSize(d,h){if(!d||!h)return;const g=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},y=g.left+g.right,v=g.top+g.bottom,b=[],M=[];b[0]=d[0]-y,b[1]=d[1]-v,M[0]=h[0]-y,M[1]=h[1]-v;const{dockOptions:I}=this;this._dockingThresholdCrossed(b,M,I.breakpoint)&&this._setDockEnabledForViewSize(I),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:d,viewModel:h}=this;h&&(h.screenLocationEnabled=h.active&&!d)}_shouldDockAtCurrentViewSize(d){const h=d.breakpoint,g=this.viewModel?.view?.ui;if(!g)return!1;const{width:y,height:v}=g;if(isNaN(y)||isNaN(v)||!h)return!1;const b=h.hasOwnProperty("width")&&y<=(h.width??0),M=h.hasOwnProperty("height")&&v<=(h.height??0);return b||M}_setDockEnabledForViewSize(d){d.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(d))}};(0,w._)([(0,F.Cb)({readOnly:!0})],D.prototype,"_featureNavigationTop",null),(0,w._)([(0,F.Cb)()],D.prototype,"actions",null),(0,w._)([(0,F.Cb)()],D.prototype,"alignment",void 0),(0,w._)([(0,F.Cb)()],D.prototype,"autoCloseEnabled",null),(0,w._)([(0,F.Cb)()],D.prototype,"autoOpenEnabled",null),(0,w._)([(0,F.Cb)()],D.prototype,"defaultPopupTemplateEnabled",null),(0,w._)([(0,F.Cb)()],D.prototype,"content",null),(0,w._)([(0,F.Cb)()],D.prototype,"collapsed",void 0),(0,w._)([(0,F.Cb)()],D.prototype,"collapseEnabled",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],D.prototype,"currentAlignment",null),(0,w._)([(0,F.Cb)({readOnly:!0})],D.prototype,"currentDockPosition",null),(0,w._)([(0,F.Cb)()],D.prototype,"dockOptions",null),(0,w._)([(0,F.Cb)()],D.prototype,"dockEnabled",void 0),(0,w._)([(0,F.Cb)({readOnly:!0})],D.prototype,"featureCount",null),(0,w._)([(0,F.Cb)()],D.prototype,"featureMenuOpen",null),(0,w._)([(0,F.Cb)()],D.prototype,"features",null),(0,w._)([(0,F.Cb)()],D.prototype,"goToOverride",null),(0,w._)([(0,F.Cb)()],D.prototype,"headingLevel",void 0),(0,w._)([(0,F.Cb)()],D.prototype,"highlightEnabled",null),(0,w._)([(0,F.Cb)()],D.prototype,"location",null),(0,w._)([(0,F.Cb)()],D.prototype,"label",null),(0,w._)([(0,F.Cb)()],D.prototype,"maxInlineActions",void 0),(0,w._)([(0,F.Cb)(),(0,be.H)("esri/widgets/Popup/t9n/Popup")],D.prototype,"messages",void 0),(0,w._)([(0,F.Cb)()],D.prototype,"promises",null),(0,w._)([(0,F.Cb)({readOnly:!0})],D.prototype,"selectedFeature",null),(0,w._)([(0,F.Cb)()],D.prototype,"selectedFeatureIndex",null),(0,w._)([(0,F.Cb)({readOnly:!0})],D.prototype,"selectedFeatureWidget",null),(0,w._)([(0,F.Cb)()],D.prototype,"spinnerEnabled",void 0),(0,w._)([(0,F.Cb)()],D.prototype,"title",null),(0,w._)([(0,F.Cb)()],D.prototype,"updateLocationEnabled",null),(0,w._)([(0,F.Cb)()],D.prototype,"view",null),(0,w._)([(0,F.Cb)({type:$n}),(0,Nn.s)(["triggerAction","trigger-action"])],D.prototype,"viewModel",void 0),(0,w._)([(0,F.Cb)()],D.prototype,"visible",null),(0,w._)([(0,F.Cb)({type:Zn,nonNullable:!0})],D.prototype,"visibleElements",void 0),D=(0,w._)([(0,V.j)("esri.widgets.Popup")],D);const ur=D}}]);