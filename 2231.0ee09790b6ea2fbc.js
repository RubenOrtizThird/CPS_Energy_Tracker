"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[2231],{90295:(w,Z,s)=>{s.d(Z,{Z:()=>d});class d{constructor(p){this.size=0,this._start=0,this.maxSize=p,this._buffer=new Array(p)}get entries(){return this._buffer}enqueue(p){if(this.size===this.maxSize){const T=this._buffer[this._start];return this._buffer[this._start]=p,this._start=(this._start+1)%this.maxSize,T}return this._buffer[(this._start+this.size++)%this.maxSize]=p,null}dequeue(){if(0===this.size)return null;const p=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,p}peek(){return 0===this.size?null:this._buffer[this._start]}find(p){if(0===this.size)return null;for(const T of this._buffer)if(null!=T&&p(T))return T;return null}clear(p){let T=this.dequeue();for(;null!=T;)p&&p(T),T=this.dequeue()}}},29085:(w,Z,s)=>{s.d(Z,{EG:()=>B,Op:()=>h,S2:()=>_});var d=s(10842),M=s(62209);const p=new M.Z,T=new M.Z,F=new M.Z,I={esriGeometryPoint:d.fQ,esriGeometryPolyline:d.J6,esriGeometryPolygon:d.eG,esriGeometryMultipoint:d.Iv};function B(l,o,a,c=l.hasZ,P=l.hasM){if(null==o)return null;const R=l.hasZ&&c,A=l.hasM&&P;if(a){const O=(0,d.Nh)(F,o,l.hasZ,l.hasM,"esriGeometryPoint",a,c,P);return(0,d.fQ)(O,R,A)}return(0,d.fQ)(o,R,A)}function h(l,o,a,c,P,R,A=o,O=a){const i=o&&A,n=a&&O,t=null!=c?"coords"in c?c:c.geometry:null;if(null==t)return null;if(P){let u=(0,d.zj)(T,t,o,a,l,P,A,O);return R&&(u=(0,d.Nh)(F,u,i,n,l,R)),I[l]?.(u,i,n)??null}if(R){const u=(0,d.Nh)(F,t,o,a,l,R,A,O);return I[l]?.(u,i,n)??null}return(0,d.hY)(p,t,o,a,A,O),I[l]?.(p,i,n)??null}function _(l){return l&&m in l?JSON.parse(JSON.stringify(l,f)):l}const m="_geVersion",f=(l,o)=>l!==m?o:void 0},44452:(w,Z,s)=>{s.d(Z,{Ti:()=>f,Up:()=>l,j6:()=>a});var d=s(15861),M=s(84303),p=s(49602),T=s(83821),F=s(14138),I=s(40637),B=s(93566),h=s(33721),_=s(58829);const m=new M.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),f=Object.freeze({});function l(t,u,S){return o.apply(this,arguments)}function o(){return(o=(0,d.Z)(function*(t,u,S){const{outFields:v,orderByFields:y,groupByFieldsForStatistics:U,outStatistics:r}=t;if(v)for(let e=0;e<v.length;e++)v[e]=v[e].trim();if(y)for(let e=0;e<y.length;e++)y[e]=y[e].trim();if(U)for(let e=0;e<U.length;e++)U[e]=U[e].trim();if(r)for(let e=0;e<r.length;e++)r[e].onStatisticField&&(r[e].onStatisticField=r[e].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),a(t,u,S)})).apply(this,arguments)}function a(t,u,S){return c.apply(this,arguments)}function c(){return c=(0,d.Z)(function*(t,u,S){if(!t)return null;let{where:v}=t;if(t.where=v=v?.trim(),(!v||/^1 *= *1$/.test(v)||u&&u===v)&&(t.where=null),!t.geometry)return t;let y=yield function A(t){return O.apply(this,arguments)}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:U}=t.geometry;y=(0,F.aO)(y),y.spatialReference=U}if(y){yield(0,_._W)(y.spatialReference,S),y=function R(t,u){const S=t.spatialReference;return P(t,u)&&(0,I.YX)(t)?{spatialReference:S,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}(y,S);const U=(yield(0,B.aX)((0,I.im)(y)))[0];if(null==U)throw f;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,e=r&&P(y,S)?{densificationStep:8*r}:void 0,g=U.toJSON(),E=(0,_.iV)(g,g.spatialReference,S,e);if(!E)throw f;E.spatialReference=S,t.geometry=E}return t}),c.apply(this,arguments)}function P(t,u){if(!t)return!1;const S=t.spatialReference;return((0,I.YX)(t)||(0,I.oU)(t)||(0,I.l9)(t))&&!(0,h.fS)(S,u)&&!(0,T.canProjectWithoutEngine)(S,u)}function O(){return O=(0,d.Z)(function*(t){const{distance:u,units:S}=t,v=t.geometry;if(null==u||"vertexAttributes"in v)return v;const y=v.spatialReference,U=S?m.fromJSON(S):(0,p.qE)(y),r=y&&((0,h.sT)(y)||(0,h.sS)(y))?v:yield(0,_._W)(y,h.Zn).then(()=>(0,_.iV)(v,h.Zn));return(yield function i(){return n.apply(this,arguments)}())(r.spatialReference,r,u,U)}),O.apply(this,arguments)}function n(){return(n=(0,d.Z)(function*(){return(yield Promise.all([s.e(9465),s.e(8592)]).then(s.bind(s,49574))).geodesicBuffer})).apply(this,arguments)}},51089:(w,Z,s)=>{s.d(Z,{hN:()=>U,P0:()=>v,cW:()=>S});var d=s(15861),M=s(57964),p=s(5825),T=s(26230),I=s(40637),B=s(33721);function h(r,e){return r?e?4:3:e?3:2}function f(r,e,g,E,G){if(!r)return!1;const x=h(e,g),{coords:j,lengths:C}=r;let D=!1,b=0;for(const N of C)D=l(D,j,x,b,N,E,G),b+=N*x;return D}function l(r,e,g,E,G,x,j){let C=r,D=E;for(let b=E,N=E+G*g;b<N;b+=g){D=b+g,D===N&&(D=E);const L=e[b],z=e[b+1],W=e[D+1];(z<j&&W>=j||W<j&&z>=j)&&L+(j-z)/(W-z)*(e[D]-L)<x&&(C=!C)}return C}var o=s(10842),a=s(62209),c=s(29085),P=s(58829);const R="unsupported-query",A={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},O={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function S(r,e,g,E,G){if((0,I.oU)(e)&&"esriGeometryPoint"===g&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){const x=(0,o.Uy)(new a.Z,e,!1,!1);return Promise.resolve(j=>function _(r,e,g,E){return f(r,e,g,E.coords[0],E.coords[1])}(x,!1,!1,j))}if((0,I.oU)(e)&&"esriGeometryMultipoint"===g){const x=(0,o.Uy)(new a.Z,e,!1,!1);if("esriSpatialRelContains"===r)return Promise.resolve(j=>function m(r,e,g,E,G,x){const j=h(G,x),{coords:C,lengths:D}=E;if(!D)return!1;for(let b=0,N=0;b<D.length;b++,N+=j)if(!f(r,e,g,C[N],C[N+1]))return!1;return!0}(x,!1,!1,j,E,G))}if((0,I.YX)(e)&&"esriGeometryPoint"===g&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))return Promise.resolve(x=>(0,p.aV)(e,(0,c.Op)(g,E,G,x)));if((0,I.YX)(e)&&"esriGeometryMultipoint"===g&&"esriSpatialRelContains"===r)return Promise.resolve(x=>(0,p.lQ)(e,(0,c.Op)(g,E,G,x)));if((0,I.YX)(e)&&"esriSpatialRelIntersects"===r){const x=function F(r){return"mesh"===r?T.h_:(0,T.IY)(r)}(g);return Promise.resolve(j=>x(e,(0,c.Op)(g,E,G,j)))}return function u(){return Promise.all([s.e(9465),s.e(8592)]).then(s.bind(s,49574))}().then(x=>{const j=x[A[r]].bind(null,e.spatialReference,e);return C=>j((0,c.Op)(g,E,G,C))})}function v(r,e,g){return y.apply(this,arguments)}function y(){return(y=(0,d.Z)(function*(r,e,g){const{spatialRel:E,geometry:G}=r;if(G){if(!function i(r){return null!=r&&!0===O.spatialRelationship[r]}(E))throw new M.Z(R,"Unsupported query spatial relationship",{query:r});if((0,B.JY)(G.spatialReference)&&(0,B.JY)(g)){if(!function n(r){return null!=r&&!0===O.queryGeometry[(0,I.Ji)(r)]}(G))throw new M.Z(R,"Unsupported query geometry type",{query:r});if(!function t(r){return null!=r&&!0===O.layerGeometry[r]}(e))throw new M.Z(R,"Unsupported layer geometry type",{query:r});if(r.outSR)return(0,P._W)(r.geometry?.spatialReference,r.outSR)}}})).apply(this,arguments)}function U(r){if((0,I.YX)(r))return!0;if((0,I.oU)(r)){for(const e of r.rings)if(5!==e.length||e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1;return!0}return!1}},21418:(w,Z,s)=>{s.d(Z,{R:()=>M,y:()=>T});var d=s(15861);function M(h,_){return p.apply(this,arguments)}function p(){return(p=(0,d.Z)(function*(h,_){if(!h)return null;const m=_.featureAdapter,{startTimeField:f,endTimeField:l}=h;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(f&&l)yield _.forEach(c=>{const P=m.getAttribute(c,f),R=m.getAttribute(c,l);null==P||isNaN(P)||(o=Math.min(o,P)),null==R||isNaN(R)||(a=Math.max(a,R))});else{const c=f||l;yield _.forEach(P=>{const R=m.getAttribute(P,c);null==R||isNaN(R)||(o=Math.min(o,R),a=Math.max(a,R))})}return{start:o,end:a}})).apply(this,arguments)}function T(h,_,m){if(!_||!h)return null;const{startTimeField:f,endTimeField:l}=h;if(!f&&!l)return null;const{start:o,end:a}=_;if(null===o&&null===a)return null;if(void 0===o&&void 0===a)return()=>!1;const c=m.getAttributeAsTimestamp?.bind(m)??m.getAttribute.bind(m);return f&&l?function F(h,_,m,f,l){return null!=f&&null!=l?o=>{const a=h(o,_),c=h(o,m);return(null==a||a<=l)&&(null==c||c>=f)}:null!=f?o=>{const a=h(o,m);return null==a||a>=f}:null!=l?o=>{const a=h(o,_);return null==a||a<=l}:void 0}(c,f,l,o,a):function I(h,_,m,f){return null!=m&&null!=f&&m===f?l=>h(l,_)===m:null!=m&&null!=f?l=>{const o=h(l,_);return null!=o&&o>=m&&o<=f}:null!=m?l=>{const o=h(l,_);return null!=o&&o>=m}:null!=f?l=>{const o=h(l,_);return null!=o&&o<=f}:void 0}(c,f||l,o,a)}},95251:(w,Z,s)=>{s.r(Z),s.d(Z,{default:()=>A});var d=s(15861),M=s(57964),p=s(4703),T=s(45425),F=s(43585),I=s(44452),B=s(51089),h=s(21418),_=s(91866),m=s(12915),f=s(38955);const l=p.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),o={getAttribute:(O,i)=>O.readAttribute(i)};function c(){return(c=(0,d.Z)(function*(O,i){try{const n=yield(0,f.E)(O,i);if(!n.isStandardized){const t=new M.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",n);l.error(t)}return t=>{const u=t.readArcadeFeature();return n.testFeature(u,o)}}catch{return l.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",O),t=>!0}})).apply(this,arguments)}class A{constructor(i){this._geometryBounds=(0,T.Ue)(),this._idToVisibility=new Map,this._serviceInfo=i}get hash(){return this._hash}check(i){return this._applyFilter(i)}clear(){const i=this._resetAllHiddenIds();return this.update(),{show:i,hide:[]}}invalidate(){this._idToVisibility.forEach((i,n)=>{this._idToVisibility.set(n,0)})}setKnownIds(i){for(const n of i)this._idToVisibility.set(n,1)}setTrue(i){const n=[],t=[],u=new Set(i);return this._idToVisibility.forEach((S,v)=>{const y=!!(1&this._idToVisibility.get(v)),U=u.has(v);!y&&U?n.push(v):y&&!U&&t.push(v),this._idToVisibility.set(v,U?3:0)}),{show:n,hide:t}}createQuery(){const{geometry:i,spatialRel:n,where:t,timeExtent:u,objectIds:S}=this;return _.Z.fromJSON({geometry:i,spatialRel:n,where:t,timeExtent:u,objectIds:S})}update(i,n){var t=this;return(0,d.Z)(function*(){t._hash=JSON.stringify(i);const u=yield(0,I.j6)(i,null,n);yield Promise.all([t._setGeometryFilter(u),t._setIdFilter(u),t._setAttributeFilter(u),t._setTimeFilter(u)])})()}_setAttributeFilter(i){var n=this;return(0,d.Z)(function*(){if(!i?.where)return n._clause=null,void(n.where=null);n._clause=yield function a(O,i){return c.apply(this,arguments)}(i.where,n._serviceInfo.fieldsIndex),n.where=i.where})()}_setIdFilter(i){this._idsToShow=i?.objectIds&&new Set(i.objectIds),this._idsToHide=i?.hiddenIds&&new Set(i.hiddenIds),this.objectIds=i?.objectIds}_setGeometryFilter(i){var n=this;return(0,d.Z)(function*(){if(!i?.geometry)return n._spatialQueryOperator=null,n.geometry=null,void(n.spatialRel=null);const t=i.geometry,u=i.spatialRel||"esriSpatialRelIntersects",S=yield(0,B.cW)(u,t,n._serviceInfo.geometryType,n._serviceInfo.hasZ,n._serviceInfo.hasM);(0,F.$P)(n._geometryBounds,t),n._spatialQueryOperator=S,n.geometry=t,n.spatialRel=u})()}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=(0,h.y)(this._serviceInfo.timeInfo,i.timeExtent,m.k);else{const n=new M.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",i.timeExtent);p.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(n)}}_applyFilter(i){return this._filterByGeometry(i)&&this._filterById(i)&&this._filterByTime(i)&&this._filterByExpression(i)}_filterByExpression(i){return!this.where||this._clause(i)}_filterById(i){return(!this._idsToHide?.size||!this._idsToHide.has(i.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(i.getObjectId()))}_filterByGeometry(i){if(!this.geometry)return!0;const n=i.readHydratedGeometry();return!!n&&this._spatialQueryOperator(n)}_filterByTime(i){return null==this._timeOperator||this._timeOperator(i)}_resetAllHiddenIds(){const i=[];return this._idToVisibility.forEach((n,t)=>{1&n||(this._idToVisibility.set(t,1),i.push(t))}),i}}}}]);