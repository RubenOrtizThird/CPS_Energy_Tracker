"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[782,5251],{50782:(W,M,s)=>{s.r(M),s.d(M,{default:()=>K});var h=s(15861),d=s(50484),U=s(5603),g=s(30352),D=s(4703),O=s(3233),j=s(79412),c=s(77675),y=s(80543),C=(s(1535),s(57678),s(14007),s(49301)),x=s(62185),A=s(10141),S=s(7547),T=s(60301),R=s(95060),_=s(19855),r=s(80099),e=s(70509),i=s(29717),o=s(79936),a=s(27835),b=s(41528),v=s(95140),P=s(16031);const f=Symbol("WebScene");var l=s(84735),B=s(46018),F=s(5538);let p=class extends((0,_.h)((0,i.M)((0,r.q)((0,e.I)((0,P.Q)((0,v.K)((0,O.R)(R.Z)))))))){constructor(t){var n;super(t),n=this,this.allLayers=new U.Z({getCollections:()=>[this.layers],getChildrenFunction:u=>"layers"in u?u.layers:null}),this.allTables=(0,b.a)(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=(0,j.Ds)(function(){var u=(0,h.Z)(function*(m,I,V){const{save:G,saveAs:H}=yield Promise.all([s.e(8592),s.e(1219)]).then(s.bind(s,90254));switch(m){case l.x.SAVE:return G(n,I);case l.x.SAVE_AS:return H(n,V,I)}});return function(m,I,V){return u.apply(this,arguments)}}())}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([(0,c.YP)(()=>{let t=this.parent;for(;t&&"parent"in t&&t.parent;)t=t.parent;return t&&f in t},t=>{const n="prevent-adding-tables";this.removeHandles(n),t&&(this.tables.removeAll(),this.addHandles((0,c.on)(()=>this.tables,"before-add",u=>{u.preventDefault(),D.Z.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),n))},c.tX),(0,c.YP)(()=>this.visible,this._onVisibilityChange.bind(this),c.Z_)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===T.s3.USER}_writeLayers(t,n,u,m){const I=[];if(!t)return I;t.forEach(V=>{const G=(0,F.Nw)(V,m.webmap?m.webmap.getLayerJSONFromResourceInfo(V):null,m);G?.layerType&&I.push(G)}),n.layers=I}set portalItem(t){this._set("portalItem",t)}readPortalItem(t,n,u){const{itemId:m,layerType:I}=n;if("GroupLayer"===I&&m)return new a.default({id:m,portal:u?.portal})}writePortalItem(t,n){t?.id&&(n.itemId=t.id)}set visibilityMode(t){const n=this._get("visibilityMode")!==t;this._set("visibilityMode",t),n&&this._enforceVisibility(t,this.visible)}beforeSave(){var t=this;return(0,h.Z)(function*(){return(0,B.Pl)(t)})()}load(t){const n=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:o.T},t).catch(u=>{if((0,j.r9)(u),this.sourceIsPortalItem)throw u});return this.addResolvingPromise(n),Promise.resolve(this)}loadAll(){var t=this;return(0,h.Z)(function*(){return(0,g.G)(t,n=>{n(t.layers,t.tables)})})()}save(t){var n=this;return(0,h.Z)(function*(){return n._debouncedSaveOperations(l.x.SAVE,t)})()}saveAs(t,n){var u=this;return(0,h.Z)(function*(){return u._debouncedSaveOperations(l.x.SAVE_AS,n,t)})()}layerAdded(t){t.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(t):"inherited"===this.visibilityMode&&(t.visible=this.visible),this.hasHandles(t.uid)?console.error(`Layer readded to Grouplayer: uid=${t.uid}`):this.addHandles((0,c.YP)(()=>t.visible,n=>this._onChildVisibilityChange(t,n),c.Z_),t.uid)}layerRemoved(t){this.removeHandles(t.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(t){this.layers.forEach(n=>{n!==t&&(n.visible=!1)})}_enforceVisibility(t,n){if(!(0,C.vw)(this).initialized)return;const u=this.layers;let m=u.find(I=>I.visible);switch(t){case"exclusive":u.length&&!m&&(m=u.at(0),m.visible=!0),this._turnOffOtherLayers(m);break;case"inherited":u.forEach(I=>{I.visible=n})}}_onVisibilityChange(t){"inherited"===this.visibilityMode&&this.layers.forEach(n=>{n.visible=t})}_onChildVisibilityChange(t,n){switch(this.visibilityMode){case"exclusive":n?this._turnOffOtherLayers(t):this._isAnyLayerVisible()||(t.visible=!0);break;case"inherited":t.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(t=>t.visible)}};(0,d._)([(0,y.Cb)({readOnly:!0,dependsOn:[]})],p.prototype,"allLayers",void 0),(0,d._)([(0,y.Cb)({readOnly:!0})],p.prototype,"allTables",void 0),(0,d._)([(0,y.Cb)({json:{read:!0,write:!0}})],p.prototype,"blendMode",void 0),(0,d._)([(0,y.Cb)()],p.prototype,"fullExtent",void 0),(0,d._)([(0,y.Cb)({readOnly:!0})],p.prototype,"sourceIsPortalItem",null),(0,d._)([(0,y.Cb)({json:{read:!1,write:{ignoreOrigin:!0}}})],p.prototype,"layers",void 0),(0,d._)([(0,S.c)("layers")],p.prototype,"_writeLayers",null),(0,d._)([(0,y.Cb)({type:["GroupLayer"]})],p.prototype,"operationalLayerType",void 0),(0,d._)([(0,y.Cb)({json:{origins:{"web-map":{read:!1,write:{overridePolicy(t,n,u){return{enabled:"Group Layer"===t?.type&&u?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],p.prototype,"portalItem",null),(0,d._)([(0,x.r)("web-map","portalItem",["itemId"])],p.prototype,"readPortalItem",null),(0,d._)([(0,S.c)("web-map","portalItem",{itemId:{type:String}})],p.prototype,"writePortalItem",null),(0,d._)([(0,y.Cb)()],p.prototype,"spatialReference",void 0),(0,d._)([(0,y.Cb)({json:{read:!1},readOnly:!0,value:"group"})],p.prototype,"type",void 0),(0,d._)([(0,y.Cb)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(t,n,u)=>{"inherited"!==t&&(n[u]=t)}}}}})],p.prototype,"visibilityMode",null),p=(0,d._)([(0,A.j)("esri.layers.GroupLayer")],p);const K=p},5251:(W,M,s)=>{s.r(M),s.d(M,{addOrUpdateResource:()=>j,contentToBlob:()=>S,fetchResources:()=>D,getSiblingOfSameType:()=>R,getSiblingOfSameTypeI:()=>_,removeAllResources:()=>Z,removeResource:()=>y,splitPrefixFileNameAndExtension:()=>x});var h=s(15861),d=s(66476),U=s(57964),g=s(6785);function D(r){return O.apply(this,arguments)}function O(){return(O=(0,h.Z)(function*(r,e={},i){yield r.load(i);const o=(0,g.v_)(r.itemUrl,"resources"),{start:a=1,num:b=10,sortOrder:v="asc",sortField:P="created"}=e,f={query:{start:a,num:b,sortOrder:v,sortField:P,token:r.apiKey},signal:i?.signal},l=yield r.portal.request(o,f);return{total:l.total,nextStart:l.nextStart,resources:l.resources.map(({created:B,size:F,resource:p})=>({created:new Date(B),size:F,resource:r.resourceFromPath(p)}))}})).apply(this,arguments)}function j(r,e,i,o){return c.apply(this,arguments)}function c(){return(c=(0,h.Z)(function*(r,e,i,o){if(!r.hasPath())throw new U.Z(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const a=r.portalItem;yield a.load(o);const b=(0,g.v_)(a.userItemUrl,"add"===e?"addResources":"updateResources"),[v,P]=C(r.path),f=new FormData;return v&&"."!==v&&f.append("resourcesPrefix",v),null!=o&&o.compress&&f.append("compress","true"),f.append("fileName",P),f.append("file",i,P),f.append("f","json"),o?.access&&f.append("access",o.access),yield a.portal.request(b,{method:"post",body:f,signal:o?.signal}),r})).apply(this,arguments)}function y(r,e,i){return E.apply(this,arguments)}function E(){return(E=(0,h.Z)(function*(r,e,i){if(!e.hasPath())throw new U.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield r.load(i);const o=(0,g.v_)(r.userItemUrl,"removeResources");yield r.portal.request(o,{method:"post",query:{resource:e.path},signal:i?.signal}),e.portalItem=null})).apply(this,arguments)}function Z(r,e){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(r,e){yield r.load(e);const i=(0,g.v_)(r.userItemUrl,"removeResources");return r.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e?.signal})})).apply(this,arguments)}function C(r){const e=r.lastIndexOf("/");return-1===e?[".",r]:[r.slice(0,e),r.slice(e+1)]}function x(r){const[e,i]=function A(r){const e=(0,g.Ml)(r);return null==e?[r,""]:[r.slice(0,r.length-e.length-1),`.${e}`]}(r),[o,a]=C(e);return[o,a,i]}function S(r){return T.apply(this,arguments)}function T(){return(T=(0,h.Z)(function*(r){return"blob"===r.type?r.blob:"json"===r.type?new Blob([r.jsonString],{type:"application/json"}):(yield(0,d.Z)(r.url,{responseType:"blob"})).data})).apply(this,arguments)}function R(r,e){if(!r.hasPath())return null;const[i,,o]=x(r.path);return r.portalItem.resourceFromPath((0,g.v_)(i,e+o))}function _(r,e){if(!r.hasPath())return null;const[i,,o]=x(r.path);return r.portalItem.resourceFromPath((0,g.v_)(i,e+o))}},46018:(W,M,s)=>{s.d(M,{Hn:()=>j,Pl:()=>_,bx:()=>y});var h=s(15861),d=s(37636),U=s(57964),g=s(79412),D=s(19986),O=s(5251);function j(e,i){return c.apply(this,arguments)}function c(){return(c=(0,h.Z)(function*(e,i,o=null){const a=yield Z(e,i,o);yield C(a,i,o)})).apply(this,arguments)}function y(e,i,o,a){return E.apply(this,arguments)}function E(){return(E=(0,h.Z)(function*(e,i,o,a,b=null){const v=yield Z(o,a,b);yield e.update({data:i}),yield C(v,a,b)})).apply(this,arguments)}function Z(e,i){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(e,i,o=null){if(!i?.resources)return;const a=i.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=i.portalItem;const b=new Set(i.resources.toKeep.map(l=>l.resource.path)),v=new Set,P=[];b.forEach(l=>{a.delete(l),e.paths.push(l)});for(const l of i.resources.toUpdate)if(a.delete(l.resource.path),b.has(l.resource.path)||v.has(l.resource.path)){const{resource:B,content:F,finish:p,error:K}=l,t=(0,O.getSiblingOfSameTypeI)(B,(0,D.DO)());e.paths.push(t.path),P.push(A({resource:t,content:F,compress:l.compress,finish:p,error:K},o))}else e.paths.push(l.resource.path),P.push(T(l,o)),v.add(l.resource.path);for(const l of i.resources.toAdd)e.paths.push(l.resource.path),a.has(l.resource.path)?a.delete(l.resource.path):P.push(A(l,o));if(0===P.length)return a;const f=yield(0,g.UO)(P);if((0,g.k_)(o),f.length>0)throw new U.Z("save:resources","Failed to save one or more resources",{errors:f});return a})).apply(this,arguments)}function C(e,i){return x.apply(this,arguments)}function x(){return(x=(0,h.Z)(function*(e,i,o=null){if(!e||!i.portalItem)return;const a=[];for(const b of e){const v=i.portalItem.resourceFromPath(b);a.push(v.portalItem.removeResource(v,o))}yield(0,g.as)(a)})).apply(this,arguments)}function A(e,i){return S.apply(this,arguments)}function S(){return(S=(0,h.Z)(function*(e,i){const o={...i??{},compress:e.compress},a=yield(0,d.q6)(e.resource.portalItem.addResource(e.resource,yield(0,O.contentToBlob)(e.content),o));if(!0!==a.ok)throw e.error?.(a.error),a.error;e.finish?.(e.resource)})).apply(this,arguments)}function T(e,i){return R.apply(this,arguments)}function R(){return(R=(0,h.Z)(function*(e,i){const o=yield(0,d.q6)(e.resource.update(yield(0,O.contentToBlob)(e.content),i));if(!0!==o.ok)throw e.error?.(o.error),o.error;e.finish?.(e.resource)})).apply(this,arguments)}function _(e){return r.apply(this,arguments)}function r(){return(r=(0,h.Z)(function*(e){const i=[];for(const o of e.allLayers)if("beforeSave"in o&&"function"==typeof o.beforeSave){const a=o.beforeSave();a&&i.push(a)}yield Promise.allSettled(i)})).apply(this,arguments)}}}]);