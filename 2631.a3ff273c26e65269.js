"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[2631],{62631:(Z,f,s)=>{s.r(f),s.d(f,{default:()=>C});var a=s(15861),O=s(37636),c=s(57964),M=s(4703),E=s(79412),D=s(33721),g=s(10842),T=s(53919),h=s(58829),j=s(36518),m=s(78642),R=s(42726),F=s(21970),I=s(40100),S=s(764);class C{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(r,t){var e=this;return(0,a.Z)(function*(){const{getFeatureUrl:l,getFeatureOutputFormat:p,fields:n,geometryType:i,featureType:u,objectIdField:y,customParameters:_}=r,{spatialReference:o,getFeatureSpatialReference:d}=(0,F.fU)(l,u,r.spatialReference);e._featureType=u,e._customParameters=_,e._getFeatureUrl=l,e._getFeatureOutputFormat=p,e._getFeatureSpatialReference=d;try{yield(0,h._W)(d,o)}catch{throw new c.Z("unsupported-projection","Projection not supported",{inSpatialReference:d,outSpatialReference:o})}(0,E.k_)(t);const P=I.Z.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some(v=>"esriFieldTypeDate"===v.type)?{timeZoneIANA:S.pt}:null}),U=yield e._snapshotFeatures({fieldsIndex:P,geometryType:i,objectIdField:y,spatialReference:o},t.signal);return e._queryEngine=new j.q({fieldsIndex:P,geometryType:i,hasM:!1,hasZ:!1,objectIdField:y,spatialReference:o,timeInfo:null,featureStore:new T.Z({geometryType:i,hasM:!1,hasZ:!1})}),e._queryEngine.featureStore.addMany(U),{extent:(yield e._queryEngine.fetchRecomputedExtents()).fullExtent}})()}applyEdits(){return(0,a.Z)(function*(){throw new c.Z("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")})()}queryFeatures(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQuery(r,t.signal)})()}queryFeatureCount(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForCount(r,t.signal)})()}queryObjectIds(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForIds(r,t.signal)})()}queryExtent(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForExtent(r,t.signal)})()}querySnapping(r,t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForSnapping(r,t.signal)})()}refresh(r){var t=this;return(0,a.Z)(function*(){return t._customParameters=r,t._snapshotTask?.abort(),t._snapshotTask=(0,O.vr)(e=>t._snapshotFeatures(t._queryEngine,e)),t._snapshotTask.promise.then(e=>{t._queryEngine.featureStore.clear(),e&&t._queryEngine.featureStore.addMany(e)},e=>{t._queryEngine.featureStore.clear(),(0,E.D_)(e)||M.Z.getLogger("esri.layers.WFSLayer").error(new c.Z("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))}),yield t._waitSnapshotComplete(),{extent:(yield t._queryEngine.fetchRecomputedExtents()).fullExtent}})()}_waitSnapshotComplete(){var r=this;return(0,a.Z)(function*(){if(r._snapshotTask&&!r._snapshotTask.finished){try{yield r._snapshotTask.promise}catch{}return r._waitSnapshotComplete()}})()}_snapshotFeatures({objectIdField:r,geometryType:t,spatialReference:e,fieldsIndex:l},p){var n=this;return(0,a.Z)(function*(){const i=yield(0,F.Bm)(n._getFeatureUrl??"",n._featureType.typeName,n._getFeatureSpatialReference,n._getFeatureOutputFormat,{customParameters:n._customParameters,signal:p});(0,m.O3)(i,n._getFeatureSpatialReference.wkid),(0,E.k_)(p);const u=(0,m.lG)(i,{geometryType:t,hasZ:!1,objectIdField:r});if(!(0,D.fS)(e,n._getFeatureSpatialReference))for(const _ of u)null!=_.geometry&&(_.geometry=(0,g.GH)((0,h.iV)((0,g.di)(_.geometry,t,!1,!1),n._getFeatureSpatialReference,e)));let y=1;for(const _ of u){const o={};(0,R.O0)(l,o,_.attributes,!0),_.attributes=o,null==o[r]&&(_.objectId=o[r]=y++)}return u})()}}}}]);