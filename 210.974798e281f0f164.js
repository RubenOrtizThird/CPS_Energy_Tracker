"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[210,8065],{78857:(Y,j,x)=>{x.d(j,{H:()=>R});var A=x(15861),z=x(57964),F=x(14007),M=x(4703),_=x(79412),p=x(99657),u=x(35935),f=x(32196),E=x(84829),C=x(39237),B=x(83018),g=x(17091),D=x(22784);const I=M.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),T=(0,E.g)(E.P,I);class b{constructor(r,y,v){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:L,pixelType:U,textureOnly:W}=r,k=(0,f.UK)(U);this.shared=v,this.pixelType=U,this.size=y,this.textureOnly=W,W||(this.data=new k(L)),this._resetRange()}destroy(){this._texture?.dispose();for(const r in this._fbos){const y=this._fbos[r];y&&("0"===r&&y.detachColorTexture(),y.dispose()),this._fbos[r]=null}this._texture=null}get _textureDesc(){const r=new D.X;return r.wrapMode=C.e8.CLAMP_TO_EDGE,r.samplingMode=C.cw.NEAREST,r.dataType=this.pixelType,r.width=this.size,r.height=this.size,r}setData(r,y,v){const L=(0,u.jL)(r),U=this.data,W=L*this.texelSize+y;!U||W>=U.length||(U[W]=v,this.dirtyStart=Math.min(this.dirtyStart,L),this.dirtyEnd=Math.max(this.dirtyEnd,L))}getData(r,y){if(null==this.data)return null;const v=(0,u.jL)(r)*this.texelSize+y;return!this.data||v>=this.data.length?null:this.data[v]}getTexture(r){return this._texture??this._initTexture(r)}getFBO(r,y=0){if(!this._fbos[y]){const v=0===y?this.getTexture(r):this._textureDesc;this._fbos[y]=new B.X(r,v)}return this._fbos[y]}get locked(){return!(this.pixelType!==C.Br.UNSIGNED_BYTE||!this.shared||this.textureOnly||!(0,F.Z)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(r,y){if(!this.locked){try{const v=this.dirtyStart,L=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();const U=this.data.buffer,W=this.getTexture(r),k=4,J=(v-v%this.size)/this.size,G=J,re=(L-L%this.size)/this.size,se=J*this.size*k,ae=(this.size+re*this.size)*k-se,ie=(0,f.UK)(this.pixelType),Q=new ie(U,se*ie.BYTES_PER_ELEMENT,ae),ee=this.size,X=re-G+1;if(X>this.size)return void I.error(new z.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));W.updateData(0,0,G,ee,X,Q)}catch{}y()}}update(r){const{data:y,start:v,end:L}=r;if(null!=y&&null!=this.data){const U=this.data,W=v*this.texelSize;for(let k=0;k<y.length;k++)r.layout&1<<k%this.texelSize&&(U[W+k]=y[k])}this.dirtyStart=Math.min(this.dirtyStart,v),this.dirtyEnd=Math.max(this.dirtyEnd,L)}resize(r,y){const v=this.size;if(this.size=y,this.textureOnly)return void(v!==this.size&&(this._lastTexture=this._texture,this._texture=null));const L=(0,f.UK)(this.pixelType);this.destroy(),this.data=new L(r.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(r){const y=new g.x(r,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const v=this._lastTexture.descriptor.width,L=this._lastTexture.descriptor.height,U=this._lastTexture.descriptor.dataType,W=this._lastTexture.descriptor.pixelFormat,k=this.getFBO(r),J=(0,f.Yw)(U),H=new((0,f.UK)(U))(new ArrayBuffer(v*L*J*this.texelSize)),G=r.getBoundFramebufferObject(),{x:$,y:re,width:se,height:ae}=r.getViewport();r.bindFramebuffer(k),k.readPixels(0,0,v,L,W,U,H),y.updateData(0,0,0,2*v,L/2,H),r.setViewport($,re,se,ae),r.bindFramebuffer(G)}return this.destroy(),this._texture=y,this._texture}}class R{constructor(r){this._onUpdate=r,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(r){const{blocks:y,shared:v,size:L}=r;if(this.shared=v,this.size=L,T("Initializing AttributeStoreView",r),null==this._data)this._data=y.map(U=>null!=U?new b(U,L,v):null);else for(let U=0;U<this._data.length;U++){const W=this._data[U],k=y[U];null!=k&&(null==W?this._data[U]=new b(k,L,v):W.resize(k,L))}this._initialized=!0}destroy(){for(const r of this._data??[])r?.destroy();this._defaultTexture?.dispose()}isEmpty(){return null==this._data}isUpdating(){const r=null!=this._pendingAttributeUpdate,y=r;return(0,F.Z)("esri-2d-log-updating")&&console.log(`Updating AttributeStoreView ${y}\n  -> hasPendingUpdate ${r}`),y}getBlock(r){return null==this._data?null:this._data[r]}setLabelMinZoom(r,y){this.setData(r,0,1,y)}getLabelMinZoom(r){return this.getData(r,0,1,255)}getFilterFlags(r){return this.getData(r,0,0,0)}getVVSize(r){return this.getData(r,p.mb,0,0)}getData(r,y,v,L){if(!this._data)return 0;const U=this._data[y];return null==U?0:U.getData(r,v)??L}setData(r,y,v,L){this._data[y].setData(r,v,L)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}requestUpdate(r){var y=this;return(0,A.Z)(function*(){if(y._pendingAttributeUpdate)return void I.error(new z.Z("mapview-webgl","Tried to update attribute data with a pending update"));const v=(0,_.hh)();return T("AttributeStoreView Update Requested",r),y._pendingAttributeUpdate={data:r,resolver:v},y._onUpdate(),v.promise})()}update(){if(this._initialized&&null!=this._pendingAttributeUpdate){(0,F.Z)("esri-2d-update-debug")&&console.debug("AttributeStoreView::update");const{data:r,resolver:y}=this._pendingAttributeUpdate,v=this._data;for(let L=0;L<r.blocks.length;L++){const U=r.blocks[L],W=v[L];null!=W&&null!=U&&(T(`Updating block ${L}`,U),W.update(U))}this._pendingAttributeUpdate=null,y(),this._onUpdate()}}bindTextures(r,y=!0){const v=this._getDefaultTexture(r);if(!this._initialized)return r.bindTexture(v,p.XO),void(y&&(r.bindTexture(v,p.jS),r.bindTexture(v,p.tg),r.bindTexture(v,p.$y),r.bindTexture(v,p.Im),r.bindTexture(v,p.o2),r.bindTexture(v,p.pb)));const L=this._data;if(!this._locked||this._forceNextUpload){for(const U of L)U?.updateTexture(r,()=>this._onUpdate());this._forceNextUpload=!1}r.bindTexture(L[p.j9]?.getTexture(r)??v,p.XO),y&&(r.bindTexture(L[p.U8]?.getTexture(r)??v,p.pb),r.bindTexture(L[p.S]?.getTexture(r)??v,p.jS),r.bindTexture(L[p.mb]?.getTexture(r)??v,p.tg),r.bindTexture(L[p.Fn]?.getTexture(r)??v,p.$y),r.bindTexture(L[p.Im]?.getTexture(r)??v,p.Im),r.bindTexture(L[p.o2]?.getTexture(r)??v,p.o2))}_getDefaultTexture(r){if(null==this._defaultTexture){const y=new D.X;y.wrapMode=C.e8.CLAMP_TO_EDGE,y.samplingMode=C.cw.NEAREST,y.width=1,y.height=1,this._defaultTexture=new g.x(r,y,new Uint8Array(4))}return this._defaultTexture}}},35935:(Y,j,x)=>{x.d(j,{Ht:()=>A,KS:()=>E,QC:()=>p,QS:()=>B,jL:()=>f,mi:()=>_,nE:()=>C,vs:()=>u});const A=8388607,z=8388608,_=0,p=1,u=g=>(g&z)>>>23,f=g=>g&A,E=g=>u(g)===p?254:255;function C(g){return u(g)===p}function B(g,D){return((D?z:0)|g)>>>0}},47543:(Y,j,x)=>{x.d(j,{I:()=>z,S:()=>F});var A=x(28798);class z{constructor(_,p,u,f,E){this.target=_,this.geometryType=p,this.materialKey=u,this.indexFrom=f,this.indexCount=E}get indexEnd(){return this.indexFrom+this.indexCount}extend(_){this.indexCount+=_}}class F{constructor(_,p){this.geometryType=0,this._target=_,this.geometryType=p}static from(_,p,u,f){const E=new F(_,p);if(null!=f)for(const C of f)u.seekIndex(C),E.addRecord(u);else for(;u.next();)E.addRecord(u);return E}addRecord(_){const f=_.materialKey;let E=_.indexFrom,C=_.indexCount;if(C||(E=_.vertexFrom,C=_.vertexCount),null==this._head){const T=new z(this._target,this.geometryType,f,E,C);return void(this._head=new A.a(T))}let D=null,I=this._head;for(;I;){if(E<I.data.indexFrom)return this._insert(f,E,C,D,I);D=I,I=I.next}this._insert(f,E,C,D,null)}forEach(_){null!=this._head&&this._head.forEach(_)}*infos(){if(null!=this._head)for(const _ of this._head.values())yield _}_insert(_,p,u,f,E){if(null==f&&null==E){const C=new z(this._target,this.geometryType,_,p,u);this._head=new A.a(C)}return null==f&&null!=E?this._insertAtHead(_,p,u,E):null!=f&&null==E?this._insertAtEnd(_,p,u,f):null!=f&&null!=E?this._insertAtMiddle(_,p,u,f,E):void 0}_insertAtHead(_,p,u,f){if(_===f.data.materialKey&&p+u===f.data.indexFrom)f.data.indexFrom=p,f.data.indexCount+=u;else{const C=new z(this._target,this.geometryType,_,p,u);this._head=new A.a(C),this._head.next=f}}_insertAtEnd(_,p,u,f){if(f.data.materialKey===_&&f.data.indexEnd===p)f.data.indexCount+=u;else{const E=new z(this._target,this.geometryType,_,p,u),C=new A.a(E);f.next=C}}_insertAtMiddle(_,p,u,f,E){const C=p+u;if(f.data.materialKey===_&&f.data.indexEnd===p)f.data.indexCount+=u,f.data.materialKey===E.data.materialKey&&f.data.indexEnd===E.data.indexFrom&&(f.data.indexCount+=E.data.indexCount,f.next=E.next);else if(_===E.data.materialKey&&C===E.data.indexFrom)E.data.indexFrom=p,E.data.indexCount+=u;else{const B=new z(this._target,this.geometryType,_,p,u),g=new A.a(B);f.next=g,g.next=E}}}},13305:(Y,j,x)=>{x.d(j,{I:()=>M});var A=x(51006),z=x(64456),F=x(54529);class M extends z.s{constructor(p,u,f,E,C,B,g=C,D=B){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new F.Z(p),this.resolution=u,this.x=f,this.y=E,this.width=C,this.height=B,this.rangeX=g,this.rangeY=D}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(p){const u=this.resolution/(p.resolution*p.pixelRatio),f=this.transforms.tileMat3,[E,C]=p.toScreenNoRotation([0,0],[this.x,this.y]);(0,A.s)(f,this.width/this.rangeX*u,0,0,0,this.height/this.rangeY*u,0,E,C,1),(0,A.m)(this.transforms.dvs,p.displayViewMat3,f)}}},43011:(Y,j,x)=>{x.d(j,{o:()=>f});var A=x(86662),z=x(89921),F=x(51006),M=x(71602),_=x(99657),p=x(13305);class f extends p.I{constructor(C,B,g,D){super(C,B,g,D,_.i9,_.i9)}destroy(){super.destroy(),this._transforms&&f.TransformCache.release(this.key.hash)}setTransform(C){const B=this.resolution/C.resolution,g=this.transforms.tileMat3,[D,I]=C.toScreenNoRotation([0,0],[this.x,this.y]),T=this.width/this.rangeX*B,b=this.height/this.rangeY*B;(0,F.s)(g,T,0,0,0,b,0,D,I,1),(0,F.m)(this.transforms.dvs,C.displayViewMat3,g);const R=this.transforms.labelMat2d,P=window.devicePixelRatio,r=(0,A.d)((0,z.c)(),T*P,0,0,b*P,D*P,I*P);(0,A.m)(R,C.viewMat2d,r)}_createTransforms(){return f.TransformCache.acquire(this.key.hash)}}f.TransformCache=new class u{acquire(C){return{refCount:1,version:-1,labelMat2d:(0,z.c)(),tileMat3:(0,M.c)(),dvs:(0,M.c)()}}release(C){}}},49748:(Y,j,x)=>{x.d(j,{$:()=>M});var A=x(99657),z=x(47543);const F=2147483647;class M{constructor(u){this._head=u,this._cursor=u}static from(u,f=0,E=u.byteLength/_.BYTES_PER_RECORD-f){const C=new _(new Int32Array(u,f*_.BYTES_PER_RECORD,E*_.ELEMENTS_PER_RECORD));return new M(C)}size(){let u=this._cursor,f=0;for(;u;)f+=u.size(),u=u._link;return f}get id(){return this._cursor.id}set id(u){this._cursor.id=u}get materialKey(){return this._cursor.materialKey}set materialKey(u){this._cursor.materialKey=u}get insertAfter(){return this._cursor.insertAfter}get indexFrom(){return this._cursor.indexFrom}set indexFrom(u){this._cursor.indexFrom=u}get indexCount(){return this._cursor.indexCount}set indexCount(u){this._cursor.indexCount=u}get vertexFrom(){return this._cursor.vertexFrom}set vertexFrom(u){this._cursor.vertexFrom=u}get vertexCount(){return this._cursor.vertexCount}set vertexCount(u){this._cursor.vertexCount=u}get sortKey(){return this._cursor.sortKey}set sortKey(u){this._cursor.sortKey=u}get index(){return this._cursor._indexStart+this._cursor._index}seekIndex(u){let f=u;for(this._cursor=this._head;this._cursor;){const E=this._cursor.size();if(f<E)return this._cursor._index=f,!0;f-=E,this._cursor=this._cursor._link}return!1}forEach(u){const f=this.getCursor();for(;f.next();)u(f)}link(u){if(!this._head)return void(this._head=u._head);let f=this._head;for(;f._link;)f=f._link;f._link=u._head,f._link._indexStart=f._indexStart+f.size()}getCursor(){return this.copy()}getDrawInfo(u,f){return new z.I(u,f,this.materialKey,this.indexFrom,this.indexCount)}lookup(u){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(u);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}copy(){const u=new M(this._head?.copy());if(!u._head)return u;let f=u._head,E=u._head._link;for(;E;)f._link=E.copy(),f=E,E=f._link;return u}next(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}peekId(){return this._cursor.peekId()??this._cursor._link.peekId()}delete(u){let f=this._head,E=null;for(;f;){if(f.delete(u))return f.isEmpty()&&(null!=E&&(E._link=f._link),f===this._head&&(this._head=f._link),f===this._cursor&&(this._cursor=f._link)),!0;E=f,f=f._link}return!1}}M.ELEMENTS_PER_RECORD=A.T3,M.BYTES_PER_RECORD=M.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;class _{constructor(u){this._link=null,this._index=-1,this._indexStart=0,this._packedRecordsF32=null,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=u}static from(u,f=0,E=u.byteLength/this.BYTES_PER_RECORD-f){return new _(new Int32Array(u,f*this.BYTES_PER_RECORD,E*this.ELEMENTS_PER_RECORD))}delete(u){const f=this._index,E=this.lookup(u);if(E)for(this.id=F,++this._deletedCount;this.next()&&this.id===u;)this.id=F,++this._deletedCount;return this._index=f,E}isEmpty(){return this._deletedCount===this.size()}link(u){this._link?this._link.link(u):this._link=u}lookup(u){if(null==this._offsets.instance){this._offsets.instance=new Map;const E=this.copy();E._index=-1;let C=0;for(;E.next();)E.id!==C&&(this._offsets.instance.set(E.id,E._index),C=E.id)}if(!this._offsets.instance.has(u))return!1;const f=this._index;return this._index=this._offsets.instance.get(u),this.id!==F||(this._index=f,!1)}get id(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD]}set id(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD]=u}get materialKey(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+1]}set materialKey(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+1]=u}get insertAfter(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+2]}get indexFrom(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+3]}set indexFrom(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+3]=u}get indexCount(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+4]}set indexCount(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+4]=u}get vertexFrom(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+5]}set vertexFrom(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+5]=u}get vertexCount(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+6]}set vertexCount(u){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+6]=u}get sortKey(){return this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*_.ELEMENTS_PER_RECORD+7]}set sortKey(u){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*_.ELEMENTS_PER_RECORD+7]=u}get index(){return this._index}size(){return this._packedRecords.length/_.ELEMENTS_PER_RECORD}next(){for(;++this._index<this.size()&&this.id===F;);return this._index<this.size()}peekId(){const u=(this._index+1)*_.ELEMENTS_PER_RECORD;return u>=this._packedRecords.length?0:this._packedRecords[u]}getCursor(){return this.copy()}copy(){const u=new _(this._packedRecords);return u._indexStart=this._indexStart,u._link=this._link,u._index=this._index,u._offsets=this._offsets,u._deletedCount=this._deletedCount,u}}_.ELEMENTS_PER_RECORD=A.T3,_.BYTES_PER_RECORD=_.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},28798:(Y,j,x)=>{x.d(j,{a:()=>A,m:()=>z});class A{constructor(M){if(this.next=null,!Array.isArray(M))return void(this.data=M);this.data=M[0];let _=this;for(let p=1;p<M.length;p++)_.next=new A([M[p]]),_=_.next}*values(){let M=this;for(;M;)yield M.data,M=M.next}forEach(M){let _=this;for(;_;)M(_.data),_=_.next}find(M){return M(this.data)?this:this.next?.find(M)}max(M,_=this){const p=M(this.data)>M(_.data)?this:_;return this.next?this.next.max(M,p):p}remove(M,_=null){return this===M?_?(_.next=this.next,_):this.next:this.next?.remove(M,this)??null}get last(){return this.next?this.next.last:this}}class z{constructor(M){this._head=null,null!=M&&(this._head=new A(M))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;const M=this._head.max(_=>_.end-_.start);return M.data.end-M.data.start}firstFit(M){if(null==this._head)return null;let _=null,p=this._head;for(;p;){const u=p.data.end-p.data.start;if(u===M)return _?_.next=p.next:this._head=p.next,p.data.start;if(u>M){const f=p.data.start;return p.data.start+=M,f}_=p,p=p.next}return null}free(M,_){const p=M+_;if(null==this._head){const C=new A({start:M,end:p});return void(this._head=C)}if(p<=this._head.data.start){if(p===this._head.data.start)return void(this._head.data.start-=_);const C=new A({start:M,end:p});return C.next=this._head,void(this._head=C)}let u=this._head,f=u.next;for(;f;){if(f.data.start>=p){if(u.data.end===M)return u.data.end+=_,u.data.end===f.data.start?(u.data.end+=f.data.end-f.data.start,void(u.next=f.next)):void 0;if(f.data.start===p)return void(f.data.start-=_);const C=new A({start:M,end:p});return C.next=u.next,void(u.next=C)}u=f,f=f.next}if(M===u.data.end)return void(u.data.end+=_);const E=new A({start:M,end:p});u.next=E}}},84829:(Y,j,x)=>{x.d(j,{P:()=>z,g:()=>A});const A=(F,M)=>F&&((..._)=>M.warn("DEBUG:",..._))||(()=>null),z=!1},84677:(Y,j,x)=>{x.d(j,{a:()=>_});var A=x(57964),z=x(4703),F=x(43101),M=x(32196);function _(p){return(0,M.hj)(p.minDataValue)&&(0,M.hj)(p.maxDataValue)&&null!=p.minSize&&null!=p.maxSize?F.X.SIZE_MINMAX_VALUE:(p.expression&&"view.scale"===p.expression||p.valueExpression&&"$view.scale"===p.valueExpression)&&Array.isArray(p.stops)?F.X.SIZE_SCALE_STOPS:(null!=p.field||p.expression&&"view.scale"!==p.expression||p.valueExpression&&"$view.scale"!==p.valueExpression)&&(Array.isArray(p.stops)||"levels"in p&&p.levels)?F.X.SIZE_FIELD_STOPS:(null!=p.field||p.expression&&"view.scale"!==p.expression||p.valueExpression&&"$view.scale"!==p.valueExpression)&&null!=p.valueUnit?F.X.SIZE_UNIT_VALUE:(z.Z.getLogger("esri.views.2d.engine.webgl").error(new A.Z("mapview-bad-type","Found invalid size VisualVariable",p)),F.X.NONE)}},58065:(Y,j,x)=>{x.r(j),x.d(j,{createSymbolSchema:()=>p});var A=x(84176),z=x(43101),F=x(10827);function M(g){return"line-marker"===g.type?{type:"line-marker",color:g.color?.toJSON(),placement:g.placement,style:g.style}:g.constructor.fromJSON(g.toJSON()).toJSON()}function _(g){return(0,F.hF)(g)}function p(g,D,I=!1){if(!g)return null;switch(g.type){case"simple-fill":case"picture-fill":return function f(g,D,I){const T=(0,F.jj)(z.LW.FILL,D),b=I?_(T):T,R=g.clone(),P=R.outline,r=(0,F.jy)(D.symbologyType);r||(R.outline=null);const y={materialKey:b,hash:R.hash(),...M(R)};if(r)return y;const v=[];if(v.push(y),P){const L=(0,F.jj)(z.LW.LINE,{...D,isOutline:!0}),U={materialKey:I?_(L):L,hash:P.hash(),...M(P)};v.push(U)}return{type:"composite-symbol",layers:v,hash:v.reduce((L,U)=>U.hash+L,"")}}(g,D,I);case"simple-marker":case"picture-marker":return function C(g,D,I){if("simple-marker"===g.type&&("path"===g.style||g.outline&&"solid"!==g.outline.style&&"none"!==g.outline.style))return p({type:"CIMSymbolReference",symbol:A.B$.fromSimpleMarker(g)},D,I);const T=(0,F.jj)(z.LW.MARKER,D),b=I?_(T):T,R=M(g);return{materialKey:b,hash:g.hash(),...R,angle:g.angle,maxVVSize:D.maxVVSize}}(g,D,I);case"simple-line":return function E(g,D,I){const T=(0,F.jy)(D.symbologyType)?z.mD.DEFAULT:D.symbologyType,b=(0,F.jj)(z.LW.LINE,{...D,symbologyType:T}),R=I?_(b):b,P=g.clone(),r=P.marker;P.marker=null;const y=[];if(y.push({materialKey:R,hash:P.hash(),...M(P)}),r){const v=(0,F.jj)(z.LW.MARKER,D),L=I?_(v):v;r.color=r.color??P.color,y.push({materialKey:L,hash:r.hash(),lineWidth:P.width,...M(r)})}return{type:"composite-symbol",layers:y,hash:y.reduce((v,L)=>L.hash+v,"")}}(g,D,I);case"text":return function B(g,D,I){const T=(0,F.jj)(z.LW.TEXT,D),b=I?_(T):T,R=M(g);return{materialKey:b,hash:g.hash(),...R,angle:g.angle,maxVVSize:D.maxVVSize}}(g,D,I);case"label":return function u(g,D,I){const T=g.toJSON(),b=(0,F.jj)(z.LW.LABEL,{...D,placement:T.labelPlacement});return{materialKey:I?_(b):b,hash:g.hash(),...T,labelPlacement:T.labelPlacement}}(g,D,I);case"cim":return{type:"cim",rendererKey:D.vvFlags,data:g.data,maxVVSize:D.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:D.vvFlags,data:g,maxVVSize:D.maxVVSize};case"web-style":return{...M(g),type:"web-style",hash:g.hash(),rendererKey:D.vvFlags,maxVVSize:D.maxVVSize};default:throw new Error(`symbol not supported ${g.type}`)}}},1667:(Y,j,x)=>{x.d(j,{MD:()=>me,Ew:()=>Ue,q5:()=>ye});var A=x(57678),z=x(57964),F=x(14007),M=x(4703),_=x(55768),p=x(38955),u=x(657),f=x(75421),E=x(43101),C=x(32196),B=x(86171),g=x(84677);function D(i){if(!i)return E.X.NONE;let h=0;for(const d of i)if("size"===d.type){const c=(0,g.a)(d);h|=c,"outline"===d.target&&(h|=c<<4)}else"color"===d.type?h|=E.X.COLOR:"opacity"===d.type?h|=E.X.OPACITY:"rotation"===d.type&&(h|=E.X.ROTATION);return h}var I=x(58065),b=(x(84176),x(43818));x(99657);function X(i,h){return Math.max(i,h)}x(43501),x(4959),new b.Z(0,0,24,24);var he=x(29024),Re=x(7351),De=x(57108);const ue=M.Z.getLogger("esri.views.2d.layers.features.schemaUtils"),q="ValidationError";function ye(i,h){let d=0,c=0,S=E.mD.DEFAULT;if(null!=i){if(c=function L(i,h){if(!("visualVariables"in i)||!i.hasVisualVariables("size"))return 0;const d=i.getVisualVariablesForType("size");if(!d[0])return 0;const c=d[0];if(h&&"cluster_count"===c.field&&"cluster"===h.type)return h.clusterMaxSize;if("outline"===c.target)return 0;if("stops"===c.transformationType)return c.stops.map(S=>S.size).reduce(X,0);if("clamped-linear"===c.transformationType){let S=-1/0,O=-1/0;return S="number"==typeof c.maxSize?c.maxSize:c.maxSize.stops.map(w=>w.size).reduce(X,0),O="number"==typeof c.minSize?c.minSize:c.minSize.stops.map(w=>w.size).reduce(X,0),Math.max(S,O)}return"real-world-size"===c.transformationType?30:void 0}(i,h),"visualVariables"in i&&(d=D(i.visualVariables||[]),"dot-density"===i.type&&(S=E.mD.DOT_DENSITY)),"heatmap"===i.type&&(S=E.mD.HEATMAP),"dictionary"===i.type)return{maxVVSize:c,vvFlags:d,symbologyType:E.mD.DEFAULT};if("pie-chart"===i.type)return{maxVVSize:c,vvFlags:d,symbologyType:E.mD.PIE_CHART};if(S!==E.mD.DOT_DENSITY&&S!==E.mD.HEATMAP){const O=i.getSymbols();"backgroundFillSymbol"in i&&i.backgroundFillSymbol&&O.push(i.backgroundFillSymbol);let w=!0,K=!0;for(const V of O)if("cim"!==V.type&&"web-style"!==V.type||(K=!1),"simple-fill"===V.type||"picture-fill"===V.type){const N=V.outline,Z=N&&"none"!==N.style&&"solid"!==N.style;Z&&(w=!1),("picture-fill"===V.type||"simple-fill"===V.type&&"none"!==V.style&&"solid"!==V.style||Z)&&(K=!1)}w?S=K?E.mD.OUTLINE_FILL_SIMPLE:E.mD.OUTLINE_FILL:K&&(S=E.mD.SIMPLE)}}return{vvFlags:d,maxVVSize:c,symbologyType:S}}let Oe=null;function Ue(i){if((0,F.Z)("esri-2d-update-debug")){const h=Pe(i,!0);console.debug("Created new schema",h),console.debug("Schema diff",(0,u.Hg)(Oe,h)),Oe=h}return Pe(i)}function Pe(i,h=!1){try{const d=function je(i,h=!1){const d=new Array;return d.push(function Ne(i,h,d=!1){const c={indexCount:0,fields:{}},S="featureReduction"in i?i.featureReduction??void 0:void 0,O=S?"aggregate":"feature";if("sublayers"in i){const le={type:"subtype",subtypeField:i.subtypeField,renderers:{},symbologyType:E.mD.DEFAULT},ge={type:"subtype",mapping:{},target:"feature",subtypeField:i.subtypeField},xe={type:"subtype",classes:{}},it={type:"symbol",target:"feature",aggregateFields:[],attributes:c,storage:ge,mesh:{matcher:le,aggregateMatcher:null,labels:xe,sortKey:null}},we=new Set;let nt=0;for(const{renderer:ce,subtypeCode:fe,labelingInfo:rt,labelsVisible:at}of i.sublayers){let ze=0;"visualVariables"in ce&&ce.visualVariables&&(ce.visualVariables.some(_e=>"rotation"!==_e.type)&&ue.warnOnce("SubtypeGroupLayer currently only supports rotation visualVariables. All other visualVariable types will be ignored."),ze=D(ce.visualVariables.filter(_e=>"size"!==_e.type)));const Fe={symbologyType:E.mD.DEFAULT,vvFlags:ze,maxVVSize:0},pe=me(c,O,ce,Fe,d),Ee=Ie(c,O,ce),Ae=at&&rt;if("dictionary"===pe.type)throw new z.Z(q,"Dictionary renderer is not supported in subtype layers");if("subtype"===pe.type)throw new z.Z(q,"Nested subtype renderers is not supported");if(null!=Ee&&"subtype"===Ee.type)throw new z.Z(q,"Nested subtype storage is not supported");if(null!=Ee?.attributeMapping)throw new z.Z(q,"Non-visual-variable attributes are not supported in subtype layers");if("heatmap"===pe.type)throw new z.Z(q,"Heatmaps are not supported in subtype layers");if("pie-chart"===pe.type)throw new z.Z(q,"Pie-charts are not supported in subtype layers");if(we.has(fe))throw new z.Z(q,"Subtype codes for sublayers must be unique");we.add(fe),le.renderers[fe]=pe,ge.mapping[fe]=Ee,Ae&&(xe.classes[fe]=Ae.map(_e=>Se(c,_e,"feature",nt++,Fe,d)))}return it}if("heatmap"===i.renderer?.type&&"raster"===(0,he.rk)()){const{radius:le,fieldOffset:ge,field:xe}=i.renderer;return{type:"heatmap",aggregateFields:[],attributes:c,target:O,storage:null,mesh:{radius:le,fieldOffset:ge,field:ne(c,{target:O,field:xe,resultType:"numeric"}).field}}}const w=function ke(i,h,d){const c="featureReduction"in h&&h.featureReduction;if(!c)return{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};const O=[];let w=null,K=(0,De.oq)(h.geometryType),V=[],N=null;if(c)switch(c.type){case"selection":return ue.error(new z.Z(q,"Mapview does not support `selection` reduction type",c)),{fields:[],labels:[],matcher:void 0,rendererOverride:void 0};case"cluster":case"binning":if(O.push(...c.fields??[]),"cluster"===c.type?K="esriGeometryPoint":"binning"===c.type&&(K="esriGeometryPolygon"),c.renderer&&!c.renderer.authoringInfo?.isAutoGenerated){if("cluster"===c.type){const{renderer:te}=(0,Re.st)(c.renderer,c,null);N=te}else N=c.renderer;const Z=ye(c.renderer,c);w=me(i,"aggregate",c.renderer,Z,d),V=c&&c.labelsVisible&&c.labelingInfo||[]}else if("cluster"===c.type){if(N=(0,Re.S1)(O,h.renderer,c,null,!0),c.symbol){const Z=ye(N,c);w={type:"simple",symbol:(0,I.createSymbolSchema)(c.symbol,Z,d),symbologyType:Z.symbologyType}}V=c&&c.labelsVisible&&c.labelingInfo||[]}}return function He(i,h){const d={mesh:!0,storage:!0};for(const c of h){const{name:S,onStatisticField:O,onStatisticExpression:w,statisticType:K}=c;let V,N;const te="feature";w?N=de(i,{type:"expression",target:te,valueExpression:w.expression,resultType:"numeric"}).fieldIndex:V=de(i,{type:"field",target:te,field:O}).field,de(i,{type:"statistic",target:"aggregate",name:S,context:d,inField:V,inFieldIndex:N,statisticType:K})}}(i,O),{labels:(0,f.a)(V,"binning"===c.type?"esriGeometryPolygon":K),matcher:w,fields:O,rendererOverride:N}}(c,i,d),K=(0,De.oq)(i.geometryType),V=w.rendererOverride??i.renderer,N=ye(V,S),Z=me(c,O,V,N,d),te=Ie(c,O,V),oe=function Ze(i,h,d,c){if(null!=c)return null;if(null!=h&&h.length){h.length>1&&ue.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${h.length}. All but the first will be discarded`);const S=h[0],O="ascending"===S.order?"asc":"desc";return S.field?{field:S.field,order:O}:S.valueExpression?{fieldIndex:de(i,{type:"expression",target:"feature",valueExpression:S.valueExpression,resultType:"numeric"}).fieldIndex,order:O}:(ue.error(new z.Z(q,"Expected to find a field or valueExpression for OrderByInfo",S)),null)}return null!=d&&"unique-value"===d.type&&d.orderByClassesEnabled?{byRenderer:!0,order:"asc"}:null}(c,i.orderBy,i.renderer,S),tt=(0,f.a)(i.labelsVisible&&i.labelingInfo||[],K);let Le=0;const st=[...tt.map(le=>Se(c,le,"feature",Le++,N,d)),...w.labels.map(le=>Se(c,le,"aggregate",Le++,N,d))];return{type:"symbol",target:O,attributes:c,aggregateFields:w.fields,storage:te,mesh:{matcher:Z,labels:{type:"simple",classes:st},aggregateMatcher:w.matcher,sortKey:oe}}}(i,0,h)),d}(i,h),c=function We(i){return"heatmap"===i.renderer?.type&&"raster"===(0,he.rk)()?{type:"heatmap"}:{type:"symbol"}}(i),S={};return d.map(K=>function Ve(i,h,d){switch(d.target){case"feature":return void Te(i,ve(h),d);case"aggregate":{if(!("featureReduction"in h))return;const c=h.featureReduction;switch(c?.type){case"selection":throw new z.Z(q,"Mapview does not support `selection` reduction type",c);case"binning":return Te(i,ve(h),d),void function Ke(i,h,d,c){i.aggregate||(i.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:h.fixedBinLevel,fields:(h.fields??[]).map(S=>({...S.toJSON(),type:Ce(S,d)}))},attributes:{}}),be(i.aggregate,c.attributes.fields)}(i,c,h.fields.map(S=>S.toJSON()),d);case"cluster":return Te(i,ve(h),d),void function Be(i,h,d,c){const S=c.aggregateFields??[],O=new Set;for(const w of S)O.add(w.name);for(const w of h?.fields??[])O.has(w.name)||S.push(w);i.aggregate||(i.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:(0,_.F2)(h.clusterRadius/2),clusterPixelBuffer:64*Math.ceil((0,_.F2)(h.clusterMaxSize)/64),fields:S.map(w=>({...w.toJSON(),type:Ce(w,d)}))}}),be(i.aggregate,c.attributes.fields)}(i,c,h.fields.map(S=>S.toJSON()),d)}}}}(S,i,K)),{source:{definitionExpression:(0,p._)(i.definitionExpression,null!=i.subtypeCode?`${i.subtypeField} = ${i.subtypeCode}`:null),fields:i.fields.map(K=>K.toJSON()),gdbVersion:i.gdbVersion,historicMoment:i.historicMoment?.getTime(),outFields:i.availableFields,pixelBuffer:i.pixelBuffer,spatialReference:i.spatialReference.toJSON(),timeExtent:i.timeExtent?.toJSON(),customParameters:i.customParameters},attributes:{fields:{},indexCount:0},processors:d,tileRenderer:c,targets:S}}catch(d){if(d.fieldName===q)return ue.error(d),null;throw d}}function be(i,h){for(const d in h){const c=h[d];if(c.target!==i.name)continue;const S=i.attributes[d];if(S?.context){const O=S.context;O.mesh=O.mesh||c.context?.mesh,O.storage=O.storage||c.context?.storage}else i.attributes[d]=c}return i}function ve(i){return[i.filter?.toJSON()??null,i.featureEffect?.filter?.toJSON()??null]}function Te(i,h,d){return i.feature||(i.feature={name:"feature",input:"source",filters:h,attributes:{}}),be(i.feature,d.attributes.fields),i}function Ce(i,h){const{onStatisticExpression:d,onStatisticField:c,statisticType:S}=i;switch(S){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(d){const{returnType:w}=d;return w?"string"===w?"esriFieldTypeString":"esriFieldTypeDouble":(ue.error(new z.Z(q,"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",i)),"esriFieldTypeString")}const O=h.find(w=>w.name===c);return O?O.type:(ue.error(new z.Z(q,"Unable to infer type of aggregateField with onStatisticExpression. ReturnType is not defined",i)),"esriFieldTypeString")}}}function ne(i,h){return h.field?de(i,{...h,type:"field",field:h.field}):h.valueExpression?de(i,{...h,type:"expression",valueExpression:h.valueExpression}):{field:void 0,fieldIndex:void 0}}function de(i,h){switch(h.type){case"expression":{const d=h.valueExpression;if(!i.fields[d]){const c=i.indexCount++;i.fields[d]={...h,name:d,fieldIndex:c}}return{fieldIndex:i.fields[d].fieldIndex}}case"label-expression":{const d=JSON.stringify(h.label);if(!i.fields[d]){const c=i.indexCount++;i.fields[d]={...h,name:d,fieldIndex:c}}return{fieldIndex:i.fields[d].fieldIndex}}case"field":{const d=h.field;return"aggregate"===h.target&&i.fields[d]||(i.fields[d]={...h,name:d}),{field:d}}case"statistic":return i.fields[h.name]={...h},{field:h.name}}}function Se(i,h,d,c,S,O=!1){const w=de(i,{type:"label-expression",target:d,context:{mesh:!0},resultType:"string",label:{labelExpression:h.labelExpression,labelExpressionInfo:h.labelExpressionInfo?{expression:h.labelExpressionInfo.expression}:null,symbol:!!h.symbol,where:h.where}}),{fieldIndex:K}=w;return{...(0,I.createSymbolSchema)(h,S,O),fieldIndex:K,target:d,index:c}}function Ie(i,h,d){let c;switch(d.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":c={visualVariables:!0,attributes:null};break;default:c=(0,B.EJ)(d).getStorageSpec(d)}return function Xe(i,h,d,c){if(null==d)return null;const{visualVariables:S,attributes:O}=d;let w=null;S&&"visualVariables"in c&&(w=function Ge(i,h,d){if(!d?.length)return[];const c={storage:!0},S="numeric";return(0,he.tv)(d).map(O=>{const w=(0,C.nU)(O.type),{field:K,fieldIndex:V}=ne(i,{target:h,valueExpression:O.valueExpression,field:O.field,context:c,resultType:S});switch(O.type){case"size":return"$view.scale"===O.valueExpression?null:{type:"size",binding:w,field:K,fieldIndex:V,normalizationField:ne(i,{target:h,field:O.normalizationField,context:c,resultType:S}).field,valueRepresentation:O.valueRepresentation??null};case"color":return{type:"color",binding:w,field:K,fieldIndex:V,normalizationField:ne(i,{target:h,field:O.normalizationField,context:c,resultType:S}).field};case"opacity":return{type:"opacity",binding:w,field:K,fieldIndex:V,normalizationField:ne(i,{target:h,field:O.normalizationField,context:c,resultType:S}).field};case"rotation":return{type:"rotation",binding:w,field:K,fieldIndex:V}}}).filter(A.pC)}(i,h,c.visualVariables));const K=null!=w?4:0;let V=null;return null!=O&&(V=O.map((N,Z)=>{const{field:te,fieldIndex:oe}=ne(i,{valueExpression:N.valueExpression,field:N.field,resultType:"numeric",target:h});return{binding:Z+K,field:te,fieldIndex:oe}})),{type:"simple",target:h,attributeMapping:V,vvMapping:w}}(i,h,c,d)}function me(i,h,d,c,S=!1){const O=i??{indexCount:0,fields:{}};switch(d.type){case"simple":case"dot-density":return function $e(i,h,d,c=!1){const S=h.getSymbols();return{type:"simple",symbol:(0,I.createSymbolSchema)(S.length?S[0]:null,d,c),symbologyType:d.symbologyType}}(0,d,c,S);case"class-breaks":return function Ye(i,h,d,c,S=!1){const w=d.backgroundFillSymbol,{field:K,fieldIndex:V}=ne(i,{target:h,field:d.field,valueExpression:d.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}}),N=d.normalizationType,Z="log"===N?"esriNormalizeByLog":"percent-of-total"===N?"esriNormalizeByPercentOfTotal":"field"===N?"esriNormalizeByField":null,te=d.classBreakInfos.map(oe=>({symbol:(0,I.createSymbolSchema)(oe.symbol,c,S),min:oe.minValue,max:oe.maxValue})).sort((oe,Me)=>oe.min-Me.min);return{type:"interval",attributes:i.fields,field:K,fieldIndex:V,backgroundFillSymbol:(0,I.createSymbolSchema)(w,c,S),defaultSymbol:(0,I.createSymbolSchema)(d.defaultSymbol,c,S),intervals:te,normalizationField:d.normalizationField,normalizationTotal:d.normalizationTotal,normalizationType:Z,isMaxInclusive:d.isMaxInclusive,symbologyType:c.symbologyType}}(O,h,d,c,S);case"unique-value":return function Qe(i,h,d,c,S=!1){const O=[],w=d.backgroundFillSymbol,K={target:h,context:{mesh:!0},resultType:"string"};if(d.field&&"string"!=typeof d.field)throw new z.Z(q,"Expected renderer.field to be a string",d);const{field:V,fieldIndex:N}=ne(i,{...K,field:d.field,valueExpression:d.valueExpression});for(const Z of d.uniqueValueInfos??[])O.push({value:""+Z.value,symbol:(0,I.createSymbolSchema)(Z.symbol,c,S)});return{type:"map",attributes:i.fields,field:V,fieldIndex:N,field2:ne(i,{...K,field:d.field2}).field,field3:ne(i,{...K,field:d.field3}).field,fieldDelimiter:d.fieldDelimiter??void 0,backgroundFillSymbol:(0,I.createSymbolSchema)(w,c),defaultSymbol:(0,I.createSymbolSchema)(d.defaultSymbol,c),map:O,symbologyType:c.symbologyType}}(O,h,d,c,S);case"dictionary":return function qe(i,h,d,c=!1){return{type:"dictionary",config:h.config,fieldMap:h.fieldMap,scaleExpression:h.scaleExpression,url:h.url,symbolOptions:d,symbologyType:d.symbologyType}}(0,d,c,S);case"heatmap":return function et(i,h,d,c=!1){const S=h.getSymbols();return{type:"heatmap",symbol:(0,I.createSymbolSchema)(S.length?S[0]:null,d,c),symbologyType:d.symbologyType}}(0,d,c,S);case"pie-chart":return function Je(i,h,d,c=!1){const S=h.getSymbols(),w=S.length>1?S[1]:null;return{type:"pie-chart",markerSymbol:(0,I.createSymbolSchema)(S[0],d,c),fillSymbol:(0,I.createSymbolSchema)(w,d,c),symbologyType:d.symbologyType}}(0,d,c,S)}}},29024:(Y,j,x)=>{x.d(j,{TT:()=>P,aR:()=>E,rk:()=>R,tv:()=>C});var A=x(57964),z=x(14007),F=x(4703),M=x(55768),_=x(19903);const p=8,u=p-2,f=F.Z.getLogger("esri.views.2d.layers.features.support.rendererUtils"),E=r=>{if(!("visualVariables"in r)||!r.visualVariables?.length)return r;const y=r.clone(),v=y.visualVariables.map(L=>B(L)?g(L):L);return y.visualVariables=v,y};function C(r){return r.map(y=>B(y)?g(y.clone()):y)}function B(r){return("size"===r.type||"color"===r.type||"opacity"===r.type)&&null!=r.stops}function g(r){return r.stops=function b(r,y){return y.length<=p?y:(f.warn(`Found ${y.length} Visual Variable stops, but MapView only supports ${p}. Displayed stops will be simplified.`),y.length>2*p?function I(r,y){const[v,...L]=y,U=L.pop(),W=L[0].value,k=L[L.length-1].value,J=(k-W)/u,H=[];for(let G=W;G<k;G+=J){let $=0;for(;G>=L[$].value;)$++;const re=L[$],se=y[$-1],ie=re.value===se.value?1:(G-se.value)/(re.value-se.value);if("color"===r){const Q=L[$],ee=y[$-1],X=Q.color.clone();X.r=D(ee.color.r,X.r,ie),X.g=D(ee.color.g,X.g,ie),X.b=D(ee.color.b,X.b,ie),X.a=D(ee.color.a,X.a,ie),H.push({value:G,color:X,label:Q.label})}else if("size"===r){const Q=L[$],ee=y[$-1],X=(0,M.t_)(Q.size),he=D((0,M.t_)(ee.size),X,ie);H.push({value:G,size:he,label:Q.label})}else{const Q=L[$],ee=D(y[$-1].opacity,Q.opacity,ie);H.push({value:G,opacity:ee,label:Q.label})}}return[v,...H,U]}(r,y):function T(r){const[y,...v]=r,L=v.pop();for(;v.length>u;){let U=0,W=0;for(let k=1;k<v.length;k++){const G=Math.abs(v[k].value-v[k-1].value);G>W&&(W=G,U=k)}v.splice(U,1)}return[y,...v,L]}(y))}(r.type,r.stops??[]),r}function D(r,y,v){return(1-v)*r+v*y}function R(){if((0,z.Z)("heatmap-force-raster"))return"raster";const{supportsTextureFloat:r,supportsTextureHalfFloat:y,supportsColorBufferFloat:v,supportsColorBufferFloatBlend:L,supportsColorBufferHalfFloat:U}=(0,_.hc)("2d");return r&&v&&L||y&&U?"symbol":(0,z.Z)("heatmap-allow-raster-fallback")?"raster":"none"}function P(r){if(!r)return!0;switch(r.type){case"dot-density":if(!(0,_.hc)("2d").supportsTextureFloat)return f.error(new A.Z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case"heatmap":{const y=R();if("none"===y||"raster"===y&&!(0,z.Z)("heatmap-force-raster")){const v=(0,_.hc)("2d"),L=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(U=>!v[U]).join(", ");if("none"===y)return f.errorOnce(new A.Z("webgl-missing-extension",`Missing WebGL${v.type} requirements for Heatmap: ${L}`)),!1;"raster"===y&&f.warnOnce(`Missing WebGL${v.type} requirements for accelerated Heatmap: ${L}. Feature support may be limited.`)}break}}return!0}},94286:(Y,j,x)=>{x.d(j,{I:()=>B,qc:()=>p});var A=x(55768),z=x(484),F=x(99657),M=x(43101),_=x(84677);function p(T,b){if(!T||!b)return T;switch(b){case"radius":case"distance":return 2*T;case"diameter":case"width":return T;case"area":return Math.sqrt(T)}return T}function f(T){return(T??[]).map(b=>function u(T){return{value:T.value,size:(0,A.t_)(T.size)}}(b))}function E(T){return"string"==typeof T||"number"==typeof T?(0,A.t_)(T):{type:"size",expression:T.expression,stops:f(T.stops)}}const C=T=>{const b=[],R=[],P=f(T),r=P.length;for(let y=0;y<6;y++){const v=P[Math.min(y,r-1)];b.push(v.value),R.push(null==v.size?F.k9:(0,A.F2)(v.size))}return{values:new Float32Array(b),sizes:new Float32Array(R)}};function B(T){const b=T&&T.length>0?{}:null,R=b?{}:null;if(!b||!R)return{vvFields:b,vvRanges:R};for(const P of T)if(P.field&&(b[P.type]=P.field),"size"===P.type){R.size||(R.size={});const r=P;switch((0,_.a)(r)){case M.X.SIZE_MINMAX_VALUE:R.size.minMaxValue={minDataValue:r.minDataValue,maxDataValue:r.maxDataValue,minSize:E(r.minSize),maxSize:E(r.maxSize)};break;case M.X.SIZE_SCALE_STOPS:R.size.scaleStops={stops:f(r.stops)};break;case M.X.SIZE_FIELD_STOPS:if(r.levels){const y={};for(const v in r.levels)y[v]=C(r.levels[v]);R.size.fieldStops={type:"level-dependent",levels:y}}else R.size.fieldStops={type:"static",...C(r.stops)};break;case M.X.SIZE_UNIT_VALUE:R.size.unitValue={unit:r.valueUnit,valueRepresentation:r.valueRepresentation??void 0}}}else"color"===P.type?R.color=I(P):"opacity"===P.type?R.opacity=g(P):"rotation"===P.type&&(R.rotation={type:P.rotationType});return{vvFields:b,vvRanges:R}}function g(T){const b={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof T.field){if(!T.stops)return null;{if(T.stops.length>8)return null;const R=T.stops;for(let P=0;P<8;++P){const r=R[Math.min(P,R.length-1)];b.values[P]=r.value,b.opacities[P]=r.opacity}}}else{if(!(T.stops&&T.stops.length>=0))return null;{const R=T.stops&&T.stops.length>=0?T.stops[0].opacity:0;for(let P=0;P<8;P++)b.values[P]=1/0,b.opacities[P]=R}}return b}function D(T,b,R){T[4*b]=R.r/255,T[4*b+1]=R.g/255,T[4*b+2]=R.b/255,T[4*b+3]=R.a}function I(T){if(null==T||T.normalizationField)return null;const b={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof T.field){if(!T.stops)return null;{if(T.stops.length>8)return null;b.field=T.field;const R=T.stops;for(let P=0;P<8;++P){const r=R[Math.min(P,R.length-1)];b.values[P]=r.value,D(b.colors,P,r.color)}}}else{if(!(T.stops&&T.stops.length>=0))return null;{const R=T.stops&&T.stops.length>=0&&T.stops[0].color;for(let P=0;P<8;P++)b.values[P]=1/0,D(b.colors,P,R)}}for(let R=0;R<32;R+=4)(0,z.pr)(b.colors,R,!0);return b}},43501:(Y,j,x)=>{x.d(j,{OC:()=>E,XA:()=>T,Zu:()=>C,ab:()=>B,eT:()=>D,i9:()=>f,yA:()=>g}),x(19939);var z=x(5391),F=x(45425),M=x(33721);x(13948),x(99657),x(59161);const f=512,E=50;function C(b,R){const P=(0,M.C5)(R);if(!P)return null;const[r,y]=P.valid;return b[2]>y?[(0,F.Ue)([b[0],b[1],y,b[3]]),(0,F.Ue)([r,b[1],r+b[2]-y,b[3]])]:b[0]<r?[(0,F.Ue)([r,b[1],b[2],b[3]]),(0,F.Ue)([y-(r-b[0]),b[1],y,b[3]])]:null}function B(b){return"text"===b||"esriTS"===b}function g(b){return"simple-marker"===b||"picture-marker"===b||"esriSMS"===b||"esriPMS"===b}function D(b){switch(b.geometry.type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function T(b){if(!b)return null;const{xmin:R,ymin:P,xmax:r,ymax:y,spatialReference:v}=b;return new z.Z({rings:[[[R,P],[R,y],[r,y],[r,P],[R,P]]],spatialReference:v})}},4959:(Y,j,x)=>{x.d(j,{x:()=>B,B:()=>E});var A=x(15861),z=x(90693),F=x(43101),M=x(10827);const _={marker:F.LW.MARKER,fill:F.LW.FILL,line:F.LW.LINE,text:F.LW.TEXT};class p{constructor(D,I,T,b){const R={minScale:I?.minScale,maxScale:I?.maxScale},P=function u(g){return g.minScale||g.maxScale?g.minScale+"-"+g.maxScale:""}(R);this.layers=D,this.data=I,this.hash=this._createHash()+P,this.rendererKey=T;const r={isOutline:!1,placement:null,symbologyType:F.mD.DEFAULT,vvFlags:T};for(const y of D){const v=_[y.type];r.isOutline="line"===y.type&&y.isOutline,y.materialKey=(0,M.jj)(v,r),y.maxVVSize=b,y.scaleInfo=R,y.templateHash+=P}}get type(){return"expanded-cim"}_createHash(){let D="";for(const I of this.layers)D+=I.templateHash;return D}}const f=function(){var g=(0,A.Z)(function*(D,I,T){const b=new z._(T,I);return new p(yield b.analyzeSymbolReference(D.data,!1),D.data,D.rendererKey,D.maxVVSize)});return function(I,T,b){return g.apply(this,arguments)}}();function E(g,D,I,T){return C.apply(this,arguments)}function C(){return(C=(0,A.Z)(function*(g,D,I,T){if(!g)return null;if("cim"===g.type)return f(g,D,I);if("web-style"===g.type){const{fetchCIMSymbolReference:b}=yield x.e(9610).then(x.bind(x,99610)),R={type:"cim",data:(yield b(g,null,T))??void 0,rendererKey:g.rendererKey,maxVVSize:g.maxVVSize};return f(R,D,I)}return g})).apply(this,arguments)}function B(g){if(!g)return null;const{avoidSDFRasterization:D,type:I,cim:T,url:b,materialHash:R,maxVVSize:P}=g,r={cim:T,type:I,mosaicHash:R,url:b,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:D};switch(I){case"marker":P&&"size"in T&&(T.size=Math.max(P,T.size)),r.size=g.size,r.path=g.path,r.animatedSymbolProperties=g.animatedSymbolProperties;break;case"line":r.dashTemplate=g.dashTemplate;break;case"text":r.text=g.text,r.fontName=g.fontName}return r}},57108:(Y,j,x)=>{x.d(j,{JV:()=>_,oq:()=>F});const z=new(x(84303).X)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function F(p){return z.toJSON(p)}function _(p){const{bandCount:u,attributeTable:f,colormap:E,pixelType:C}=p.raster.rasterInfo;return 1===u&&(null!=f||null!=E||"u8"===C||"s8"===C)}}}]);