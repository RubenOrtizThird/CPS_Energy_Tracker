"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[5006],{60084:(v,L,t)=>{t.d(L,{D:()=>h});var a=t(26496);function h(r){r?.writtenProperties&&r.writtenProperties.forEach(({target:s,propName:d,newOrigin:p})=>{(0,a.l)(s)&&p&&s.originOf(d)!==p&&s.updateOrigin(d,p)})}},26496:(v,L,t)=>{function a(h){return h&&"getAtOrigin"in h&&"originOf"in h}t.d(L,{l:()=>a})},69484:(v,L,t)=>{t.r(L),t.d(L,{save:()=>ft,saveAll:()=>yt,saveAllAs:()=>mt,saveAs:()=>dt});var a=t(15861),h=t(57678),r=t(57964),s=t(60084),d=t(85155),p=t(89713),I=t(23933),w=t(85971),k=t(79936),$=t(453),m=t(50318);const O="Feature Service",M="feature-layer-utils",q=`${M}-save`,_=`${M}-save-as`,P=`${M}-saveall`,E=`${M}-saveall-as`;function T(n){return{isValid:(0,w.fP)(n)&&("feature"!==n.type||!n.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function F(n){const e=[],l=[];for(const{layer:i,layerJSON:f}of n)i.isTable?l.push(f):e.push(f);return{layers:e,tables:l}}function z(n){return F([n])}function J(n,e){return S.apply(this,arguments)}function S(){return(S=(0,a.Z)(function*(n,e){return/\/\d+\/?$/.test(n.url)?z(e[0]):V(e,n)})).apply(this,arguments)}function V(n,e){return D.apply(this,arguments)}function D(){return D=(0,a.Z)(function*(n,e){if(!e)return n.reverse(),F(n);const{layer:{url:l,customParameters:i,apiKey:f}}=n[0];let u=yield e.fetchData("json");null!=u?.layers&&null!=u?.tables||(u=yield function tt(n,e,l){return x.apply(this,arguments)}(u,{url:l??"",customParameters:i,apiKey:f},n.map(o=>o.layer.layerId)));for(const o of n)Q(o.layer,o.layerJSON,u);return u}),D.apply(this,arguments)}function x(){return x=(0,a.Z)(function*(n,e,l){n||={},n.layers||=[],n.tables||=[];const{url:i,customParameters:f,apiKey:u}=e,{serviceJSON:o,layersJSON:y}=yield(0,I.V)(i,{customParameters:f,apiKey:u}),c=Y(n.layers,o.layers,l),g=Y(n.tables,o.tables,l);n.layers=c.itemResources,n.tables=g.itemResources;const Z=[...c.added,...g.added],ht=y?[...y.layers,...y.tables]:[];return yield function nt(n,e,l,i){return U.apply(this,arguments)}(n,Z,i,ht),n}),x.apply(this,arguments)}function Y(n,e,l){const i=(0,h.e5)(n,e,(u,o)=>u.id===o.id);n=n.filter(u=>!i.removed.some(o=>o.id===u.id));const f=i.added;return f.forEach(({id:u})=>{n.push({id:u})}),{itemResources:n,added:f.filter(({id:u})=>!l.includes(u))}}function U(){return U=(0,a.Z)(function*(n,e,l,i){const f=yield function rt(n){return C.apply(this,arguments)}(e),u=e.map(({id:o,type:y})=>new(f.get(y))({url:l,layerId:o,sourceJSON:i.find(({id:c})=>c===o)}));yield Promise.allSettled(u.map(o=>o.load())),u.forEach(o=>{const{layerId:y,loaded:c,defaultPopupTemplate:g}=o;if(!c||null==g)return;const Z={id:y,popupInfo:g.toJSON()};"ArcGISFeatureLayer"!==o.operationalLayerType&&(Z.layerType=o.operationalLayerType),Q(o,Z,n)})}),U.apply(this,arguments)}function C(){return(C=(0,a.Z)(function*(n){const e=[];n.forEach(({type:f})=>{const u=function et(n){let e;switch(n){case"Feature Layer":case"Table":e="FeatureLayer";break;case"Oriented Imagery Layer":e="OrientedImageryLayer"}return e}(f);e.push((0,k.T[u])())});const l=yield Promise.all(e),i=new Map;return n.forEach(({type:f},u)=>{i.set(f,l[u])}),i})).apply(this,arguments)}function Q(n,e,l){!function X(n,e){const l=n.findIndex(({id:i})=>i===e.id);-1===l?n.push(e):n[l]=e}(n.isTable?l.tables:l.layers,e)}function H(n,e){if(!n.length)throw new r.Z(`${e}:missing-parameters`,"'layers' array should contain at least one feature layer")}function b(n,e){const l=n.map(i=>i.layerId);if(new Set(l).size!==l.length)throw new r.Z(`${e}:invalid-parameters`,"'layers' array should contain only one instance each of layer or table in a feature service")}function A(){return(A=(0,a.Z)(function*(n){H(n,P),yield Promise.all(n.map(e=>e.load()));for(const e of n)(0,d.DC)(e,P,T),(0,d.Ym)({layer:e,itemType:O,errorNamePrefix:P});(function at(n,e){const l=n.map(i=>i.portalItem.id);if(new Set(l).size>1)throw new r.Z(`${e}:invalid-parameters`,"All layers in the 'layers' array should be loaded from the same portal item")})(n,P),b(n,P)})).apply(this,arguments)}function st(n,e){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)(function*(n,e){const{url:l,layerId:i,title:f,fullExtent:u,isTable:o}=n,y=(0,p.Qc)(l);e.url="FeatureServer"===y?.serverType?l:`${l}/${i}`,e.title||=f,e.extent=null,o||null==u||(e.extent=yield(0,m.$o)(u)),(0,m.ck)(e,m.Kz.METADATA),(0,m.ck)(e,m.Kz.MULTI_LAYER),(0,m.qj)(e,m.Kz.SINGLE_LAYER),o&&(0,m.qj)(e,m.Kz.TABLE)})).apply(this,arguments)}function K(){return(K=(0,a.Z)(function*(n){H(n,E),yield Promise.all(n.map(e=>e.load()));for(const e of n)(0,d.DC)(e,E,T);(function ot(n,e){for(const u of n){const o=u.parsedUrl.path,y=(0,p.Qc)(o);if(!y?.url.path)throw new r.Z(`${e}:invalid-parameters`,(0,d.xG)(u,`has unsupported url pattern: ${o}`),{layer:u});const g=y?.serverType;if("FeatureServer"!==g&&"MapServer"!==g)throw new r.Z(`${e}:invalid-parameters`,(0,d.xG)(u,`has unsupported server type: ${g}`),{layer:u});if("MapServer"===g&&n.length>1)throw new r.Z(`${e}:invalid-parameters`,"Only one layer or table in a map service can be saved")}const l=(0,p.Qc)(n[0].parsedUrl.path),i=l?.url.path;if(!n.every(u=>(0,p.Qc)(u.parsedUrl.path)?.url.path===i))throw new r.Z(`${e}:invalid-parameters`,"'layers' array should only contain layers or tables that belong to the same feature service")})(n,E),b(n,E)})).apply(this,arguments)}function R(){return(R=(0,a.Z)(function*(n,e){let l=0,i=0;for(const{isTable:o}of e)o?i++:l++;const f=e[0].parsedUrl.path,u=(0,p.Qc)(f);if(n.url="FeatureServer"===u?.serverType?u.url.path:f,n.title||=u.title,n.extent=null,l>0){const o=e.map(y=>y.fullExtent).filter(h.pC).reduce((y,c)=>y.clone().union(c));o&&(n.extent=yield(0,m.$o)(o))}(0,m.ck)(n,m.Kz.METADATA),(0,m.Ct)(n,m.Kz.MULTI_LAYER,e.length>1),(0,m.Ct)(n,m.Kz.SINGLE_LAYER,1===e.length),(0,m.Ct)(n,m.Kz.TABLE,i>0&&0===l),(0,d.UY)(n)})).apply(this,arguments)}function ft(n,e){return W.apply(this,arguments)}function W(){return(W=(0,a.Z)(function*(n,e){return(0,d.a1)({layer:n,itemType:O,validateLayer:T,createItemData:(l,i)=>J(i,[l]),errorNamePrefix:q},e)})).apply(this,arguments)}function yt(n,e){return B.apply(this,arguments)}function B(){return B=(0,a.Z)(function*(n,e){yield function lt(n){return A.apply(this,arguments)}(n);const l=n[0].portalItem,i=(0,$.Yv)(l),f=yield Promise.all(n.map(o=>(0,d.Nw)(o,i,e))),u=yield J(l,n.map((o,y)=>({layer:o,layerJSON:f[y]})));return(0,d.UY)(l),yield l.update({data:u}),yield Promise.all(n.slice(1).map(o=>o.portalItem.reload())),(0,s.D)(i),l.clone()}),B.apply(this,arguments)}function dt(n,e,l){return N.apply(this,arguments)}function N(){return(N=(0,a.Z)(function*(n,e,l){return(0,d.po)({layer:n,itemType:O,validateLayer:T,createItemData:(i,f)=>Promise.resolve(z(i)),errorNamePrefix:_,newItem:e,setItemProperties:st},l)})).apply(this,arguments)}function mt(n,e,l){return G.apply(this,arguments)}function G(){return G=(0,a.Z)(function*(n,e,l){yield function ut(n){return K.apply(this,arguments)}(n);const i=(0,d.uT)({itemType:O,errorNamePrefix:E,newItem:e}),f=(0,$.Yv)(i),u=yield Promise.all(n.map(y=>(0,d.Nw)(y,f,l))),o=yield V(n.map((y,c)=>({layer:y,layerJSON:u[c]})));yield function it(n,e){return R.apply(this,arguments)}(i,n),yield(0,d.jX)(i,o,l);for(const y of n)y.portalItem=i.clone();return(0,s.D)(f),i}),G.apply(this,arguments)}},79936:(v,L,t)=>{t.d(L,{T:()=>h});var a=t(15861);const h={BingMapsLayer:(r=(0,a.Z)(function*(){return(yield t.e(4499).then(t.bind(t,84499))).default}),function(){return r.apply(this,arguments)}),BuildingSceneLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8866),t.e(4612),t.e(9893),t.e(9269),t.e(3080)]).then(t.bind(t,23080))).default});return function(){return r.apply(this,arguments)}}(),CSVLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(257).then(t.bind(t,90257))).default});return function(){return r.apply(this,arguments)}}(),DimensionLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(9645)]).then(t.bind(t,59645))).default});return function(){return r.apply(this,arguments)}}(),ElevationLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(1753)]).then(t.bind(t,86069))).default});return function(){return r.apply(this,arguments)}}(),FeatureLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.resolve().then(t.bind(t,90373))).default});return function(){return r.apply(this,arguments)}}(),GeoJSONLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(59).then(t.bind(t,80059))).default});return function(){return r.apply(this,arguments)}}(),GeoRSSLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(9050).then(t.bind(t,39050))).default});return function(){return r.apply(this,arguments)}}(),GroupLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(782).then(t.bind(t,50782))).default});return function(){return r.apply(this,arguments)}}(),ImageryLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(842),t.e(2784),t.e(6062),t.e(3338),t.e(5318),t.e(2861)]).then(t.bind(t,72861))).default});return function(){return r.apply(this,arguments)}}(),ImageryTileLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(6062),t.e(9350),t.e(3338),t.e(3287),t.e(5318),t.e(8592),t.e(8505)]).then(t.bind(t,34208))).default});return function(){return r.apply(this,arguments)}}(),IntegratedMeshLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8866),t.e(8592),t.e(4092)]).then(t.bind(t,74092))).default});return function(){return r.apply(this,arguments)}}(),KMLLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(2858)]).then(t.bind(t,22858))).default});return function(){return r.apply(this,arguments)}}(),LineOfSightLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(6625)]).then(t.bind(t,17551))).default});return function(){return r.apply(this,arguments)}}(),LinkChartLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(842),t.e(3866),t.e(5904),t.e(1518),t.e(6518),t.e(2166),t.e(8592),t.e(9900)]).then(t.bind(t,49900))).default});return function(){return r.apply(this,arguments)}}(),MapImageLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(842),t.e(2784),t.e(9351),t.e(7803)]).then(t.bind(t,37803))).default});return function(){return r.apply(this,arguments)}}(),MapNotesLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(8191)]).then(t.bind(t,18191))).default});return function(){return r.apply(this,arguments)}}(),MediaLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(4313)]).then(t.bind(t,69981))).default});return function(){return r.apply(this,arguments)}}(),OGCFeatureLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(842),t.e(2871),t.e(7960)]).then(t.bind(t,36019))).default});return function(){return r.apply(this,arguments)}}(),OpenStreetMapLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(4930)]).then(t.bind(t,22439))).default});return function(){return r.apply(this,arguments)}}(),OrientedImageryLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(617).then(t.bind(t,60617))).default});return function(){return r.apply(this,arguments)}}(),PointCloudLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8866),t.e(8592),t.e(265)]).then(t.bind(t,70265))).default});return function(){return r.apply(this,arguments)}}(),RouteLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(3301),t.e(5607)]).then(t.bind(t,25607))).default});return function(){return r.apply(this,arguments)}}(),SceneLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8866),t.e(4612),t.e(9893),t.e(9269),t.e(8592),t.e(724)]).then(t.bind(t,20724))).default});return function(){return r.apply(this,arguments)}}(),StreamLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(7157).then(t.bind(t,7157))).default});return function(){return r.apply(this,arguments)}}(),SubtypeGroupLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(6663).then(t.bind(t,46663))).default});return function(){return r.apply(this,arguments)}}(),TileLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(842),t.e(2784),t.e(9351),t.e(8592),t.e(1433)]).then(t.bind(t,77183))).default});return function(){return r.apply(this,arguments)}}(),UnknownLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(4850).then(t.bind(t,84850))).default});return function(){return r.apply(this,arguments)}}(),UnsupportedLayer:function(){var r=(0,a.Z)(function*(){return(yield t.e(4680).then(t.bind(t,60842))).default});return function(){return r.apply(this,arguments)}}(),VectorTileLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(7917),t.e(4433),t.e(8592),t.e(8622)]).then(t.bind(t,62003))).default});return function(){return r.apply(this,arguments)}}(),VoxelLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8866),t.e(8592),t.e(4691)]).then(t.bind(t,4691))).default});return function(){return r.apply(this,arguments)}}(),WFSLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(1970),t.e(6562)]).then(t.bind(t,18504))).default});return function(){return r.apply(this,arguments)}}(),WMSLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(616)]).then(t.bind(t,10616))).default});return function(){return r.apply(this,arguments)}}(),WMTSLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(7179)]).then(t.bind(t,67179))).default});return function(){return r.apply(this,arguments)}}(),WebTileLayer:function(){var r=(0,a.Z)(function*(){return(yield Promise.all([t.e(8592),t.e(3715)]).then(t.bind(t,54556))).default});return function(){return r.apply(this,arguments)}}()};var r},6661:(v,L,t)=>{t.d(L,{T:()=>r});var a=t(15861),h=t(66476);function r(d,p){return s.apply(this,arguments)}function s(){return(s=(0,a.Z)(function*(d,p){const{data:I}=yield(0,h.Z)(d,{responseType:"json",query:{f:"json",...p?.customParameters,token:p?.apiKey}});return I})).apply(this,arguments)}},65820:(v,L,t)=>{t.d(L,{w:()=>s});var a=t(11931),h=t(57964),r=t(40907);function s(d){if(a.default.apiKey&&(0,r.r)(d.portal.url))throw new h.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${d.portal.url} when using an api key`)}}}]);