"use strict";(self.webpackChunkjsapi_angular_cli=self.webpackChunkjsapi_angular_cli||[]).push([[7192],{64269:(ye,Q,a)=>{a.d(Q,{VF:()=>M,Uf:()=>Ne});var R=a(15861),y=a(50484),G=a(35458),L=a(73514),$=a(57678),K=a(83944),P=a(57964),I=a(1258),j=a(14007),O=a(8611),Z=a(79412),B=a(77675),D=a(49602),p=a(80543),J=a(1535),T=a(10141),z=a(26894),V=a(40408),pe=a(85295),W=a(1865);function X(r,e){return e?"xoffset"in e&&e.xoffset?Math.max(r,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(r,Math.abs(e.yoffset||0)):r:r}function re(r,e){return"number"==typeof r?r:r?.stops?.length?function fe(r){let e=0,n=0;for(let s=0;s<r.length;s++){const i=r[s].size;"number"==typeof i&&(e+=i,n++)}return e/n}(r.stops):e}function ne(r){const e=r?.renderer,n=r?.event?.pointerType,s="touch"===n?9:6;if(!e)return s;const i="visualVariables"in e?function ce(r,e){if(!e)return r;const n=e.filter(l=>"size"===l.type).map(l=>{const{maxSize:v,minSize:u}=l;return(re(v,r)+re(u,r))/2});let s=0;const i=n.length;if(0===i)return r;for(let l=0;l<i;l++)s+=n[l];const o=Math.floor(s/i);return Math.max(o,r)}(s,e.visualVariables):s;if("simple"===e.type)return X(i,e.symbol);if("unique-value"===e.type){let o=i;return e.uniqueValueInfos?.forEach(l=>{o=X(o,l.symbol)}),o}if("class-breaks"===e.type){let o=i;return e.classBreakInfos.forEach(l=>{o=X(o,l.symbol)}),o}return i}var de=a(66476),he=a(93566),Y=a(15462),me=a(38955),se=a(40637),ge=a(33721),ve=a(45859);var k,Ee=a(2189),we=a(34411),ie=a(89317),Re=a(43814);let m=k=class extends ie.wq{static from(r){return(0,J.TJ)(k,r)}constructor(r){super(r),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"dpi",void 0),(0,y._)([(0,p.Cb)()],m.prototype,"floors",void 0),(0,y._)([(0,p.Cb)({type:String,json:{write:!0}})],m.prototype,"gdbVersion",void 0),(0,y._)([(0,p.Cb)({types:Ee.qM,json:{read:se.im,write:!0}})],m.prototype,"geometry",void 0),(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"geometryPrecision",void 0),(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"height",void 0),(0,y._)([(0,p.Cb)({type:[Number],json:{write:!0}})],m.prototype,"layerIds",void 0),(0,y._)([(0,p.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],m.prototype,"layerOption",void 0),(0,y._)([(0,p.Cb)({type:z.Z,json:{write:!0}})],m.prototype,"mapExtent",void 0),(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"maxAllowableOffset",void 0),(0,y._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"returnFieldName",void 0),(0,y._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"returnGeometry",void 0),(0,y._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"returnM",void 0),(0,y._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"returnUnformattedValues",void 0),(0,y._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"returnZ",void 0),(0,y._)([(0,p.Cb)({type:Re.Z,json:{write:!0}})],m.prototype,"spatialReference",void 0),(0,y._)([(0,p.Cb)()],m.prototype,"sublayers",void 0),(0,y._)([(0,p.Cb)({type:we.Z,json:{write:!0}})],m.prototype,"timeExtent",void 0),(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"tolerance",void 0),(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"width",void 0),m=k=(0,y._)([(0,T.j)("esri.rest.support.IdentifyParameters")],m);const oe=m;var je=a(62185),Ce=a(7547),Oe=a(31709);let F=class extends ie.wq{constructor(r){super(r),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(r,e){return G.Z.fromJSON({attributes:{...e.attributes},geometry:{...e.geometry}})}writeFeature(r,e){if(!r)return;const{attributes:n,geometry:s}=r;n&&(e.attributes={...n}),null!=s&&(e.geometry=s.toJSON(),e.geometryType=Oe.P.toJSON(s.type))}};(0,y._)([(0,p.Cb)({type:String,json:{write:!0}})],F.prototype,"displayFieldName",void 0),(0,y._)([(0,p.Cb)({type:G.Z})],F.prototype,"feature",void 0),(0,y._)([(0,je.r)("feature",["attributes","geometry"])],F.prototype,"readFeature",null),(0,y._)([(0,Ce.c)("feature")],F.prototype,"writeFeature",null),(0,y._)([(0,p.Cb)({type:Number,json:{write:!0}})],F.prototype,"layerId",void 0),(0,y._)([(0,p.Cb)({type:String,json:{write:!0}})],F.prototype,"layerName",void 0),F=(0,y._)([(0,T.j)("esri.rest.support.IdentifyResult")],F);const Pe=F;function q(){return(q=(0,R.Z)(function*(r,e,n){const s=(e=function Ie(r){return oe.from(r)}(e)).geometry?[e.geometry]:[],i=(0,Y.en)(r);return i.path+="/identify",(0,he.aX)(s).then(o=>{const l=function be(r,e){const{dpi:n,gdbVersion:s,geometry:i,geometryPrecision:o,height:l,layerOption:v,mapExtent:u,maxAllowableOffset:f,returnFieldName:d,returnGeometry:c,returnUnformattedValues:h,returnZ:b,spatialReference:g,timeExtent:C,tolerance:E,width:x}=r.toJSON(),{dynamicLayers:w,layerDefs:A,layerIds:N}=function xe(r){const{mapExtent:e,floors:n,width:s,sublayers:i,layerIds:o,layerOption:l,gdbVersion:v}=r,u=i?.find(g=>null!=g.layer)?.layer?.serviceSublayers,f="popup"===l,d={},c=(0,V.yZ)({extent:e,width:s,spatialReference:e?.spatialReference}),h=[],b=g=>{if(g.visible&&(0===c||(0===g.minScale||c<=g.minScale)&&(0===g.maxScale||c>=g.maxScale)))if(g.sublayers)g.sublayers.forEach(b);else{if(!1===o?.includes(g.id)||f&&(!g.popupTemplate||!g.popupEnabled))return;h.unshift(g)}};if(i?.forEach(b),i&&!h.length)d.layerIds=[];else{const g=(0,ve.FN)(h,u,v),C=h.map(E=>{const x=(0,W.f)(n,E);return E.toExportImageJSON(x)});if(g)d.dynamicLayers=JSON.stringify(C);else{if(i){let x=h.map(({id:w})=>w);o&&(x=x.filter(w=>o.includes(w))),d.layerIds=x}else o?.length&&(d.layerIds=o);const E=function Se(r,e){const n=!!r?.length,s=e.filter(i=>null!=i.definitionExpression||n&&null!=i.floorInfo);return s.length?s.map(i=>{const o=(0,W.f)(r,i),l=(0,me._)(o,i.definitionExpression);return{id:i.id,definitionExpression:l??void 0}}):null}(n,h);if(null!=E&&E.length){const x={};for(const w of E)w.definitionExpression&&(x[w.id]=w.definitionExpression);Object.keys(x).length&&(d.layerDefs=JSON.stringify(x))}}}return d}(r),H=null!=e?.geometry?e.geometry:null,S={geometryPrecision:o,maxAllowableOffset:f,returnFieldName:d,returnGeometry:c,returnUnformattedValues:h,returnZ:b,tolerance:E},U=H&&H.toJSON()||i;S.imageDisplay=`${x},${l},${n}`,s&&(S.gdbVersion=s),U&&(delete U.spatialReference,S.geometry=JSON.stringify(U),S.geometryType=(0,se.Ji)(U));const ue=g??U?.spatialReference??u?.spatialReference;if(ue&&(S.sr=(0,ge.B9)(ue)),S.time=C?[C.start,C.end].join(","):null,u){const{xmin:Le,ymin:Be,xmax:De,ymax:Je}=u;S.mapExtent=`${Le},${Be},${De},${Je}`}return A&&(S.layerDefs=A),w&&!A&&(S.dynamicLayers=w),S.layers="popup"===v?"visible":v,N&&!w&&(S.layers+=`:${N.join(",")}`),S}(e,{geometry:o?.[0]}),v=(0,Y.cv)({...i.query,f:"json",...l}),u=(0,Y.lA)(v,n);return(0,de.Z)(i.path,u).then(Ue).then(f=>function Ze(r,e){if(!e?.length)return r;const n=new Map;e.forEach(function s(i){n.set(i.id,i),i.sublayers&&i.sublayers.forEach(s)});for(const i of r.results)i.feature.sourceLayer=n.get(i.layerId);return r}(f,e.sublayers))})})).apply(this,arguments)}function Ue(r){const e=r.data;return e.results=e.results||[],e.exceededTransferLimit=!!e.exceededTransferLimit,e.results=e.results.map(n=>Pe.fromJSON(n)),e}var Me=a(4978),ae=a(35451),le=a(96696);let _=null;function Ne(r,e){return"tile"===e.type||"map-image"===e.type}let M=class extends L.Z{constructor(r){var e;super(r),e=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,Z.Ds)(function(){var n=(0,R.Z)(function*(s){e.destroyed||e.updatingHandles.addPromise(e._updateHighlightedFeaturesGeometries(s).catch(()=>{}))});return function(s){return n.apply(this,arguments)}}())}initialize(){const r=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,B.on)(()=>this.highlightGraphics,"change",e=>r(e.added),{onListenerAdd:e=>r(e)})])}fetchPopupFeatures(r,e){var n=this;return(0,R.Z)(function*(){const{layerView:{layer:s,view:{scale:i}}}=n;if(!r)throw new P.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:s});const o=function Ge(r,e,n){const s=[];if(!r)return s;const i=o=>{if(o.visible&&(0===o.minScale||e<=o.minScale)&&(0===o.maxScale||e>=o.maxScale))if(o.sublayers)o.sublayers.forEach(i);else if(o.popupEnabled){const u=(0,le.V5)(o,{...n,defaultPopupTemplateEnabled:!1});null!=u&&s.unshift({sublayer:o,popupTemplate:u})}};return r.map(i),s}(s.sublayers,i,e);if(!o.length)return[];const l=yield function Ae(r,e){return ee.apply(this,arguments)}(s,o);if(!((s.capabilities?.operations?.supportsIdentify??1)&&s.version>=10.5||l))throw new P.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:s});return l?n._fetchPopupFeaturesUsingQueries(r,o,e):n._fetchPopupFeaturesUsingIdentify(r,o,e)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(r){const e=this.highlightGraphics;if(!e)return(0,I.kB)();let n=null;if(r instanceof G.Z?n=[r]:K.Z.isCollection(r)&&r.length>0?n=r.toArray():Array.isArray(r)&&r.length>0&&(n=r),n=n?.filter($.pC),!n?.length)return(0,I.kB)();for(const s of n){const i=s.sourceLayer;null!=i&&"geometryType"in i&&"point"===i.geometryType&&(s.visible=!1)}return e.addMany(n),(0,I.kB)(()=>e.removeMany(n??[]))}_updateHighlightedFeaturesSymbols(r){var e=this;return(0,R.Z)(function*(){const{layerView:{view:n},highlightGraphics:s,highlightGraphicUpdated:i}=e;if(s&&i)for(const o of r){const l=o.sourceLayer&&"renderer"in o.sourceLayer&&o.sourceLayer.renderer;o.sourceLayer&&"geometryType"in o.sourceLayer&&"point"===o.sourceLayer.geometryType&&l&&"getSymbolAsync"in l&&l.getSymbolAsync(o).then(function(){var v=(0,R.Z)(function*(u){u||=new ae.Z;let f=null;const d="visualVariables"in l?l.visualVariables?.find(c=>"size"===c.type):void 0;d&&(_||(_=(yield Promise.resolve().then(a.bind(a,37157))).getSize),f=_(d,o,{view:n.type,scale:n.scale,shape:"simple-marker"===u.type?u.style:null})),f||="width"in u&&"height"in u&&null!=u.width&&null!=u.height?Math.max(u.width,u.height):"size"in u?u.size:16,s.includes(o)&&(o.symbol=new ae.Z({style:"square",size:f,xoffset:"xoffset"in u?u.xoffset:0,yoffset:"yoffset"in u?u.yoffset:0}),i(o,"symbol"),o.visible=!0)});return function(u){return v.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(r){var e=this;return(0,R.Z)(function*(){const{layerView:{layer:n,view:s},highlightGraphics:i,highlightGraphicUpdated:o}=e;if(e._highlightGeometriesResolution=r,!o||!i?.length||!n.capabilities.operations.supportsQuery)return;const l=e._getTargetResolution(r),v=new Map;for(const d of i)(!e._featuresResolutions.has(d)||e._featuresResolutions.get(d)>l)&&(0,O.s1)(v,d.sourceLayer,()=>new Map).set(d.getObjectId(),d);const u=Array.from(v,([d,c])=>{const h=d.createQuery();return h.objectIds=[...c.keys()],h.outFields=[d.objectIdField],h.returnGeometry=!0,h.maxAllowableOffset=l,h.outSpatialReference=s.spatialReference,d.queryFeatures(h)}),f=yield Promise.all(u);if(!e.destroyed)for(const{features:d}of f)for(const c of d){const b=v.get(c.sourceLayer).get(c.getObjectId());b&&i.includes(b)&&(b.geometry=c.geometry,o(b,"geometry"),e._featuresResolutions.set(b,l))}})()}_getTargetResolution(r){const e=r*(0,D.c9)(this.layerView.view.spatialReference),n=e/16;return n<=10?0:r/e*n}_fetchPopupFeaturesUsingIdentify(r,e,n){var s=this;return(0,R.Z)(function*(){const i=yield s._createIdentifyParameters(r,e,n);if(null==i)return[];const{results:o}=yield function Fe(r,e,n){return q.apply(this,arguments)}(s.layerView.layer.parsedUrl,i);return o.map(l=>l.feature)})()}_createIdentifyParameters(r,e,n){var s=this;return(0,R.Z)(function*(){const{floors:i,layer:o,timeExtent:l,view:{spatialReference:v,scale:u}}=s.layerView,f=null!=n?n.event:null;if(!e.length)return null;yield Promise.all(e.map(({sublayer:C})=>C.load().catch(()=>{})));const d=Math.min((0,j.Z)("mapservice-popup-identify-max-tolerance"),o.allSublayers.reduce((C,E)=>E.renderer?ne({renderer:E.renderer,event:f}):C,2)),c=s.createFetchPopupFeaturesQueryGeometry(r,d),h=(0,V.dp)(u,v),b=Math.round(c.width/h),g=new z.Z({xmin:c.center.x-h*b,ymin:c.center.y-h*b,xmax:c.center.x+h*b,ymax:c.center.y+h*b,spatialReference:c.spatialReference});return new oe({floors:i,gdbVersion:"gdbVersion"in o?o.gdbVersion:void 0,geometry:r,height:b,layerOption:"popup",mapExtent:g,returnGeometry:!0,spatialReference:v,sublayers:o.sublayers,timeExtent:l,tolerance:d,width:b})})()}_fetchPopupFeaturesUsingQueries(r,e,n){var s=this;return(0,R.Z)(function*(){const{layerView:{floors:i,timeExtent:o}}=s,l=null!=n?n.event:null,v=e.map(function(){var u=(0,R.Z)(function*({sublayer:f,popupTemplate:d}){if(yield f.load().catch(()=>{}),f.capabilities&&!f.capabilities.operations.supportsQuery)return[];const c=f.createQuery(),h=ne({renderer:f.renderer,event:l}),b=s.createFetchPopupFeaturesQueryGeometry(r,h),g=new Set,[C]=yield Promise.all([(0,le.e7)(f,d),f.renderer?.collectRequiredFields(g,f.fieldsIndex)]);(0,pe.gd)(g,f.fieldsIndex,C);const E=Array.from(g).sort();if(c.geometry=b,c.outFields=E,c.timeExtent=o,i){const S=i.clone(),U=(0,W.f)(S,f);null!=U&&(c.where=c.where?`(${c.where}) AND (${U})`:U)}const x=s._getTargetResolution(b.width/h),w=yield function Ve(r){return r.expressionInfos?.length||Array.isArray(r.content)&&r.content.some(e=>"expression"===e.type)?(0,Me.LC)():Promise.resolve()}(d),A="point"===f.geometryType||w&&w.arcadeUtils.hasGeometryOperations(d);A||(c.maxAllowableOffset=x);let{features:N}=yield f.queryFeatures(c);const H=A?0:x;N=yield function Te(r,e){return te.apply(this,arguments)}(f,N);for(const S of N)s._featuresResolutions.set(S,H);return N});return function(f){return u.apply(this,arguments)}}());return(yield Promise.allSettled(v)).reduce((u,f)=>"fulfilled"===f.status?[...u,...f.value]:u,[]).filter($.pC)})()}};function ee(){return(ee=(0,R.Z)(function*(r,e){if(r.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(e.map(({sublayer:n})=>n.load().then(()=>n.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function te(){return(te=(0,R.Z)(function*(r,e){const n=r.renderer;return n&&"defaultSymbol"in n&&!n.defaultSymbol&&(e=n.valueExpression?yield Promise.all(e.map(s=>n.getSymbolAsync(s).then(i=>i?s:null))).then(s=>s.filter(i=>null!=i)):e.filter(s=>null!=n.getSymbol(s))),e})).apply(this,arguments)}(0,y._)([(0,p.Cb)({constructOnly:!0})],M.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,y._)([(0,p.Cb)({constructOnly:!0})],M.prototype,"layerView",void 0),(0,y._)([(0,p.Cb)({constructOnly:!0})],M.prototype,"highlightGraphics",void 0),(0,y._)([(0,p.Cb)({constructOnly:!0})],M.prototype,"highlightGraphicUpdated",void 0),(0,y._)([(0,p.Cb)({constructOnly:!0})],M.prototype,"updatingHandles",void 0),M=(0,y._)([(0,T.j)("esri.views.layers.support.MapService")],M)},9171:(ye,Q,a)=>{a.d(Q,{K:()=>L}),a(2189);var y=a(49602),G=a(26894);function L(P,I,j,O=new G.Z){let Z=0;if("2d"===j.type)Z=I*(j.resolution??0);else if("3d"===j.type){const z=j.overlayPixelSizeInMapUnits(P),V=j.basemapSpatialReference;Z=null==V||V.equals(j.spatialReference)?I*z:(0,y.c9)(V)/(0,y.c9)(j.spatialReference)}const B=P.x-Z,D=P.y-Z,p=P.x+Z,J=P.y+Z,{spatialReference:T}=j;return O.xmin=Math.min(B,p),O.ymin=Math.min(D,J),O.xmax=Math.max(B,p),O.ymax=Math.max(D,J),O.spatialReference=T,O}new G.Z}}]);